  {% extends "private-cloud/v4.18.01/_base.html" %} {% block title %}Update Apigee Edge
  4.16.01/4.16.05 to 4.18.01{% endblock %} {% block body %}

  <h2 id="whichedgeversionscanyouupdateto41801">Which Edge versions can you update to 4.18.01</h2>

  <aside class="note">
    <b>Note:</b> If you are updating from 4.17.0x, see <a href=
    "update-apigee-edge-4170x-41801.html">Update Apigee Edge 4.17.0x to 4.18.01</a>.

    <p>If you are updating from 4.16.09.0x, see <a href=
    "update-apigee-edge-41609-41801.html">Update Apigee Edge 4.16.09 to 4.18.01</a>.</p>
  </aside>

  <p>You can update Apigee Edge version 4.16.01.0x and 4.16.05.x to 4.18.01 using this
  procedure.</p>

  <p>If you have a version of Edge previous to version 4.16.01, then you must first migrate to
  version 4.16.01 and then update to version 4.18.01.</p>

  <ul>
    <li>You can migrate Apigee Edge version 4.15.07 to 4.16.01. </li>

    <li>If you have a version of Edge previous to version 4.15.07, then you must first migrate to
    version 4.15.07 and then to version 4.16.01.

      <ul>
        <li>If you are migrating from Edge version 4.14.04 or later: Directly migrate to version
        4.15.07.</li>

        <li>If you are migrating from Edge version 4.14.01: You must first migrate to version
        4.14.04, and then migrate to version 4.15.07.</li>
      </ul>
    </li>
  </ul>

  <h2 id="whocanperformtheupdate">Who can perform the update</h2>

  <p>The user running the update should be the same as the user who originally installed Edge, or a
  user running as root.</p>

  <p>After you install the Edge RPMs, any user can configure them.</p>

  <h2 id="whichcomponentsmustyouupdate">Which components must you update</h2>

  <p>You must update all Edge components. Edge does not support a setup that contains components
  from multiple versions.</p>

  <h2 id="downgradingzookeeperifupdatingfrom41601">Downgrading Zookeeper if updating from
  4.16.01</h2>

  <p>The  version of the Zookeeper RPM in Edge for Private Cloud 4.16.01 is <span style=
  "font-family: &quot;courier new&quot;, courier, monospace;">apigee-zookeeper-3.4.5-1.0.905.noarch.rpm</span>.
  In subsequent versions of Edge, the Zookeeper version was changed back to <span style=
  "font-family: &quot;courier new&quot;, courier, monospace;">apigee-zookeeper-3.4.5-0.0.94x</span>.
  This prevents yum from upgrading Zookeeper to a later versions from 4.16.01. The way to correct
  this situation is to run <span style=
  "font-family: &quot;courier new&quot;, courier, monospace;">yum downgrade
  apigee-zookeeper</span> before updating Zookeeper.</p>

  <p>You can check your Zookeeper version by using the following command:</p>
  <pre class="prettyprint">
&gt; rpm -qa |grep apigee-zookeeper
</pre>

  <p>If this command returns Zookeeper version:</p>
  <pre class="prettyprint">
apigee-zookeeper-3.4.5-1.0.905
</pre>

  <p>Then you must do the downgrade.</p>

  <h2 id="automaticpropagationofpropertysettings">Automatic propagation of property
  settings </h2>

  <p>If you have set any properties by editing <span style=
  "font-family:courier new,courier,monospace;">.properties</span> files in <span style=
  "font-family:courier new,courier,monospace;">/opt/apigee/customer/application</span> then these
  values are retained by the update.</p>

  <h2 id="updateprerequisites">Update prerequisites</h2>

  <p>Take care of following prerequisites before upgrading Apigee Edge:</p>

  <ul>
    <li><strong>Backup all nodes</strong><br>
    Before you update, it is recommended to perform a complete backup of all nodes for safety
    reasons. Use the procedure for your current version of Edge to perform the backup. <br>
    <br>
    This allows you to have a backup plan, in case the update to a new version doesn&#8217;t
    function properly. For more information on backup, see <a href="backup-and-restore.html">Backup
    and Restore</a>.</li>

    <li><strong>Ensure Edge is running</strong><br>
    Ensure that Edge is up and running during update process by using the command:<br>
    <br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-all status</span></li>
  </ul>

  <h2 id="handlingafailedupdate">Handling a failed update</h2>

  <p>In the case of an update failure, you can try to correct the issue, and then run update.sh
  again. You can run the update multiple times and it continues the update from where it last left
  off.</p>

  <p>If the failure requires that you roll back the update to your previous version, see <a href=
  "41801-rollback-process.html">4.18.01 Rollback Process</a>  for more. </p>

  <aside class="note"><b>Note:</b> The Edge all-in-one and 2-node topologies are designed for a
  getting started and prototyping environments, not for production. Therefore, there is no rollback
  procedure for the all-in-one and 2-node topologies. In the situation where the update of these
  topologies fails, and retrying the update does not resolve the issue, the easiest option is to do
  a fresh install of 4.18.01. </aside>

  <h2 id="loggingupdateinformation">Logging update information</h2>

  <p>By default, the <span style="font-family:courier new,courier,monospace;">update.sh</span>
  utility writes log information to:</p>
  <pre class="prettyprint">
/opt/apigee/var/log/apigee-setup/update.log
</pre>

  <p>If the user running the <span style=
  "font-family:courier new,courier,monospace;">update.sh</span> utility does not have access to
  that directory, it writes the log to the <span style=
  "font-family:courier new,courier,monospace;">/tmp</span> directory as a file named <span style=
  "font-family:courier new,courier,monospace;">update_username.log</span>.</p>

  <p>If the user does not have access to <span style=
  "font-family:courier new,courier,monospace;">/tmp</span>, the <span style=
  "font-family:courier new,courier,monospace;">update.sh</span> utility fails.</p>

  <h2 id="requiredupgradetojavajdkversion8">Required upgrade to Java JDK Version 8 </h2>

  <p>This release of Edge requires that you have installed Java JDK version 8 on all Edge
  processing nodes. You can install the Oracle JDK 8 or OpenJDK 8. If Java JDK 8 is not installed
  already, the update script can install it for you.</p>

  <p>As part of the update to Java 8, some TLS ciphers are no longer available in Oracle JDK 8. For
  the complete list, see the section "Default Disabled Cipher Suites" at <a href=
  "https://docs.oracle.com/javase/8/docs/technotes/guides/security/SunProviders.html">http://docs.oracle.com/javase/8/docs/technotes/guides/security/SunProviders.html</a>.</p>

  <aside class="warning"><b>Warning:</b> This release of Edge does not support JDK 7. If you are
  currently using JDK 7 with Edge 4.16.01, you must upgrade to JDK 8. If you rollback the Edge
  4.18.01 installation, you can optionally reconfigure Edge to use Java JDK 7.</aside>

  <h2 id="requiredtoenableepelrepo">Required to enable EPEL repo</h2>

  <p>You must enable <a href="https://fedoraproject.org/wiki/EPEL">Extra Packages for
  Enterprise Linux (or EPEL)</a> to install or update Edge. The command you use depends
  on your version of RedHat/CentOS:</p>

  <ul>
    <li>For RedHat/CentOS 7.x:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; wget
    https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm; rpm -ivh
    epel-release-latest-7.noarch.rpm</span></li>

    <li>For RedHat/CentOS 6.x:<br>
    <span style="font-family:courier new,courier,monospace;">wget
    https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm; rpm -ivh
    epel-release-latest-6.noarch.rpm</span></li>
  </ul>

  <h2 id="requiredadditionofsmtpmailfromconfigurationparameter">Required addition of SMTPMAILFROM
  configuration parameter</h2>

  <p>Edge 4.17.05 added a new required parameter to the configuration file used when you enable
  an SMTP server. If you are updating from 4.17.01, then you must set <span style=
  "font-family:courier new,courier,monospace;">SMTPMAILFROM</span> in the configuration file
  when enabling the SMTP server.</p>

  <p>API BaaS version 4.17.09 also added support for the <span style=
  "font-family: &quot;courier new&quot;, courier, monospace;">SMTPMAILFROM</span> property.
  When updating API BaaS, you must set <span style=
  "font-family: &quot;courier new&quot;, courier, monospace;">SMTPMAILFROM</span> in the
  configuration file.</p>

  <p>This parameter has the form:</p>
  <pre class="prettyprint">
SMTPMAILFROM="My Company &lt;myco@company.com&gt;"
</pre>

  <h2 id="requiredifupdatingwhenusingexternalauthentication">Required if updating when using
  external authentication</h2>

  <p>You can integrate an external directory service into an existing Apigee Edge Private Cloud
  installation. This feature is designed to work with any directory service that supports LDAP,
  such as Active Directory, OpenLDAP, and others. An external LDAP solution allows system
  administrators to manage user credentials from a centralized directory management service,
  external to systems like Apigee Edge that use them.</p>

  <p>See <a href="external-authentication-configuration.html">External Authentication
  Configuration</a> for more.</p>

  <p>When external authentication is enabled, most customers use the Active Directory SAM account
  name field as the username for authentication, instead of an email address which is used by the
  Edge OpenLDAP server. </p>

  <p>If you have integrated with an external directory service, then add the following line to
  your config file when updating Edge to 4.18.01:</p>
  <pre class="prettyprint">
IS_EXTERNAL_AUTH="true"
</pre>

  <p>This line configures Edge to support an account name, rather than an email address, as the
  username. </p>

  <h2 id="requiredupgradetoqpid135">Required upgrade to Qpid 1.35</h2>

  <p>This release contains a required update to Qpid 1.35. As part of updating a Qpid node, you
  have to:</p>

  <ul>
    <li>Temporarily prevent Routers and Message Processors from writing to the Qpid node by
    blocking port 5672 on the Qpid node. You can use the following command to block this port on
    the Qpid node:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -A INPUT -p tcp
    --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>

    <li>Wait for the Qpid queue to empty of messages to ensure that the Qpid node has processed all
    messages before the update. Use the following command to ensure that the Qpid message queue is
    empty:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;  qpid-stat -q</span></li>

    <li>Update the Qpid node.</li>

    <li>Unblock port 5672 on the Qpid node to allows access from Routers and Message Processors.
    You can use the following command to unblock this port:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -F</span>  
     <br>
    <br>
    Note that if you are using iptables for other rules, you can use the -D option to reverse the
    specific change:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -D INPUT -p tcp
    --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>
  </ul>

  <p>This process is described in detail below for each Edge topology.</p>

  <aside class="note"><b>Note:</b> Most production installations of Edge use two Qpid nodes. When
  performing the Qpid update, you update each node one at a time. This process ensures that one
  Qpid node is available to handle messages from the Routers and Message Processors and no
  analytics data will be lost. However, if your installation of Edge contains a single Qpid node,
  some analytics data will be lost while the Qpid node is unavailable during the update.</aside>

  <h2 id="requiredupgradetopostgres96">Required upgrade to Postgres 9.6 </h2>

  <p>This release of Edge includes an upgrade to Postgres 9.6. As part of that upgrade, all
  Postgres data is migrated to the Postgres 9.6.</p>

  <p>During the update process, while the Postgres nodes are down for update, analytics data is
  still written to the Qpid nodes. After the Postgres nodes are updated and back online, analytics
  data is then pushed to the Postgres nodes. </p>

  <aside class="warning"><b>Warning:</b> Most Edge production systems use Postgres master-standby
  replication. If your current installation uses Postgres master-standby replication, as part of
  the upgrade process you must install a new Postgres standby node for the duration of the upgrade.
  After the upgrade completes, you can decommission the Postgres standby node.   </aside>

  <p>The additional Postgres standby node is required if you have to roll back the update for any
  reason. If you have to roll back the update, the new Postgres standby node becomes the master
  Postgres node after the rollback. Therefore, when you install the new Postgres standby node, it
  should be on a node that meets all the hardware requirements of a Postgres server, as defined in
  the Edge <a href="installation-requirements.html">Installation Requirements</a>.</p>

  <h3 id="requiredupgradetopostgres96-installinganewpostgresstandbynode">Installing a new Postgres
  standby node</h3>

  <p>This procedure creates a Postgres standby server on a new node. Ensure that you install a new
  Postgres standby server for your <strong>existing</strong> version of Edge (4.16.01 or 4.16.05),
  not for version 4.18.01. </p>

  <p>To perform the install, use the same config file that you used to install your current version
  of Edge.</p>

  <p>To create a new Postgres standby node:</p>

  <ol>
    <li>On the current Postgres master, edit the <span style=
    "font-family:courier new,courier,monospace;">/opt/apigee/customer/application/postgresql.properties</span>
    file to set the following token. If that file does not exist, create it:<br>
    <br>
    <span style=
    "font-family:courier new,courier,monospace;">conf_pg_hba_replication.connection=host
    replication apigee <em><strong>existing_slave_ip</strong></em>/32 trust\ \nhost replication
    apigee <em><strong>new_slave_ip</strong></em>/32 trust</span><br>
    <br>
    where <em><strong>existing_slave_ip</strong></em> is the IP address of the current Postgres
    standby server and <em><strong>new_slave_ip</strong></em> is the IP address of the new standby
    node. </li>

    <li>Restart <span style="font-family:courier new,courier,monospace;">apigee-postgresql</span>
    on the Postgres master:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql restart</span></li>

    <li>Verify that the new standby node was added by viewing the <span style=
    "font-family:courier new,courier,monospace;">/opt/apigee/apigee-postgresql/conf/pg_hba.conf</span>
    file on the master. You should see the following lines in that file:<br>
    <span style="font-family:courier new,courier,monospace;">host replication apigee
    existing_slave_ip/32 trust<br>
    host replication apigee new_slave_ip/32 trust</span></li>

    <li>Install the new Postgres standby server:

      <ol style="list-style: lower-alpha outside">
        <li>Edit the config file that you used to install your current version of Edge to specify
        the following: <br>
        <br>
        <span style="font-family:courier new,courier,monospace;"># IP address of the current
        master:<br>
        PG_MASTER=192.168.56.103<br>
        # IP address of the new standby node<br>
        PG_STANDBY=192.168.56.102 </span></li>

        <li>Disable SELinux as described at <a href=
        "install-edge-apigee-setup-utility.html">Install the Edge apigee-setup utility</a>.</li>

        <li>Download the Edge bootstrap_4.16.05.sh file to <span style=
        "font-family:courier new,courier,monospace;">/tmp/bootstrap_4.16.05.sh</span>:<br>
        <span style="font-family:courier new,courier,monospace;">&gt; curl
        https://software.apigee.com/bootstrap_4.16.05.sh -o /tmp/bootstrap_4.16.05.sh</span><br>
        <br>
        <strong>Note</strong>: If you are updating from 4.16.01, download the Edge <span style=
        "font-family:courier new,courier,monospace;">bootstrap.sh</span> file. </li>

        <li>Install the Edge <span style=
        "font-family:courier new,courier,monospace;">apigee-service</span> utility and
        dependencies: <br>
        <span style="font-family:courier new,courier,monospace;">&gt; sudo bash
        /tmp/bootstrap_4.16.05.sh apigeeuser=<em><strong>uName</strong></em>
        apigeepassword=<em><strong>pWord</strong></em> </span></li>

        <li>Use <span style="font-family:courier new,courier,monospace;">apigee-service</span> to
        install the <span style="font-family:courier new,courier,monospace;">apigee-setup</span>
        utility:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup install</span></li>

        <li>Install Postgres:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/setup.sh -p ps -f
        <em><strong>configFile</strong></em></span></li>

        <li>On the new standby node run the following command:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-standby</span><br>
        <br>
        Validate that it says it is the standby.</li>
      </ol>
    </li>
  </ol>

  <h3 id="requiredupgradetopostgres96-decommissioningapostgresnode">Decommissioning a Postgres
  node</h3>

  <p>After the update completes, decommission the new standby node:</p>

  <ol>
    <li>Make sure Postgres is running:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-all status</span><br>
    <br>
    If Postgres is not running, start it:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-all start</span></li>

    <li>Get the UUID of the new standby node by running the following cURL command on the new
    standby node:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; curl -u
    <em><strong>sysAdminEmail:password</strong></em>
    http://<em><strong>&lt;node_IP&gt;</strong></em>:8084/v1/servers/self </span><br>
    <br>
    You should see the UUID of the node at the end of the output, in the form:<br>
    <strong><span style="font-family:courier new,courier,monospace;">"type" : [ "postgres-server"
    ],<br>
    "uUID" : "599e8ebf-5d69-4ae4-aa71-154970a8ec75"</span></strong></li>

    <li>Stop the new standby node by running the following command on the new standby node:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-all stop</span></li>

    <li>On the Postgres master node, edit <span style=
    "font-family:courier new,courier,monospace;">/opt/apigee/customer/application/postgresql.properties</span>
    to remove the new standby node from <span style=
    "font-family:courier new,courier,monospace;">conf_pg_hba_replication.connection</span>:<br>
    <span style=
    "font-family:courier new,courier,monospace;">conf_pg_hba_replication.connection=host
    replication apigee <em><strong>existing_slave_ip</strong></em>/32 trust</span></li>

    <li>Restart apigee-postgresql on the Postgres master:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql restart</span></li>

    <li>Verify that the new standby node was removed by viewing the <span style=
    "font-family:courier new,courier,monospace;">/opt/apigee/apigee-postgresql/conf/pg_hba.conf</span>
    file on the master. You should see only the following line in that file:<br>
    <span style="font-family:courier new,courier,monospace;">host replication apigee
    <em><strong>existing_slave_ip</strong></em>/32 trust</span></li>

    <li>Delete the UUID of the standby node from ZooKeeper by making the following Edge management
    API call on the Management Server node:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; curl -u
    <em><strong>sysAdminEmail:password</strong></em> -X DELETE
    http://<em><strong>&lt;ms_IP&gt;</strong></em>:8080/v1/servers/<em><strong>&lt;new_slave_uuid&gt;</strong></em></span></li>
  </ol>

  <h2 id="zerodowntimeupdate">Zero-downtime update</h2>

  <p>A zero-downtime update, or rolling update, lets you update your Edge installation without
  bringing down Edge. </p>

  <p>Zero-downtime update is only possible with a 5-node configuration and larger. </p>

  <p>The key to zero-downtime upgrading is to remove each Router, one at a time, from the load
  balancer. You then update the Router and any other components on the same machine as the Router,
  and then add the Router back to the load balancer.</p>

  <ol>
    <li>Update the machines in the correct order for your installation as described below in "Order
    of machine update".</li>

    <li>When it is time to update the Routers, select any one Router and make it unreachable, as
    described in <a href=
    "enablingdisabling-server-message-processorrouter-reachability.html">Enabling/Disabling Server
    (Message Processor/Router) Reachability</a>.</li>

    <li>Update the selected Router and all other Edge components on the same machine as the Router.
    All Edge configurations show a Router and Message Processor on the same node. </li>

    <li>Make the Router reachable again.</li>

    <li>Repeat steps 2 through 4 for the remaining Routers.</li>

    <li>Continue the update for any remaining machines in your installation.</li>
  </ol>

  <p>Take care of the following before/after update:</p>

  <ul>
    <li>On combined Router and Message Processor node:

      <ul>
        <li>Before update &#8211; perform the following:

          <ol>
            <li>Make the Router unreachable.</li>

            <li>Make the Message Processor unreachable.</li>
          </ol>
        </li>

        <li>After update - perform the following:

          <ol>
            <li>Make the Message Processor reachable.</li>

            <li>Make the Router reachable.</li>
          </ol>
        </li>
      </ul>
    </li>

    <li>On single Router node:

      <ul>
        <li>Before update, make the Router unreachable.</li>

        <li>After update, make the Router reachable.</li>
      </ul>
    </li>

    <li>On single Message Processor node:

      <ul>
        <li>Before update, make the Message Processor unreachable.</li>

        <li>After update, make the Message Processor reachable.</li>
      </ul>
    </li>
  </ul>

  <h2 id="usingasilentconfigurationfile">Using a silent configuration file</h2>

  <p>You must pass a silent configuration file to the update command. The silent configuration file
  should be the same one you used to install Edge 4.16.01 or 4.16.05.</p>

  <h2 id="procedureforupdatingto41801onanodewithanexternalinternetconnection">Procedure for
  updating to 4.18.01 on a node with an external internet connection</h2>

  <p>Use the following procedure to update the Edge components on a node: </p>

  <ol>
    <li>If you are currently using Postgres master-standby replication, install a new Postgres
    standby node as described above in <a href=
    "#requiredupgradetopostgres96-installinganewpostgresstandbynode">Installing a new Postgres
    standby node</a>.</li>

    <li>If present, disable any CRON jobs configured to perform a repair operation on Cassandra
    until after the update completes. </li>

    <li>Log in to your node as root to install the Edge RPMs.<br>
    <strong>Note</strong>: While RPM installation requires root access, you can perform Edge
    configuration without root access.</li>

    <li>Install <span style="font-family:courier new,courier,monospace;">yum-utils</span> and
    <span style="font-family:courier new,courier,monospace;">yum-plugin-priorities</span>:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo yum install yum-utils<br>
    &gt; sudo yum install yum-plugin-priorities</span></li>

    <li>Disable SELinux as described in <a href="install-edge-apigee-setup-utility.html">Install
    the Edge apigee-setup utility</a>.</li>

    <li>Enable EPEL repo as described above.</li>

    <li><strong>If you are installing on Oracle 7.x</strong>, run the following command:<br>
    <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt; sudo
    yum-config-manager --enable ol7_optional_latest</span></li>

    <li><strong>If you are installing on AWS</strong>, run the following <span style=
    "font-family:courier new,courier,monospace;">yum-configure-manager</span> commands:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; yum update
    rh-amazon-rhui-client.noarch</span><br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo yum-config-manager
    --enable rhui-REGION-rhel-server-extras rhui-REGION-rhel-server-optional</span></li>

    <li>Download the Edge 4.18.01 <span style=
    "font-family:courier new,courier,monospace;">bootstrap_4.18.01.sh</span> file to <span style=
    "font-family:courier new,courier,monospace;">/tmp/bootstrap_4.18.01.sh</span>:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; curl
    https://software.apigee.com/bootstrap_4.18.01.sh -o /tmp/bootstrap_4.18.01.sh</span></li>

    <li>Install the Edge 4.18.01 <span style=
    "font-family:courier new,courier,monospace;">apigee-service</span> utility and
    dependencies: <br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo bash
    /tmp/bootstrap_4.18.01.sh apigeeuser=<em><strong>uName</strong></em>
    apigeepassword=<em><strong>pWord</strong></em> </span><br>
    <br>
    where <em><strong>uName:pWord</strong></em> are the username and password you received from
    Apigee. If you omit <em><strong>pWord</strong></em>, you will be prompted to enter it.<br>
    <br>
    By default, the installer checks to see that you have Java 1.8 installed. If you do not, it
    installs it for you. Use the <span style=
    "font-family:courier new,courier,monospace;">JAVA_FIX</span> option to specify how to handle
    Java installation. <span style="font-family:courier new,courier,monospace;">JAVA_FIX</span>
    takes the following values:<br>
    <br>
    I = Install OpenJDK 1.8 (default)<br>
    C = Continue without installing Java<br>
    Q = Quit. For this option, you have to install Java yourself.</li>

    <li>Use <span style="font-family:courier new,courier,monospace;">apigee-service</span> to
    update the apigee-setup utility:

      <ol style="list-style: lower-alpha outside">
        <li><strong>If you installed 4.16.01 by upgrading Edge version 4.15.07.0x, you must install
        the apigee-setup utility:</strong><br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup install</span><br>
        <br>
        This command installs the <span style=
        "font-family:courier new,courier,monospace;">update.sh</span> utility in <span style=
        "font-family:courier new,courier,monospace;">/opt/apigee/apigee-setup/bin</span>.<br>
        <br>
        If you already installed the <span style=
        "font-family:courier new,courier,monospace;">apigee-setup</span> utility, then update
        it:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup update</span></li>

        <li><strong>If you installed 4.16.01 directly, meaning you did not perform an upgrade from
        4.15.07.0x, you must update the apigee-setup utility</strong>:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup update</span><br>
        <br>
        This update to <span style=
        "font-family:courier new,courier,monospace;">apigee-service</span> installs the
        <span style="font-family:courier new,courier,monospace;">update.sh</span> utility in
        <span style=
        "font-family:courier new,courier,monospace;">/opt/apigee/apigee-setup/bin</span>. </li>

        <li><strong>If you installed 4.16.05 directly or by update, you must update the
        apigee-setup utility</strong>:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup update</span><br>
        <br>
        This update to <span style=
        "font-family:courier new,courier,monospace;">apigee-service</span> installs the
        <span style="font-family:courier new,courier,monospace;">update.sh</span> utility in
        <span style=
        "font-family:courier new,courier,monospace;">/opt/apigee/apigee-setup/bin</span>. </li>
      </ol>
    </li>

    <li>Depending on your current version of Edge, you must either install or update the
    <span style="font-family:courier new,courier,monospace;">apigee-validate</span> utility on the
    Management Server.

      <ol style="list-style: lower-alpha outside">
        <li><strong>If you are currently using Edge 4.16.05</strong>: update the <span style=
        "font-family:courier new,courier,monospace;">apigee-validate</span> utility on the
        Management Server:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-validate update</span></li>

        <li><strong>If you are currently using Edge 4.16.01</strong>: install the <span style=
        "font-family:courier new,courier,monospace;">apigee-validate</span> utility on the
        Management Server:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-validate install</span><br>
        <br>
        <strong>Note</strong>: If you have installed the <span style=
        "font-family:courier new,courier,monospace;">apigee-validate</span> utility on a Message
        Processor node when installing 4.16.01, you can update it by using the following command on
        that node:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-validate update</span><br>
        <br>
        However, as of 4.16.05 and later, Apigee recommends that you install and run the
        <span style="font-family:courier new,courier,monospace;">apigee-validate</span> utility on
        the Management Server. </li>

        <li><strong>If you are upgrading from 4.16.01</strong>: Edit the config file passed to the
        <span style="font-family:courier new,courier,monospace;">apigee-validate</span> utility. In
        the 4.16.01 Edge release, the config file used by <span style=
        "font-family:courier new,courier,monospace;">apigee-validate</span> required the following
        properties:<br>
        <span style="font-family:courier new,courier,monospace;">APIGEE_ADMINPW=sysAdminPword<br>
        MP_POD=gateway<br>
        REGION=dc-1</span><br>
        <br>
        In this release, the config file only requires the <span style=
        "font-family:courier new,courier,monospace;">APIGEE_ADMINPW</span> property. You can remove
        the other two properties from the file.</li>
      </ol>
    </li>

    <li>Update the <span style="font-family:courier new,courier,monospace;">apigee-provision</span>
    utility:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-service apigee-provision update</span></li>

    <li>Run the update utility on your nodes in the order described below in "<em>Order of machine
    update</em>" below:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c <em><strong>component</strong></em> -f
    <em><strong>configFile</strong></em></span><br>
    <br>
    The only requirement on the config file is that the configuration file must be accessible or
    readable by the "apigee" user. <br>
    <br>
    Use the &#8220;-c&#8221; option to specify the component to update. The list of possible
    components includes:<br>
    <span style="font-family:courier new,courier,monospace;">ldap</span> = OpenLDAP<br>
    <span style="font-family:courier new,courier,monospace;">cs</span> = Cassandra<br>
    <span style="font-family:courier new,courier,monospace;">zk</span> = Zookeeper<br>
    <span style="font-family:courier new,courier,monospace;">qpid</span> = qpidd<br>
    <span style="font-family:courier new,courier,monospace;">ps</span> = postgresql<br>
    <span style="font-family:courier new,courier,monospace;">edge</span> =All Edge components
    except Edge UI: Management Server, Message Processor, Router, QPID Server, Postgres Server<br>
    <span style="font-family:courier new,courier,monospace;">ui</span> = Edge UI<br>
    <span style="font-family:courier new,courier,monospace;">all</span> = update all components on
    machine (only use for an Edge aio installation profile or an API BaaS asa installation
    profile)<br>
    <span style="font-family:courier new,courier,monospace;">e</span> = ElasticSearch<br>
    <span style="font-family:courier new,courier,monospace;">b</span> = API BaaS Stack<br>
    <span style="font-family:courier new,courier,monospace;">p</span> = API BaaS Portal<br>
    <span style="font-family:courier new,courier,monospace;">ebp</span> = ElasticSearch, API BaaS
    Stack, and API BaaS Portal on the same node</li>

    <li>Test the update by running the apigee-validate utility on the Management Server, as
    described in <a href="test-install.html">Test the install</a>.</li>

    <li>If you installed a new Postgres standby node, decommission the node as described above in
    <a href="#requiredupgradetopostgres96-decommissioningapostgresnode">Decommissioning a Postgres
    node</a>.</li>
  </ol>

  <p>To later rollback the update, use the procedure described in <a href=
  "41801-rollback-process.html">4.18.01 Rollback Process</a>.  </p>

  <h2 id="procedureforupdatingto41801fromalocalrepo">Procedure for updating to 4.18.01 from a local
  repo</h2>

  <p>If your Edge nodes are behind a firewall, or in some other way are prohibited from accessing
  the Apigee repository over the Internet, then you can perform the update from a local repository,
  or mirror,  of the Apigee repo. </p>

  <p>After you create a local Edge repository, you have two options for updating Edge from the
  local repo:</p>

  <ul>
    <li>Create a .tar file of the repo, copy the .tar file to a node, and then update Edge from the
    .tar file.</li>

    <li>Install a webserver on the node with the local repo so that other nodes can access it.
    Apigee provides the Nginx webserver for you to use, or you can use your own
    webserver. </li>
  </ul>

  <p>To update from a local 4.18.01 repo:</p>

  <ol>
    <li>If you are currently using Postgres master-standby replication, install a new Postgres
    standby node as described above in <a href=
    "#requiredupgradetopostgres96-installinganewpostgresstandbynode">Installing a new Postgres
    standby node</a>.</li>

    <li>Create a local 4.18.01 repo as described in "Create a local Apigee repository" at <a href=
    "install-edge-apigee-setup-utility.html">Install the Edge apigee-setup utility</a>.<br>
    <strong>Note</strong>: If you already have an existing 4.16.01 or 4.16.05 repo, you can add the
    4.18.01 repo to it as described in "Update a local Apigee repository" at <a href=
    "install-edge-apigee-setup-utility.html">Install the Edge apigee-setup utility</a>.</li>

    <li>
      <strong>To install apigee-service from a .tar file</strong>:

      <ol style="list-style: lower-alpha outside">
        <li>On the node with the local repo, use the following command to package the local repo
        into a single .tar file named <span style=
        "font-family:courier new,courier,monospace;">/opt/apigee/data/apigee-mirror/apigee-4.18.01.tar.gz</span>:<br>

        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-mirror package</span></li>

        <li>Copy the .tar file to the node where you want to update Edge. For example, copy it to
        the <span style="font-family:courier new,courier,monospace;">/tmp</span> directory on the
        new node.</li>

        <li>On the new node, untar the file to the /tmp directory:<br>
        <span style="font-family:courier new,courier,monospace;">&gt; tar -xzf
        apigee-4.18.01.tar.gz</span><br>
        <br>
        This command creates a new directory, named repos, in the directory containing the .tar
        file. For example /tmp/repos.</li>

        <li>Install the Edge apigee-service utility and dependencies from /tmp/repos: <br>
        <span style="font-family:courier new,courier,monospace;">&gt; sudo bash
        /tmp/repos/bootstrap_4.18.01.sh apigeeprotocol="file://"
        apigeerepobasepath=/tmp/repos</span><br>
        <br>
        Notice that you include the path to the repos directory in this command.</li>
      </ol>
    </li>

    <li>
      <strong>To install apigee-service using the Nginx webserver:</strong>

      <ol style="list-style: lower-alpha outside">
        <li>Configure the Nginx web server as described in "Install from the repo using the Nginx
        webserver" at <a href="install-edge-apigee-setup-utility.html">Install the Edge
        apigee-setup utility</a>.</li>

        <li>On the remote node, download the Edge <span style=
        "font-family:courier new,courier,monospace;">bootstrap_4.18.01.sh</span> file to
        <span style=
        "font-family:courier new,courier,monospace;">/tmp/bootstrap_4.18.01.sh</span>:<br>
        <span style="font-family:courier new,courier,monospace;">&gt; /usr/bin/curl
        http://<em><strong>uName:</strong></em><em><strong>pWord</strong></em>@<em><strong>remoteRepo</strong></em>:3939/bootstrap_4.18.01.sh
        -o /tmp/bootstrap_4.18.01.sh</span><br>
        <br>
        where <em><strong>uName:pWord</strong></em> are the username and password you set above for
        the repo, and <em><strong>remoteRepo</strong></em> is the IP address or DNS name of the
        repo node. </li>

        <li>On the remote node, install the Edge apigee-service utility and dependencies: <br>
        <span style="font-family:courier new,courier,monospace;">&gt; sudo bash
        /tmp/bootstrap_4.18.01.sh apigeerepohost=<em><strong>remoteRepo</strong></em>:3939
        apigeeuser=<em><strong>uName</strong></em> apigeepassword=<em><strong>pWord</strong></em>
        apigeeprotocol=http://</span><br>
        <br>
        where <em><strong>uName:pWord</strong></em> are the repo username and password.</li>
      </ol>
    </li>

    <li>Use <span style="font-family:courier new,courier,monospace;">apigee-service</span> to
    update the apigee-setup utility:

      <ol style="list-style: lower-alpha outside">
        <li><strong>If you installed 4.16.01 by upgrading Edge version 4.15.07.0x, you must install
        the apigee-setup utility:</strong><br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup install</span><br>
        <br>
        This command installs the <span style=
        "font-family:courier new,courier,monospace;">update.sh</span> utility in <span style=
        "font-family:courier new,courier,monospace;">/opt/apigee/apigee-setup/bin</span>.<br>
        <br>
        If you already installed the <span style=
        "font-family:courier new,courier,monospace;">apigee-setup</span> utility, then update
        it:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup update</span></li>

        <li><strong>If you installed 4.16.01 directly, meaning you did not perform an upgrade from
        4.15.07.0x, you must update the apigee-setup utility:</strong><br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup update</span><br>
        <br>
        This update to <span style=
        "font-family:courier new,courier,monospace;">apigee-service</span> installs the
        <span style="font-family:courier new,courier,monospace;">update.sh</span> utility in
        <span style=
        "font-family:courier new,courier,monospace;">/opt/apigee/apigee-setup/bin</span>. </li>

        <li><strong>If you installed 4.16.05 directly or by update, you must update the
        apigee-setup utility:</strong><br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-setup update</span><br>
        <br>
        This update to <span style=
        "font-family:courier new,courier,monospace;">apigee-service</span> installs the
        <span style="font-family:courier new,courier,monospace;">update.sh</span> utility in
        <span style=
        "font-family:courier new,courier,monospace;">/opt/apigee/apigee-setup/bin</span>. </li>
      </ol>
    </li>

    <li>Depending on your current version of Edge, you must either install or update the
    <span style="font-family:courier new,courier,monospace;">apigee-validate</span> utility on the
    Management Server.

      <ol style="list-style: lower-alpha outside">
        <li><strong>If you are currently using Edge 4.16.05</strong>: update the <span style=
        "font-family:courier new,courier,monospace;">apigee-validate</span> utility on the
        Management Server:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-validate update</span></li>

        <li><strong>If you are currently using Edge 4.16.01</strong>: install the apigee-validate
        utility on the Management Server:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-validate install</span><br>
        <br>
        <strong>Note</strong>: If you have installed the <span style=
        "font-family:courier new,courier,monospace;">apigee-validate</span> utility on a Message
        Processor node when installing 4.16.01, you can update it by using the following command on
        that node:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-validate update</span><br>
        <br>
        However, as of 4.16.05 and later, Apigee recommends that you install and run the
        apigee-validate utility on the Management Server. </li>

        <li><strong>If you are upgrading from 4.16.01</strong>: Edit the config file passed to the
        <span style="font-family:courier new,courier,monospace;">apigee-validate</span> utility. In
        the 4.16.01 Edge release, the config file used by <span style=
        "font-family:courier new,courier,monospace;">apigee-validate</span> required the following
        properties:<br>
        <span style="font-family:courier new,courier,monospace;">APIGEE_ADMINPW=sysAdminPword<br>
        MP_POD=gateway<br>
        REGION=dc-1</span><br>
        <br>
        In this release, the config file only requires the <span style=
        "font-family:courier new,courier,monospace;">APIGEE_ADMINPW</span> property. You can remove
        the other two properties from the file.</li>
      </ol>
    </li>

    <li>Update the <span style="font-family:courier new,courier,monospace;">apigee-provision</span>
    utility:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-service apigee-provision update</span></li>

    <li>Run the update utility on your nodes in the order described below in "Order of machine
    update" below:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c component -f
    <em><strong>configFile</strong></em></span><br>
    <br>
    The only requirement on the config file is that the configuration file must be accessible or
    readable by the "apigee" user. <br>
    <br>
    Use the &#8220;-c&#8221; option to specify the component to update. The list of possible
    components includes:<br>
    <span style="font-family:courier new,courier,monospace;">ldap</span> = OpenLDAP<br>
    <span style="font-family:courier new,courier,monospace;">cs</span> = Cassandra<br>
    <span style="font-family:courier new,courier,monospace;">zk</span> = Zookeeper<br>
    <span style="font-family:courier new,courier,monospace;">qpid</span> = qpidd<br>
    <span style="font-family:courier new,courier,monospace;">ps</span> = postgresql<br>
    <span style="font-family:courier new,courier,monospace;">edge</span> =All Edge components
    except Edge UI: Management Server, Message Processor, Router, QPID Server, Postgres Server<br>
    <span style="font-family:courier new,courier,monospace;">ui</span> = Edge UI<br>
    <span style="font-family:courier new,courier,monospace;">all</span> = update all components on
    machine (only use for an Edge aio installation profile or an API BaaS asa installation
    profile)<br>
    <span style="font-family:courier new,courier,monospace;">e</span> = ElasticSearch<br>
    <span style="font-family:courier new,courier,monospace;">b</span> = API BaaS Stack<br>
    <span style="font-family:courier new,courier,monospace;">p</span> = API BaaS Portal<br>
    <span style="font-family:courier new,courier,monospace;">ebp</span> = ElasticSearch, API BaaS
    Stack, and API BaaS Portal on the same node</li>

    <li>Test the update by running the apigee-validate utility on the Management Server, as
    described in <a href="test-install.html">Test the install</a>.</li>

    <li>If you installed a new Postgres standby node, decommission the node as described above in
    <a href="#requiredupgradetopostgres96-decommissioningapostgresnode">Decommissioning a Postgres
    node</a>.</li>
  </ol>

  <p>To later rollback the update, use the procedure described in <a href=
  "41801-rollback-process.html">4.18.01 Rollback Process</a>.  </p>

  <h2 id="orderofmachineupdate">Order of machine update</h2>

  <p>The order that you update the machines in an Edge installation is important. The most
  important considerations to an update are:</p>

  <ul>
    <li>You must update <strong>all</strong> Cassandra and ZooKeeper nodes before you update any
    other nodes.</li>

    <li>For any machine with multiple Edge components (Management Server, Message Processor,
    Router, QPID Server but not Postgres Server), use the "-c edge" option to update them all at
    the same time. </li>

    <li>If a step specifies that it should be performed on multiple machines, perform it in the
    specified machine order.</li>

    <li>There is no separate step to update Monetization. It is updated when you specify the "-c
    edge" option.</li>
  </ul>

  <h3 id="orderofmachineupdate-fora1hoststandaloneinstallation">For a 1-host standalone
  installation</h3>

  <aside class="note"><b>Note:</b> For a 1-host installation, you do not have to create a new
  Postgres standby node.</aside>

  <ol>
    <li>Set <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM</span> in your
    configuration file if you have enabled SMTP on Edge. This parameter has the form:<br>
    <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM="My Company
    &lt;myco@company.com&gt;"</span></li>

    <li><strong>If updating from 4.16.01</strong>, downgrade Zookeeper:<br>
    <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt; yum downgrade
    apigee-zookeeper</span></li>

    <li>Update Cassandra and ZooKeeper:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c cs,zk -f
    <em><strong>configFile</strong></em></span></li>

    <li>Set the following iptables rule:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -A INPUT -p tcp
    --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>

    <li>Check the Qpid message queue:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; qpid-stat -q</span> <br>
    <br>
    Continue to check the queue until the count in the "msg" column is 0. You cannot upgrade Qpid
    until it has processed all messages.  </li>

    <li>Update <span style="font-family:courier new,courier,monospace;">qpidd</span>:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c qpid -f
    <em><strong>configFile</strong></em></span></li>

    <li>Flush iptables:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -F</span></li>

    <li>Update LDAP:<br>
    <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ldap -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Stop Postgres Server, Qpid server, and PostgreSQL:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
    &gt; /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server stop<br>
    &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

    <li>Update postgresql:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update the Postgres database:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql db_upgrade</span></li>

    <li>Update the remaining Edge components:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update Edge UI:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ui -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>
  </ol>

  <h3 id="orderofmachineupdate-fora2hoststandaloneinstallation">For a 2-host standalone
  installation</h3>

  <aside class="note"><b>Note:</b> For a 2-host installation, you do not have to create a new
  Postgres standby node.</aside>

  <p>See <a href="installation-topologies.html">Installation Topologies</a> for the list of Edge
  topologies and node numbers.</p>

  <ol>
    <li>Set <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM</span> in your
    configuration file if you have enabled SMTP on Edge. This parameter has the form:<br>
    <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM="My Company
    &lt;myco@company.com&gt;"</span></li>

    <li><strong>If updating from 4.16.01</strong>, downgrade Zookeeper on machine 1:<br>
    <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt; yum downgrade
    apigee-zookeeper</span></li>

    <li>Update Cassandra and ZooKeeper on machine 1:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c cs,zk -f
    <em><strong>configFile</strong></em></span></li>

    <li>Set the following iptables rule on machine 2:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -A INPUT -p tcp
    --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>

    <li>Check the Qpid message queue on machine 2:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; qpid-stat -q</span> <br>
    <br>
    Continue to check the queue until the count in the "msg" column is 0. You cannot upgrade Qpid
    until it has processed all messages.  </li>

    <li>Update <span style="font-family:courier new,courier,monospace;">qpidd </span>on
    machine 2:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c qpid -f
    <em><strong>configFile</strong></em></span></li>

    <li>Flush iptables on machine 2:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -F</span></li>

    <li>Update LDAP on machine 1:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ldap -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update Edge components on machine 1:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update UI on machine 1:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ui -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update postgresql on machine 2:

      <ol style="list-style: lower-alpha outside">
        <li>Stop Postgres Server, Qpid server, and postgresql:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Update postgresql:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f configFile</span></li>

        <li>Update the Postgres database:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql db_upgrade</span></li>

        <li>Update Edge components on machine 2:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>
      </ol>
    </li>
  </ol>

  <h3 id="orderofmachineupdate-fora5hostclusteredinstallation">For a 5-host clustered
  installation</h3>

  <p>See <a href="installation-topologies.html">Installation Topologies</a> for the list of Edge
  topologies and node numbers.</p>

  <ol>
    <li>Set <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM</span> in your
    configuration file if you have enabled SMTP on Edge. This parameter has the form:<br>
    <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM="My Company
    &lt;myco@company.com&gt;"</span></li>

    <li>Ensure that you have installed a new Postgres standby node as described above in <a href=
    "#requiredupgradetopostgres96-installinganewpostgresstandbynode">Installing a new Postgres
    standby node</a>.</li>

    <li><strong>If updating from 4.16.01</strong>, downgrade Zookeeper on machine 1, 2, and 3:<br>
    <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt; yum downgrade
    apigee-zookeeper</span></li>

    <li>Update Cassandra and ZooKeeper on machine 1, 2, and 3:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c cs,zk -f
    <em><strong>configFile</strong></em></span></li>

    <li>Set the following iptables rule on machine 4:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -A INPUT -p tcp
    --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>

    <li>Check the Qpid message queue on machine 4:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; qpid-stat -q</span> <br>
    <br>
    Continue to check the queue until the count in the "msg" column is 0. You cannot upgrade Qpid
    until it has processed all messages.  </li>

    <li>Update <span style="font-family:courier new,courier,monospace;">qpidd </span>on
    machine 4:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c qpid -f
    <em><strong>configFile</strong></em></span></li>

    <li>Flush iptables on machine 4:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -F</span></li>

    <li>Repeat steps 5 through 8 on machine 5.</li>

    <li>Update LDAP on machine 1:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ldap -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update Edge components on machine 1, 2, 3:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>


    <li>Update UI on machine 1:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ui -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update machines 4 and 5:

      <ol style="list-style: lower-alpha outside">
        <li>Stop Postgres server and Qpid server on machine 4:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server stop</span></li>

        <li>Stop Postgres server, Qpid server, and postgresql on machine  5:<br>
        <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Stop Postgres server and postgresql on the new standby node that you added for
        rollback:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Update postgresql on machines 4:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Update the Postgres database on machine 4 (Postgres master only):<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql db_upgrade</span></li>

        <li>Update postgresql on machines 5:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Start Postgres server and Qpid server on machines 4 and 5:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server start<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server start</span></li>

        <li>Configure Postgres as a standby node by running the following commands on machine
        5:<br>
        <span style="font-family:courier new,courier,monospace;">&gt; cd
        /opt/apigee/data/apigee-postgresql/pgdata<br>
        &gt; rm -rf *<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        setup-replication-on-standby -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Verify the replication status by issuing the following scripts on both servers. The
        system should display identical results on both servers to ensure a successful
        replication:<br>
        <br>
        On the machine 4, the master node, run:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-master</span><br>
        <br>
        Validate that it says it is the master.<br>
        <br>
        On machine 5, the standby node:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-standby</span><br>
        <br>
        Validate that it says it is the standby.</li>
      </ol>
    </li>

    <li>Update Edge components on machine 4, 5:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Ensure that you decommission the new standby node by using the procedure above in <a href=
    "#requiredupgradetopostgres96-decommissioningapostgresnode">Decommissioning a Postgres
    node</a>.</li>
  </ol>

  <h3 id="orderofmachineupdate-fora9hostclusteredinstallation">For a 9-host clustered
  installation</h3>

  <p>See <a href="installation-topologies.html">Installation Topologies</a> for the list of Edge
  topologies and node numbers.</p>

  <ol>
    <li>Set <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM</span> in your
    configuration file if you have enabled SMTP on Edge. This parameter has the form:<br>
    <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM="My Company
    &lt;myco@company.com&gt;"</span></li>

    <li>Ensure that you have installed a new Postgres standby node as described above in <a href=
    "#requiredupgradetopostgres96-installinganewpostgresstandbynode">Installing a new Postgres
    standby node</a>.</li>

    <li><strong>If updating from 4.16.01</strong>, downgrade Zookeeper on macine 1, 2, and 3:<br>
    <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt; yum downgrade
    apigee-zookeeper</span></li>

    <li>Update Cassandra and ZooKeeper on machine 1, 2, and 3:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c cs,zk -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Set the following iptables rule on machine 6:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -A INPUT -p tcp
    --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>

    <li>Check the Qpid message queue on machine 6:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; qpid-stat -q</span> <br>
    <br>
    Continue to check the queue until the count in the "msg" column is 0. You cannot upgrade Qpid
    until it has processed all messages.  </li>

    <li>Update <span style="font-family:courier new,courier,monospace;">qpidd </span>on
    machine 6:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c qpid -f
    <em><strong>configFile</strong></em></span></li>

    <li>Flush iptables on machine 6:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -F</span></li>

    <li>Repeat steps 5 through 8 on machine 7.</li>

    <li>Update LDAP on machine 1:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ldap -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update Edge components on machine 6, 7, 1, 4, and 5 in that order:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>


    <li>Update UI on machine 1:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ui -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update machines 8 and 9:

      <ol style="list-style: lower-alpha outside">
        <li>Stop Postgres server on machine 8:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop</span></li>

        <li>Stop Postgres server and postgresql on machine 9:<br>
        <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Stop Qpid server on machines 6 and 7:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server stop</span></li>

        <li>Stop Postgres server and postgresql on the new standby node that you added for
        rollback:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Update postgresql on machines 8:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Update the Postgres database on machine 8 (Postgres master only):<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql db_upgrade</span></li>

        <li>Update postgresql on machines 9:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Start Postgres server server on machines 8 and 9:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server start</span></li>

        <li>Start Qpid server server on machines 6 and 7:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server start</span></li>

        <li>Configure Postgres as a standby node by running the following commands on machine
        9:<br>
        <span style="font-family:courier new,courier,monospace;">&gt; cd
        /opt/apigee/data/apigee-postgresql/pgdata<br>
        &gt; rm -rf *<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        setup-replication-on-standby -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Verify the replication status by issuing the following scripts on both servers. The
        system should display identical results on both servers to ensure a successful
        replication:<br>
        On the machine 8, the master node, run:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-master</span><br>
        <br>
        Validate that it says it is the master.<br>
        <br>
        On machine 9, the standby node:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-standby</span><br>
        <br>
        Validate that it says it is the standby.</li>
      </ol>
    </li>

    <li>Update Edge components on machine 8 and 9:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Ensure that you decommission the new standby node by using the procedure above in <a href=
    "#requiredupgradetopostgres96-decommissioningapostgresnode">Decommissioning a Postgres
    node</a>.</li>
  </ol>

  <h3 id="orderofmachineupdate-fora13hostclusteredinstallation">For a 13-host clustered
  installation</h3>

  <p>See <a href="installation-topologies.html">Installation Topologies</a> for the list of Edge
  topologies and node numbers.</p>

  <ol>
    <li>Set <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM</span> in your
    configuration file if you have enabled SMTP on Edge. This parameter has the form:<br>
    <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM="My Company
    &lt;myco@company.com&gt;"</span></li>

    <li>Ensure that you have installed a new Postgres standby node as described above in <a href=
    "#requiredupgradetopostgres96-installinganewpostgresstandbynode">Installing a new Postgres
    standby node</a>.</li>

    <li><strong>If updating from 4.16.01</strong>, downgrade Zookeeper on macine 1, 2, and 3:<br>
    <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt; yum downgrade
    apigee-zookeeper</span></li>

    <li>Update Cassandra and ZooKeeper on machine 1, 2, and 3:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c cs,zk -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Set the following iptables rule on machine 12:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -A INPUT -p tcp
    --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>

    <li>Check the Qpid message queue on machine 12:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; qpid-stat -q</span> <br>
    <br>
    Continue to check the queue until the count in the "msg" column is 0. You cannot upgrade Qpid
    until it has processed all messages.  </li>

    <li>Update <span style="font-family:courier new,courier,monospace;">qpidd </span>on
    machine 12:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c qpid -f
    <em><strong>configFile</strong></em></span></li>

    <li>Flush iptables on machine 12:<br>
    <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -F</span></li>

    <li>Repeat steps 5 through 8 on machine 13.</li>

    <li>Update LDAP on machine 4 and 5:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ldap -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update Edge components on machine 12, 13, 6, 7, 10, and 11 in that order:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>


    <li>Update UI on machine 6 and 7:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c ui -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Update machines 8 and 9:

      <ol style="list-style: lower-alpha outside">
        <li>Stop Postgres server on machine 8:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop</span></li>

        <li>Stop Postgres server and postgresql on machine 9:<br>
        <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Stop Qpid server on machines 12 and 13:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server stop</span></li>

        <li>Stop Postgres server and postgresql on the new standby node that you added for
        rollback:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Update postgresql on machines 8:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Update the Postgres database on machine 8 (Postgres master only):<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql db_upgrade</span></li>

        <li>Update postgresql on machines 9:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Start Postgres server on machines 8 and 9:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server start</span></li>

        <li>Start Qpid server server on machines 12 and 13:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server start</span></li>

        <li>Configure Postgres as a standby node by running the following commands on machine
        9:<br>
        <span style="font-family:courier new,courier,monospace;">&gt; cd
        /opt/apigee/data/apigee-postgresql/pgdata<br>
        &gt; rm -rf *<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        setup-replication-on-standby -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Verify the replication status by issuing the following scripts on both servers. The
        system should display identical results on both servers to ensure a successful
        replication:<br>
        On the machine 8, the master node, run:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-master</span><br>
        <br>
        Validate that it says it is the master.<br>
        <br>
        On machine 9, the standby node:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-standby</span><br>
        <br>
        Validate that it says it is the standby.</li>
      </ol>
    </li>

    <li>Update Edge components on machine 8 and 9:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Ensure that you decommission the new standby node by using the procedure above in <a href=
    "#requiredupgradetopostgres96-decommissioningapostgresnode">Decommissioning a Postgres
    node</a>.</li>
  </ol>

  <h3 id="orderofmachineupdate-fora12hostclusteredinstallation">For a 12-host clustered
  installation</h3>

  <p>See <a href="installation-topologies.html">Installation Topologies</a> for the list of Edge
  topologies and node numbers.</p>

  <ol>
    <li>Set <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM</span> in your
    configuration file if you have enabled SMTP on Edge. This parameter has the form:<br>
    <span style="font-family:courier new,courier,monospace;">SMTPMAILFROM="My Company
    &lt;myco@company.com&gt;"</span></li>

    <li>Ensure that you have installed a new Postgres standby node as described above in <a href=
    "#requiredupgradetopostgres96-installinganewpostgresstandbynode">Installing a new Postgres
    standby node</a>.</li>

    <li>Update Cassandra and ZooKeeper:

      <ol style="list-style: lower-alpha outside">
        <li><strong>If updating from 4.16.01</strong>, downgrade Zookeeper on macine 1, 2, and 3 in
        Data Center 1:<br>
        <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt; yum
        downgrade apigee-zookeeper</span></li>

        <li>On machines 1, 2 and 3 in Data Center 1:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c cs,zk -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li><strong>If updating from 4.16.01</strong>, downgrade Zookeeper on macine 7, 8, and 9 in
        Data Center 2:<br>
        <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt; yum
        downgrade apigee-zookeeper</span></li>

        <li>On machines 7, 8, and 9 in Data Center 2<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c cs,zk -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>
      </ol>
    </li>

    <li>Update qpidd:

      <ol style="list-style: lower-alpha outside">
        <li>Machines 4, 5 in Data Center 1

          <ol>
            <li>Set the following iptables rule on machine 4:<br>
            <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -A INPUT -p
            tcp --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>

            <li>Check the Qpid message queue on machine 4:<br>
            <span style="font-family:courier new,courier,monospace;">&gt; qpid-stat
            -q</span> <br>
            <br>
            Continue to check the queue until the count in the "msg" column is 0. You cannot
            upgrade Qpid until it has processed all messages.  </li>

            <li>Update <span style=
            "font-family:courier new,courier,monospace;">qpidd </span>on machine 4:<br>
            <span style="font-family:courier new,courier,monospace;">&gt;
            /opt/apigee/apigee-setup/bin/update.sh -c qpid -f
            <em><strong>configFile</strong></em></span></li>

            <li>Flush iptables on machine 4:<br>
            <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables
            -F</span></li>

            <li>Repeat steps 1 through 4 on machine 5.</li>
          </ol>
        </li>

        <li>Machines 10, 11 in Data Center 2

          <ol>
            <li>Set the following iptables rule on machine 10:<br>
            <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables -A INPUT -p
            tcp --destination-port 5672 ! -s `hostname`  -i eth0 -j DROP</span></li>

            <li>Check the Qpid message queue on machine 10:<br>
            <span style="font-family:courier new,courier,monospace;">&gt; qpid-stat
            -q</span> <br>
            <br>
            Continue to check the queue until the count in the "msg" column is 0. You cannot
            upgrade Qpid until it has processed all messages.  </li>

            <li>Update <span style=
            "font-family:courier new,courier,monospace;">qpidd </span>on machine 10:<br>
            <span style="font-family:courier new,courier,monospace;">&gt;
            /opt/apigee/apigee-setup/bin/update.sh -c qpid -f
            <em><strong>configFile</strong></em></span></li>

            <li>Flush iptables on machine 10:<br>
            <span style="font-family:courier new,courier,monospace;">&gt; sudo iptables
            -F</span></li>

            <li>Repeat steps 1 through 4 on machine 11.</li>
          </ol>
        </li>
      </ol>
    </li>

    <li>Update LDAP:

      <ol style="list-style: lower-alpha outside">
        <li>Machines 1 in Data Center 1<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ldap -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Machines 7 in Data Center 2<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ldap -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>
      </ol>
    </li>

    <li>Update Edge components:

      <ol style="list-style: lower-alpha outside">
        <li>Machines 4, 5, 1, 2, 3 in Data Center 1<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Machines 10, 11, 7, 8, 9 in Data Center 2<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>
      </ol>
    </li>


    <li>Update UI:

      <ol style="list-style: lower-alpha outside">
        <li>Machine 1 in Data Center 1:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ui -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Machine 7 in Data Center 2:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ui -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>
      </ol>
    </li>

    <li>Update machine 6 in Data Center 1 and and 12 in Data Center 2:

      <ol style="list-style: lower-alpha outside">
        <li>Stop Postgres server on machine 6:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop</span></li>

        <li>Stop Postgres server and postgresql on machine 12:<br>
        <span style="font-family: &quot;courier new&quot;, courier, monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Stop Qpid server on machines 4, 5, 10, and 11:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server stop</span></li>

        <li>Stop Postgres server and postgresql on the new standby node that you added for
        rollback:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server stop<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql stop</span></li>

        <li>Update postgresql on machines 6:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Update the Postgres database on machine 6 (Postgres master only):<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql db_upgrade</span></li>

        <li>Update postgresql on machines 12:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-setup/bin/update.sh -c ps -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Start Postgres server server on machines 6 and 12:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-postgres-server start</span></li>

        <li>Start Qpid server server on machines 4, 5, 10, and 11:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service edge-qpid-server start</span></li>

        <li>Configure Postgres as a standby node by running the following commands on machine
        12:<br>
        <span style="font-family:courier new,courier,monospace;">&gt; cd
        /opt/apigee/data/apigee-postgresql/pgdata<br>
        &gt; rm -rf *<br>
        &gt; /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        setup-replication-on-standby -f </span><em style=
        "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

        <li>Verify the replication status by issuing the following scripts on both servers. The
        system should display identical results on both servers to ensure a successful
        replication:<br>
        On the machine 6, the master node, run:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-master</span><br>
        <br>
        Validate that it says it is the master.<br>
        <br>
        On machine 12, the standby node:<br>
        <span style="font-family:courier new,courier,monospace;">&gt;
        /opt/apigee/apigee-service/bin/apigee-service apigee-postgresql
        postgres-check-standby</span><br>
        <br>
        Validate that it says it is the standby.</li>
      </ol>
    </li>

    <li>Update Edge components on machine 6 and 12:<br>
    <span style="font-family:courier new,courier,monospace;">&gt;
    /opt/apigee/apigee-setup/bin/update.sh -c edge -f </span><em style=
    "font-family: &quot;courier new&quot;, courier, monospace;"><strong>configFile</strong></em></li>

    <li>Ensure that you decommission the new standby node by using the procedure above in <a href=
    "#requiredupgradetopostgres96-decommissioningapostgresnode">Decommissioning a Postgres
    node</a>.</li>
  </ol>

  <h3 id="orderofmachineupdate-fora7hostor10hostapibaasinstallation">For a 7-host or 10-host API
  BaaS installation</h3>

  <aside class="note"><b>Note:</b> The procedure to update a 4.16.01 or 4.16.05 version of API BaaS
  to 4.18.01 is the same as the procedure to update a 4.16.09 version. See <a href=
  "update-apigee-edge-41609-41801.html">Update Apigee Edge 4.16.09 to 4.18.01</a>.</aside>

  <h3 id="orderofmachineupdate-foranonstandardinstallation">For a non-standard installation</h3>

  <p>If you have a non-standard installation, then update Edge components in the following
  order:</p>

  <ol>
    <li>ZooKeeper</li>

    <li>Cassandra</li>

    <li>qpidd</li>

    <li>LDAP</li>

    <li>Edge, meaning the "-c edge" profile on all nodes in the order: nodes with Qpid server but
    not the Postgres server, Management Server, Message Processor, and Router. <br>
    <strong>Note</strong>: If the node has both Qpid server and Postgres server installed, run the
    "-c edge" profile step as part of step 8.</li>

    <li>Edge UI</li>

    <li>postgresql on the Postgres master, including upgrade.</li>

    <li>postgresql on the Postgres standby.</li>

    <li>Edge, meaning the "-c edge" profile on all combined Qpid and Postgres nodes, or on any
    standalone Postgres nodes.</li>
  </ol>

  

  <div>
     
  </div>{% endblock %}
