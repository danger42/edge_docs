{% extends "private-cloud/v4.18.01/_base.html" %}
{% block title %}Monitoring Dashboard Installation (Beta){% endblock %}
{% block body %}

  <aside class="note"><strong>Note:</strong> If you performed an All-In-One (AIO) Edge installation, where
  you install all Edge components on a single node, then you already installed the RPM files for
  the dashboard. Therefore, you can skip step 1, the install step, of the procedures below and
  proceed directly to step 2. </aside>

  <h2 id="systemrequirements">System requirements</h2>

  <p>You must install <code>apigee-telegraf</code> on all the Edge nodes to
  collect dashboard data. Therefore, the system requirements for <code>apigee-telegraf</code> are
  the same as for the Edge
  node on which you are installing it.</p>

  <p>You can install <code>apigee-grafana</code>
  on a separate node, or reuse one of the existing Edge nodes such as the Management Server or Edge
  UI node. </p>

  <p>For <code>apigee-influxdb</code>, you can
  install it on an existing Edge node, such as the Management Server node or the Edge UI node, with
  no change to the system requirements.</p>

  <p>If you decide to install <code>apigee-influxdb</code> on its own node for
  performance reasons, then the node should have the following requirements:</p>

  <ul>
    <li>2 core CPU</li>

    <li>4 GB RAM</li>

    <li>250GB disk space (monitoring data purged after 1 month)</li>

    <li>1000 or more IOPS</li>
  </ul>

  <p>See the
  <a href="https://docs.influxdata.com/influxdb/v0.11/guides/hardware_sizing/#general-hardware-guidelines-for-clusters" class="external">InfluxData doc</a>
  for more information.</p>

  <h2 id="portrequirementsforapigeeinfluxdb">Port requirements for apigee-influxdb</h2>

  <p>Ports 8086 and 8183 must be open on the <code>apigee-influxdb</code> data nodes for access by the
  node running <code>apigee-grafana</code> and
  <code>apigee-telegraf</code>.</p>

  <h2 id="configfilesforinstallingdashboardcomponents">Config files for installing dashboard
  components</h2>

  <p>To install the <code>apigee-telegraf</code>
  and <code>apigee-grafana</code> components,
  you pass a config file to the <code>apigee-service</code> utility. Store these files in
  a directory accessible by the 'apigee' user, such as <code>/opt/apigee/customer/application</code>,
  and make them owned by the 'apigee' user.</p>

  <h3 id="configfilesforinstallingdashboardcomponents-configurationparametersforapigeetelegraf">
  Configuration parameters for apigee-telegraf</h3>

  <p>Set these properties in a text file that you pass to the <code>apigee-telegraf setup</code>
  command. For example, set them in a text file named <code>sa_telegraf.txt</code>:</p>

  <table>
    <thead>
      <tr>
        <th>
          <p><strong>Property</strong></p>
        </th>

        <th>
          <p><strong>Description</strong></p>
        </th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td>
          <p><code>INFLUXDB_URL</code></p>
        </td>

        <td>
          <p>Specify the URL of the apigee-influxdb node, including port 8086. For example:</p>
          <pre>http://192.168.0.1:8086</pre>
        </td>
      </tr>
    </tbody>
  </table>

  <h3 id="configfilesforinstallingdashboardcomponents-configurationparametersforapigeegrafana">
  Configuration Parameters for apigee-grafana</h3>

  <p>Set these properties in a text file that you pass to the <code>apigee-grafana setup</code>
  command. For example, set them in a text file named <code>sa_grafana.txt</code>:</p>

  <table>
    <thead>
      <tr>
        <th>
          <p><strong>Property</strong></p>
        </th>

        <th>
          <p><strong>Description</strong></p>
        </th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td>
          <p><code>INFLUXDB_HOST</code></p>
        </td>

        <td>
          <p>Specify the IP address or DNS name of the InfluxDB node. For Example:</p>
          <pre>192.168.0.1</pre>
        </td>
      </tr>

      <tr>
        <td>
          <p><code>INFLUXDB_PORT</code></p>
        </td>

        <td>
          <p>InfluxDB API port used by Grafana datasource. Specify 8086.</p>
        </td>
      </tr>

      <tr>
        <td>
          <p><code>GRAFANA_USERNAME</code></p>
        </td>

        <td>
          <p>Grafana username for logging in to the dashboard UI.</p>
        </td>
      </tr>

      <tr>
        <td>
          <p><code>GRAFANA_PASSWORD</code></p>
        </td>

        <td>
          <p>Grafana password for logging in to the dashboard UI.</p>
        </td>
      </tr>
    </tbody>
  </table>

  <h2 id="installationinstructions">Installation instructions</h2>

  <p>Follow the instructions below to install the dashboard components in this sequence:</p>

  <ul>
    <li><code>apigee-influxdb</code> (on a central node)</li>

    <li><code>apigee-telegraf</code> (on each node)</li>

    <li><code>apigee-grafana</code> (on a central server)</li>
  </ul>

  <aside class="note"><b>Note:</b> You must have installed the apigee-service utility on an Edge
  node to install the dashboard components. For more information on the <code>apigee-service</code>
  utility, including installation instructions for the utility, see
  <a href="install-edge-apigee-setup-utility">Install the Edge apigee-setup utility</a>.</aside>

  <h3 id="installationinstructions-installapigeeinfluxdbonasingleedgenodeorstandalonenode">Install
  apigee-influxdb on a single Edge node or standalone node</h3>

  <p>On a standalone node, or an Edge node running the Management Server or Edge UI:</p>

  <ol>
    <li>Install <code>apigee-influxdb</code>:
    <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-influxdb install</pre></li>

    <li>Configure the <code>apigee-influxdb</code> database:
    <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-influxdb setup</pre></li>

    <li>Start <code>apigee-influxdb</code>:
    <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-influxdb start</pre></li>
  </ol>

  <h3 id="installationinstructions-installapigeetelegrafoneveryedgenode">Install apigee-telegraf on
  every Edge node</h3>

  <p>On every node of your Edge installation:</p>

  <ol>
    <li>On your first Edge node, install <code>apigee-telegraf</code>:
      <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf install</pre>
    </li>

    <li>Create a config file for <code>apigee-telegraf</code> named
      <code>sa_telegraf.txt</code>. Typically, you store this file in a directory accessible by the
      'apigee' user, such as <code>/opt/apigee/customer/application</code>,
      and make it owned by the 'apigee' user.
      <p>Set the following property in the file to specify the URL of the apigee-influxdb node,
      including port 8086:
      <pre>INFLUXDB_URL=http://influx_IP:8086</pre>
    </li>

    <li>Change the owner to 'apigee':
      <pre>&gt; chown apigee:apigee /opt/apigee/customer/application/sa_telegraf.txt</pre>
    </li>

    <li>Configure <code>apigee-telegraf</code>:
      <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf setup -f
    /opt/apigee/customer/application/sa_telegraf.txt</pre>
    </li>

    <li>Restart <code>apigee-telegraf</code>:
    <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf restart</pre></li>

    <li>Repeat this process on all Edge nodes.</li>
  </ol>

  <h3 id="installationinstructions-installapigeegrafanaonasingleedgenode">Install apigee-grafana on
  a single Edge node</h3>

  <p>On a single node of your Edge installation, such as the Edge UI node:</p>

  <ol>
    <li>On your first Edge node, install <code>apigee-grafana</code>:
      <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-grafana install</pre>
    </li>

    <li>Create a config file for <code>apigee-grafana</code> named <code>sa_grafana.txt</code>.
      Typically, you store this file in a directory accessible by the 'apigee' user, such as
      <code>/opt/apigee/customer/application</code>, and make it owned by the 'apigee' user.
      <p>Set the following properties in the file. These properties are described above:</p>
      <pre>INFLUXDB_HOST=192.168.56.101
INFLUXDB_PORT=8086
GRAFANA_USERNAME=admin
GRAFANA_PASSWORD=admin</pre>
    </li>

    <li>Change the owner to 'apigee':
    <pre>&gt; chown apigee:apigee /opt/apigee/customer/application/sa_grafana.txt</pre></li>

    <li>Configure <code>apigee-grafana</code>
      using the config file:
      <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-grafana setup -f
    /opt/apigee/customer/application/sa_grafana.txt</pre></li>

    <li>Restart <code>apigee-grafana</code>:
      <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-grafana restart</pre></li>
  </ol>

  <p>To access the dashboard, open the following URL in a browser:</p>

  <pre>http://<var>grafana_IP_or_DNS</var>:3000</pre>

  <p>Log in by using the credentials you specified in the config file for
  <code>apigee-grafana</code>. In the example shown above
  the username/password is admin/admin.</p>

  <h2 id="troubleshootinginstallation">Troubleshooting installation</h2>

  <p>If you do not see data appearing in the dashboard, use the following procedure to troubleshoot
  your installation:</p>

  <ol>
    <li>To ensure <code>apigee-telegraf</code>
    is collecting the data

      <ol>
        <li>Run the <code>apigee-service apigee-telegraf setup</code>, it's idempotent, check for
        errors, missing dependencies and resolve them.</li>

        <li>Restart <code>apigee-telegraf</code> and check
        <code>/opt/apigee/var/log/apigee-telegraf/apigee-telegraf.log</code> for any errors</li>
      </ol>
    </li>

    <li>To ensure <code>apigee-influxdb</code> is receiving data:

      <ol>
        <li>Make sure following TCP ports are open on <code>apigee-influxdb</code> data nodes:
          8086 and 8183.</li>

        <li>Use the following URL to open the influxdb UI in a browser:
          <pre>http://<var>influxdb_IP_or_DNS</var>:8183</pre>

          <ol>
            <li>In the Query field, enter "show databases". Ensure that the following databases
            were created: <code>system, application, events, _internal</code>.</li>

            <li>In the Query field, enter "show servers". Ensure that you see the
              <code>apigee-influxdb</code> nodes are listed.</li>
          </ol>
        </li>
      </ol>
    </li>

    <li>Check the data sources to the dashboard:

      <ol>
        <li>Select <strong>Data Sources</strong> in the main menu. You should see icons for three
        data sources displayed.</li>

        <li>For each data source, select the icon.</li>

        <li>In the details page for the data source, select the <strong>Save &amp; Test</strong>
        button. </li>

        <li>If the data source is configured correctly, you should see a message in the form:<br>
        <strong>Success<br>
        Data source is working </strong></li>
      </ol>
    </li>
  </ol>

  <h2 id="updatingthebetamonitoringdashboard">Updating the Beta monitoring dashboard</h2>

  <p>Use one of the two procedures below based on the Edge version that you are upgrading from:</p>

  <ul>
    <li>4.16.09 and 4.17.0x use the same procedure</li>

    <li>4.16.05 requires you to uninstall <code>apigee-collectd</code> as part of the update.</li>
  </ul>

  <h3 id="updatingthebetamonitoringdashboard-updatefromversion41609or4170x">Update from version
  4.16.09 or 4.17.0x</h3>

  <p>If you installed the Beta version of the Apigee Monitoring Dashboard in 4.16.09 or 4.17.0x you
  can update it to the Beta version for 4.18.01.</p>

  <p>To update the Beta monitoring dashboard:</p>

  <ol>
    <li>Update Edge to 4.18.01 as described at <a href="/private-cloud/v4.17.09/update-apigee-edge-4170141705-41709.html">Update Apigee Edge
    4.17.01/4.17.05 to 4.17.09</a>, <a href="/private-cloud/v4.17.09/update-apigee-edge-41609-41709.html">Update Apigee Edge 4.16.09 to
    4.17.09</a>, and <a href="/private-cloud/v4.17.09/update-apigee-edge-4160141605-41709.html">Update Apigee Edge 4.16.01/4.16.05 to 4.17.09</a>.</li>

    <li>Update <code>apigee-influxdb</code> on
      the Management Server node:
      <pre>&gt; /opt/apigee/apigee-setup/bin/update.sh -c pp -f <var>configfile</var></pre>
      <p>where <var>configFile</var> is the config file you used to install
      <code>apigee-influx</code>.
      <p>If you also installed <code>apigee-grafana</code> on the Management
      Server node, then this step also updates <code>apigee-grafana</code>. Otherwise, update
      <code>apigee-granfana</code> as shown in the following step.</p>
    </li>

    <li><strong>If you did not install <code>apigee-grafana</code> on the
      Management Server node</strong>, update <code>apigee-grafana</code> on the node where you
      installed it:
      <pre>&gt; /opt/apigee/apigee-setup/bin/update.sh -c pp -f <var>configfile</var></pre>
    </li>

    <li>Update <code>apigee-telegraf</code> on
    node 1:
    <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf update
&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf setup -f <var>configFile</var>
&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf restart</pre></li>

    <li>Repeat step 4 for every node.</li>
  </ol>

  <h3 id="updatingthebetamonitoringdashboard-updatefromversion41605">Update from version 4.16.05 </h3>

  <p>The 4.16.05 version of the dashboard used <code>apigee-collectd</code> instead of
  <code>apigee-telegraf</code>. As part of updating to 4.18.01 you uninstall
  <code>apigee-collectd</code> and install <code>apigee-telegraf</code>.</p>

  <p>To update the Beta monitoring dashboard:</p>

  <ol>
    <li>Update Edge to 4.18.01 as described at
    <a href="/private-cloud/v4.17.01/update-apigee-edge-4160141605-41701.html">Update Apigee Edge
    4.16.01/4.16.05 to 4.17.01</a> and
    <a href="/private-cloud/v4.17.01/update-apigee-edge-41701.html">Update Apigee Edge 4.16.09 to
    4.17.01</a>.</li>

    <li>Update <code>apigee-influxdb</code> on
      the Management Server node:

      <pre>&gt; /opt/apigee/apigee-setup/bin/update.sh -c pp -f <var>configfile</var></pre>

      <p>where <var>configFile</var> is the config file you used to install
      <code>apigee-influx</code>.
      <p>If you also installed <code>apigee-grafana</code> on the Management
      Server node, then this step also updates <code>apigee-grafana</code>. Otherwise, update
      <code>apigee-granfana</code> as shown in the following step.</p>
    </li>

    <li><strong>If you did not install <code>apigee-grafana</code> on the
      Management Server node</strong>, update <code>apigee-grafana</code> on the node where you
      installed it:
      <pre>&gt; /opt/apigee/apigee-setup/bin/update.sh -c pp -f <var>configfile</var></pre>
    </li>

    <li>Install <code>apigee-telegraf</code> on node 1:
      <pre>&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-collectd stop
&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf install
&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf setup -f <var>configFile</var>
&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-telegraf restart
&gt; /opt/apigee/apigee-service/bin/apigee-service apigee-collectd uninstall</pre>
    </li>

    <li>Repeat step 4 for every node.</li>
  </ol>

{% endblock %}
