<!DOCTYPE html>
<html devsite>
  <head>
    <title>JSON Threat Protection Policy Error Codes</title>
  </head>
  <body>

  <p>This section describes the error messages and flow variables that are set when this policy
  triggers an error. This information is important to know if you are developing fault rules for a
  proxy. To learn more, see <a href=
  "/api-platform/fundamentals/what-you-need-know-about-policy-errors.html">What you need to know
  about policy errors</a> and <a href="/api-platform/fundamentals/fault-handling.html">Handling
  faults</a>.</p>

  <h3>Runtime errors</h3>

  <p>These errors can occur when the policy executes.</p>

  <table>
    <thead>
      <tr>
        <th scope="col" width="263">Error name</th>

        <th scope="col" width="405">Fault string</th>

        <th scope="col" width="49">HTTP status</th>

        <th scope="col" width="403">Occurs when</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><code><!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'jsonthreatprotection.ExceededContainerDepth'}">ExceededContainerDepth</span></code></td>

        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded container depth at line {1}'}">JSONThreatProtection</span>[policy_name]<span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded container depth at line {1}'}">: Exceeded
        container depth at line [line_num]</span></code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'jsonthreatprotection.ExceededObjectEntryCount'}">ExceededObjectEntryCount</span></code></td>

        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded object entry count at line {1}'}">JSONThreatProtection</span>[policy_name]<span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded object entry count at line {1}'}">:
        Exceeded object entry count at line</span> [line_num]</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'jsonthreatprotection.ExceededArrayElementCount'}">ExceededArrayElementCount</span></code></td>

        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded array element count at line {1}'}">JSONThreatProtection</span>[policy_name]<span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded array element count at line {1}'}">:
        Exceeded array element count at line</span> [line_num]</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'jsonthreatprotection.ExceededObjectEntryNameLength'}">ExceededObjectEntryNameLength</span></code></td>

        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded object entry name length at line {1}'}">JSONThreatProtection</span>[policy_name]<span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded object entry name length at line {1}'}">:
        Exceeded object entry name length at line</span> [line_num]</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'jsonthreatprotection.ExceededStringValueLength'}">ExceededStringValueLength</span></code></td>

        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded string value length at line {1}'}">JSONThreatProtection</span>[policy_name]<span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Exceeded string value length at line {1}'}">:
        Exceeded string value length at line</span> [line_num]</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'jsonthreatprotection.SourceUnavailable'}">SourceUnavailable</span></code></td>

        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]:: Source {1} is not available'}">JSONThreatProtection[policy_name]:
        Source [var_name] is not available</span></code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'jsonthreatprotection.NonMessageVariable'}">NonMessageVariable</span></code></td>

        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Variable {1} does not resolve to a Message'}">JSONThreatProtection[policy_name]:
        Variable [var_name] does not resolve to a Message</span></code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'jsonthreatprotection.ExecutionFailed'}">ExecutionFailed</span></code></td>

        <td>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'JSONThreatProtection[{0}]: Execution failed. reason: {1}'}"><code>JSONThreatProtection[policy_name]:
        Execution failed. reason: [string]</code></span></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>
    </tbody>
  </table>

  <h3>Deployment errors</h3>

  <p>None.</p>

  <h3>Fault variables</h3>

  <p>These variables are set when this policy triggers an error. For more information, see <a href=
  "/api-platform/fundamentals/what-you-need-know-about-policy-errors.html">What you need to know
  about policy errors</a>.</p>

  <table>
    <tbody>
      <tr>
        <th width="324">Variables set <code><span style="font-size: 10pt">(<a href=
        "/api-platform/fundamentals/what-you-need-know-about-policy-errors.html">Learn
        more</a>)</span></code></th>

        <th width="428">Where</th>

        <th width="428">Example</th>
      </tr>

      <tr>
        <td width="324"><code>[prefix].[policy_name].failed</code></td>

        <td width="428"><code>[prefix]: jsonattack</code><br>
        <code>[policy_name]:</code> The name of the policy to check.</td>

        <td width="428"><code>jsonattack.JTP-SecureRequest.failed = true</code></td>
      </tr>

      <tr>
        <td><code>fault.name = [error_name]</code></td>

        <td><code>[error_name]</code> = The specific error name to check for as listed in the table
        above.</td>

        <td><code>fault.name Matches "SourceUnavailable"</code></td>
      </tr>
    </tbody>
  </table>

  <h3>Example error response</h3>
  <pre class="prettyprint">
{
  "fault": {
    "faultstring": "JSONThreatProtection[JPT-SecureRequest]: Execution failed. reason: JSONThreatProtection[JTP-SecureRequest]: Exceeded object entry name length at line 2",
    "detail": {
      "errorcode": "steps.jsonthreatprotection.ExecutionFailed"
    }
  }
}
</pre>

  <h3>Example fault rule</h3>
  <pre class="prettyprint">
&lt;FaultRule name="JSON Threat Protection Policy Faults"&gt;
    &lt;Step&gt;
        &lt;Name&gt;AM-CustomErrorResponse&lt;/Name&gt;
        &lt;Condition&gt;(fault.name Matches "ExecutionFailed") &lt;/Condition&gt;
    &lt;/Step&gt;
    &lt;Condition&gt;(jsonattack.JPT-SecureRequest.failed = true) &lt;/Condition&gt;
&lt;/FaultRule&gt;<span style="white-space: normal;">
</span>
</pre>
  </body>
</html>
