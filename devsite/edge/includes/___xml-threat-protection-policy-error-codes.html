<!DOCTYPE html>
<html devsite>
  <head>
    <title>XML Threat Protection Policy Error Codes</title>
  </head>
  <body>
  <p>This section describes the error messages and flow variables that are set when this policy
  triggers an error. This information is important to know if you are developing fault rules for a
  proxy. To learn more, see <a href=
  "/api-platform/fundamentals/what-you-need-know-about-policy-errors.html">What you need to know
  about policy errors</a> and <a href="/api-platform/fundamentals/fault-handling.html">Handling
  faults</a>.</p>

  <h3>Error code prefix</h3>

  <p><code>steps.xmlthreatprotection</code> <span style="font-size: 10pt">(<a href=
  "/api-platform/fundamentals/what-you-need-know-about-policy-errors.html#aboutthedefaultpolicyerrorresponse">What's
  this?</a>)</span></p>

  <h3>Runtime errors</h3>

  <p>These errors can occur when the policy executes.</p>

  <table>
    <thead>
      <tr>
        <th scope="col" width="230">* Error name</th>

        <th scope="col" width="541">Fault string</th>

        <th scope="col" width="79">* HTTP status</th>

        <th scope="col" width="281">Cause</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><code><!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.NodeDepthExceeded'}">NodeDepthExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Node depth exceeded {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code><!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.AttrCountExceeded'}">AttrCountExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Attribute count exceeded {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.ChildCountExceeded'}">ChildCountExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Children count exceeded {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.NSCountExceeded'}">NSCountExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Namespace count exceeded {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.ElemNameExceeded'}">ElemNameExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Element name length exceeded
        {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code><!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.AttrNameExceeded'}">AttrNameExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Attribute name length exceeded
        {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code><!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.AttrValueExceeded'}">AttrValueExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Attribute value length exceeded
        {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code><!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}-->
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.NSPrefixExceeded'}">NSPrefixExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Namespace prefix length exceeded
        {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.NSURIExceeded'}">NSURIExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Namespace uri length exceeded
        {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.PITargetExceeded'}">PITargetExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Processing Instruction target length
        exceeded {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.PIDataExceeded'}">PIDataExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Processing Instruction data length
        exceeded {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.CommentExceeded'}">CommentExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Comment length exceeded {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.TextExceeded'}">TextExceeded</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Text length exceeded {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.SourceUnavailable'}">SourceUnavailable</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Source {1} is not available</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.NonMessageVariable'}">NonMessageVariable</span></code></td>

        <td><code>Variable {0} does not resolve to a Message</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>

      <tr>
        <td><code>
        <!--td {border: 1px solid #ccc;}br {mso-data-placement:same-cell;}--><span data-sheets-userformat="{'2':513,'3':{'1':0},'12':0}"
        data-sheets-value=
        "{'1':2,'2':'xmlthreatprotection.ExecutionFailed'}">ExecutionFailed</span></code></td>

        <td><code>XMLThreatProtection stepDefinition {0}: Execution failed. reason: {1}</code></td>

        <td>500</td>

        <td>See fault string.</td>
      </tr>
    </tbody>
  </table>

  <p><strong>* Notes:</strong></p>

  <ul>
    <li>The error name ExecutionFailed is the default error name and will be returned regardless of
    the type of error detected; however, this default can be changed by setting an
    organization-level property. When this property is set, the error name will reflect the actual
    error. For example, "TextExceeded" or "AttrValueExceeded". See the Usage Notes for
    details.</li>

    <li>The 500 HTTP status is the default; however, the HTTP Status can be changed to 400 for
    request flow faults by setting an organization-level property. See the Usage Notes for
    details.</li>
  </ul>

  <h3>Deployment errors</h3>

  <p>None.</p>

  <h3>Fault variables</h3>

  <p>These variables are set when a runtime error occurs. For more information, see <a href=
  "/api-platform/fundamentals/what-you-need-know-about-policy-errors.html">What you need to know
  about policy errors</a>.</p>

  <table>
    <tbody>
      <tr>
        <th width="265">Variables set <code><span style="font-size: 10pt">(<a href=
        "/api-platform/fundamentals/what-you-need-know-about-policy-errors.html">Learn
        more</a>)</span></code></th>

        <th width="468">Where</th>

        <th width="342">Example</th>
      </tr>

      <tr>
        <td width="265"><code>[prefix].[policy_name].failed</code></td>

        <td width="468">The <code>[prefix]</code> is <code><strong>xmlattack</strong>.</code><br>
        The <code>[policy_name]</code> is the name of the policy that threw the error.</td>

        <td width="342"><code>xmlattack.XPT-SecureRequest.failed = true</code></td>
      </tr>

      <tr>
        <td><code>fault.name = [error_name]</code></td>

        <td><code>[error_name]</code> = The specific error name to check for as listed in the table
        above.</td>

        <td><code>fault.name Matches "SourceUnavailable"</code></td>
      </tr>
    </tbody>
  </table>

  <h3>Example error response</h3>

  <aside class="note"><b>Note:</b> For error handling, the best practice is to trap the
  <code>errorcode</code> part of the error response. Do not rely on the text in the
  <code>faultstring</code>, because it could change.</aside>
  <pre class="prettyprint">
{
  "fault": {
    "faultstring": "XMLThreatProtection[XPT-SecureRequest]: Execution failed. reason: XMLThreatProtection[XTP-SecureRequest]: Exceeded object entry name length at line 2",
    "detail": {
      "errorcode": "steps.xmlthreatprotection.ExecutionFailed"
    }
  }
}
</pre>

  <h3>Example fault rule</h3>
  <pre class="prettyprint">
&lt;FaultRule name="XML Threat Protection Policy Faults"&gt;
    &lt;Step&gt;
        &lt;Name&gt;AM-CustomErrorResponse&lt;/Name&gt;
        &lt;Condition&gt;(fault.name Matches "ExecutionFailed") &lt;/Condition&gt;
    &lt;/Step&gt;
    &lt;Condition&gt;(xmlattack.XPT-SecureRequest.failed = true) &lt;/Condition&gt;
&lt;/FaultRule&gt;
</pre>
  </body>
</html>
