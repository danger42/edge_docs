<!DOCTYPE html>
<html devsite>
  <head>
    <title>JavaScript Policy Error Codes</title>
  </head>
  <body>

  <p>This section describes the fault codes and error messages that are returned and fault variables
    that are set by Edge when this policy triggers an error. This information is important to know
    if you are developing fault rules to
  handle faults. To learn more, see <a href="/api-platform/fundamentals/what-you-need-know-about-policy-errors.html">What you need to know
  about policy errors</a> and <a href="/api-platform/fundamentals/fault-handling.html">Handling
  faults</a>.</p>

  <h3>Runtime errors</h3>

  <p>These errors can occur when the policy executes.</p>
        <aside class="key-point">Need help resolving an error? Click <i class="material-icons" title="Click this icon in the error table to visit the troubleshooting page.">build</i> in the Fix column for detailed troubleshooting information.
  <p>Use <a href="/api-monitoring">API Monitoring</a> to investigate fault codes and diagnose issues faster.</p></aside>


  <table>
    <thead>
      <tr>
        <th scope="col" width="277">Fault code</th>

        <th scope="col" width="49">HTTP status</th>

        <th scope="col" width="863">Cause</th>
        <th scope="col" width="63">Fix</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><code>steps.javascript.ScriptExecutionFailed</code></td>

        <td>500</td>

        <td>The JavaScript policy can throw many different types of ScriptExecutionFailed errors. Commonly
        seen types of errors include <a href="/api-platform/troubleshoot/policies/runtime/javascript-runtime-errors#range_error">RangeError</a>,
          <a href="/api-platform/troubleshoot/policies/runtime/javascript-runtime-errors#reference_error">ReferenceError</a>,
          <a href="/api-platform/troubleshoot/policies/runtime/javascript-runtime-errors#syntax_error">SyntaxError</a>,
          <a href="/api-platform/troubleshoot/policies/runtime/javascript-runtime-errors#type_error">TypeError</a>, and
          <a href="/api-platform/troubleshoot/policies/runtime/javascript-runtime-errors#uri_error">URIError</a>. </td>
        <td><a href="/api-platform/troubleshoot/policies/runtime/javascript-runtime-errors#scriptexecutionfailed"><i class="material-icons" title="Troubleshoot this error.">build</i></a></td>

      </tr>

      <tr>
        <td><code>steps.javascript.ScriptExecutionFailedLineNumber</code></td>

        <td>500</td>

        <td>An error occurred in the JavaScript code. See the fault string for details.</td>
        <td>N/A</td>
      </tr>

      <tr>
        <td><code>steps.javascript.ScriptSecurityError</code></td>

        <td>500</td>

        <td>A security error occurred when the JavaScript executed. See the fault string for
        details.</td>
        <td>N/A</td>

      </tr>
    </tbody>
  </table>

  <h3>Deployment errors</h3>

  <p>These errors can occur when you deploy a proxy containing this policy.</p>

    <aside class="key-point">Need help resolving an error? Click
  <i class="material-icons" title="Click this icon in the error table to visit the troubleshooting page.">build</i>
  next to the error's cause description to visit the troubleshooting page. </aside>

  <table>
   <thead>
      <tr>
        <th scope="col" width="523">Error name</th>
        <th scope="col" width="863">Cause</th>
        <th scope="col" width="63">Fix</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><code>InvalidResourceUrlFormat</code></td>

        <td>If the format of the resource URL specified within the <code>&lt;ResourceURL&gt;</code> or the <code>&lt;IncludeURL&gt;</code> element of the JavaScript policy is invalid, then the deployment of the API proxy fails.</td>
        <td><a href="/api-platform/troubleshoot/policies/deployment/javascript-deployment-errors#invalidresourceurlformat"><i class="material-icons" title="Troubleshoot this error.">build</i></a></td>
      </tr>

      <tr>
        <td><code>InvalidResourceUrlReference</code></td>

        <td>If the <code>&lt;ResourceURL&gt;</code> or the <code>&lt;IncludeURL&gt;</code> elements
          refer to a JavaScript file that does not exist, then the deployment of the API proxy fails.
          The referenced source file must exist either the API proxy, environment, or organization level.</td>
        <td><a href="/api-platform/troubleshoot/policies/deployment/javascript-deployment-errors#invalidresourceurlreference"><i class="material-icons" title="Troubleshoot this error.">build</i></a></td>
      </tr>

      <tr>
        <td><code>WrongResourceType</code></td>

        <td>This error occurs during deployment if the <code>&lt;ResourceURL&gt;</code> or the <code>&lt;IncludeURL&gt;</code>
          elements of the JavaScript policy refer to any resource type other than <b>jsc</b> (JavaScript file).</td>
        <td><a href="/api-platform/troubleshoot/policies/deployment/javascript-deployment-errors#wrongresourcetype"><i class="material-icons" title="Troubleshoot this error.">build</i></a></td>
      </tr>
      <tr>
        <td><code>NoResourceURLOrSource</code></td>

        <td>The deployment of the JavaScript policy can fail with this error if the <code>&lt;ResourceURL&gt;</code>
          element is not declared or if the resource URL is not defined within this element.
          <code>&lt;ResourceURL&gt;</code> element is a mandatory element. Or, The <code>&lt;IncludeURL&gt;</code> element is declared
          but the resource URL is not defined within this element. The <code>&lt;IncludeURL&gt;</code> element is optional
          but if declared, the resource URL must be specified within the <code>&lt;IncludeURL&gt;</code> element.</td>
        <td><a href="/api-platform/troubleshoot/policies/deployment/javascript-deployment-errors#noresourceurlorsource"><i class="material-icons" title="Troubleshoot this error.">build</i></a></td>
      </tr>
    </tbody>
  </table>

  <h3>Fault variables</h3>

  <p>These variables are set when this policy triggers an error at runtime. For more information,
  see <a href="/api-platform/fundamentals/what-you-need-know-about-policy-errors.html">What you
  need to know about policy errors</a>.</p>

      <table>
    <tbody>
      <tr>
        <th width="324">Variables</th>

        <th width="428">Where</th>

        <th width="428">Example</th>
      </tr>
      <tr>
        <td><code>fault.name="<var>fault_name</var>"</code></td>

        <td><var>fault_name</var> is the name of the fault, as listed in the <a href="#runtime-errors">Runtime errors</a> table above. The fault name is the last part of the fault code.</td>

        <td><code>fault.name Matches "ScriptExecutionFailed"</code></td>
      </tr>

      <tr>
        <td width="324"><code>javascript.<var>policy_name</var>.failed</code></td>

        <td width="428"><var>policy_name</var> is the user-specified name of the policy that threw the fault.</td>

        <td width="428"><code>javascript.JavaScript-1.failed = true</code></td>
      </tr>


    </tbody>
  </table>

  <h3>Example error response</h3>

  <aside class="note"><b>Note:</b> For error handling, the best practice is to trap the
  <code>errorcode</code> part of the error response. Do not rely on the text in the
  <code>faultstring</code>, because it could change.</aside>
  <pre class="prettyprint">
{
  "fault": {
    "faultstring": "Execution of SetResponse failed with error: Javascript runtime error: "ReferenceError: "status" is not defined. (setresponse.js:6)\"",
    "detail": {
      "errorcode": "steps.javascript.ScriptExecutionFailed"
    }
  }
}
</pre>

  <h3>Example fault rule</h3>
  <pre class="prettyprint">
&lt;FaultRule name="JavaScript Policy Faults"&gt;
    &lt;Step&gt;
        &lt;Name&gt;AM-CustomErrorResponse&lt;/Name&gt;
        &lt;Condition&gt;(fault.name Matches "ScriptExecutionFailed") &lt;/Condition&gt;
    &lt;/Step&gt;
    &lt;Condition&gt;(javascript.JavaScript-1.failed = true) &lt;/Condition&gt;
&lt;/FaultRule&gt;
</pre>
  </body>
  </html>
