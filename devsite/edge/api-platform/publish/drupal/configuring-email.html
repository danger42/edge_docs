  {% extends "_base.html" %} {% block title %}Configuring email{% endblock %} {% block body %}

  <p>By default, the Developer Services portal sends emails in response to certain events. For
  example, when a new developer registers on the portal, the portal automatically sends a welcome
  email to the developer. Or, if the developer loses their password, the developer can request an
  email with a temporary password. </p>

  <p>As an API provider, you can control all aspects of the emails generated by the portal,
  including:</p>

  <ul>
    <li>Formatting the automated emails sent by the portal</li>

    <li>Specifying the SMTP server used by the portal</li>

    <li>Adding rules to generate emails in response to events on the portal</li>
  </ul>

  <h2 id="sendingemailfromacloudbasedportal">Sending email from a cloud-based portal</h2>

  <p>The default email configuration for a cloud-based portal deployed on Pantheon or Acquia should
  only be used in non-production environments. Email sent from an anonymous cloud server may be
  blocked or marked as spam.</p>

  <p>For production portals, use one of the following options for sending email:</p>

  <ul>
    <li>Use the SMTP module, routing email to your company SMTP server as described in <a href=
    "#smtp">Configuring an SMTP server</a>.</li>

    <li>Use an external mail service such as SendGrid or Amazon SES (Simple Email Service). For
    more information, see:

      <ul>
        <li>Pantheon: <a href="https://www.getpantheon.com/docs/articles/sites/code/email/" target=
        "_blank">Email on Pantheon</a></li>

        <li>Acquia: <a href="https://docs.acquia.com/acquia-cloud/manage/email" target=
        "_blank">About email in Acquia Cloud applications</a></li>
      </ul>
    </li>
  </ul>

  <h2 id="sendingemailfromanonpremisesportal">Sending email from an on-premises portal</h2>

  <p>By default, mail is sent using the <a href="https://php.net/manual/en/function.mail.php">PHP
  mail()</a> function. PHP tries to send email using sendmail on the local system, which can be
  configured in PHP's <span style="font-family:courier new,courier,monospace;">php.ini</span>
  file.</p>

  <p>For production portals, you can use the SMTP module described below to send email through an
  SMTP server or company server.</p>

  <h2 id="smtp">Configuring an SMTP server</h2>

  <p>The developer portal requires that you configure an SMTP server to send email messages. To
  configure the SMTP server, you must first enable the <a href=
  "https://drupal.org/project/smtp">Drupal SMTP Authentication Support module</a> on the developer
  portal.</p>

  <p>After you configure the SMTP server, all emails sent by the developer portal use the SMTP
  server. These emails include emails sent to new developers, emails sent to developers who lose
  their password, and emails sent to developers with blocked accounts.</p>

  <p><strong>To configure the SMTP server</strong>:</p>

  <ol>
    <li>Log in to your portal as a user with admin or content creation privileges.</li>

    <li>Select <strong>Modules</strong> in the Drupal administration menu.<br>
    The Modules page opens.</li>

    <li>Enable the <strong>SMTP Authentication Support</strong> module.</li>

    <li>Save the configuration.</li>

    <li>After the module is enabled, select <strong>Configure</strong> in the SMTP Authentication
    Support entry on the Modules page.<br>
    The SMTP Authentication Support configuration page appears.</li>

    <li>Under <strong>Turn this module on or of</strong>f, select <strong>On</strong>.</li>

    <li>In the SMTP server settings area, enter the following information:

      <ul>
        <li><strong>SMTP server address</strong>. For example, for the Gmail outgoing SMTP server,
        use smtp.gmail.com.</li>

        <li>Optionally enter the <strong>backup SMTP server address</strong>. This value is not
        required.</li>

        <li>Enter the <strong>SMTP port</strong>. The value of this port can be different based on
        the selected encryption protocol. For example, for Gmail, the port is 465 when using SSL
        and 587 for TLS.</li>

        <li>Select the encryption protocol as <strong>None</strong>, <strong>SSL</strong>, or
        <strong>TLS</strong>.</li>
      </ul>
    </li>

    <li>In the <strong>SMTP Authentication</strong> area, specify the username and password used
    for SMTP authentication. This must be a valid username and password on the SMTP server.</li>

    <li>Under <strong>E-mail options</strong>, enter the email address and name of the user
    generating the email message. These values correspond to the "From" address of the email.</li>

    <li>Optionally, under <strong>Send test e-mail message</strong>, enter an email address where
    the portal sends a test message.</li>

    <li>Save the configuration.<br>
    Saving the configuration generates the test email message and displays any configuration
    errors. Check the inbox of the email address of the test message to ensure that it
    arrives.</li>

    <li>Select <strong>Configuration &gt; System &gt; Site Information</strong> in the Drupal
    administration menu.</li>

    <li>Under <strong>Site Details</strong>, set the E-mail address to the same email address as
    you specified in Step 9.<br>
    Some Drupal modules that generate emails use this field to determine the "From" address of the
    email, and not the value on the SMTP Authentication Support page.</li>

    <li>Save the configuration.</li>
  </ol>

  <h2 id="configuringandformattingemailnotifications">Configuring and formatting email
  notifications</h2>

  <p>You can configure various email notifications that are sent in response to particular
  activities such as registering, deleting, blocking, and unblocking developer accounts.</p>

  <p>You can also control the "From" address of the emails.</p>

  <p><strong>To configure email notifications:</strong></p>

  <ol>
    <li>Log in to your portal as a user with admin or content creation privileges.</li>

    <li>Select <strong>Configuration &gt; People &gt; Account settings</strong> in the Drupal
    administration menu. This opens the Account settings page.</li>

    <li>Select a type of email notification in the E-Mails section of the Accounts setting page.
    For example, you can select "Welcome (no approval required)", which sends an email when the
    developer account is automatically approved during the developer registration process.

      <p><img alt="" src="/api-platform/images/email_notify_v24.png" width="500"></p>
    </li>

    <li>Edit the <strong>Subject</strong> and <strong>Body</strong> of the email notification.<br>
    Place the cursor in a field, such as <strong>Subject</strong>, and then select the
    <strong>Browse available tokens</strong> link at the bottom of the form to see the list of
    tokens that you can use in the field. A popup appears that lets you select a token to add, such
    as <span style="font-family:courier new,courier,monospace;">[user:name]</span>, which
    corresponds to the user name of the developer.</li>

    <li>Click <strong>Save configuration</strong>.</li>
  </ol>

  <p>You can also change the "From" name and address in an email notification.</p>

  <p><strong>To change the "From" name and address:</strong></p>

  <ol>
    <li>Log in to your portal as a user with admin or content creation privileges.</li>

    <li>Select <strong>Configuration &gt; System &gt; SMTP Authentication Support</strong> in the
    Drupal administration menu. This opens the SMTP Authentication Support page.</li>

    <li>Specify a "From" email address in the <strong>E-Mail From Address</strong> field.</li>

    <li>Specify a "From" name in the <strong>E-Mail From Name</strong> field.</li>

    <li>Click <strong>Save configuration</strong>.</li>

    <li>Select <strong>Configuration &gt; System &gt; Site information</strong> in the Drupal
    administration menu.</li>

    <li>Specify the same email address that you used in Step 3 in the E-Mail Address field.</li>

    <li>Click <strong>Save configuration</strong>.</li>
  </ol>

  <h2 id="generatinganemailwhenaneventoccurs">Generating an email when an event occurs</h2>

  <aside class="note"><b>Note:</b> This example generates an email when the developer create a
  new app. You must configure rules on the portal for the email to be generated. See <a href=
  "/api-platform/publish/drupal/create-and-configure-rules.html">Create and configure rules</a> for
  more. </aside>

  <p>One common use of rules is to generate emails in response to an event. The portal has built in
  support for generating emails for predefined events, such as when a new developer registers an
  account. However, you can you can add your own rules to generate emails. For example, you can
  generate an email when the developer adds, removes, or modifies an app.</p>

  <p>This section contains an example of how create a rule to generate an email when a developer
  registers an app. Modify this procedure as necessary to generate emails for other events.</p>

  <p><strong>To generate an email when a developer creates an app:</strong></p>

  <ol>
    <li>Log in to your portal as a user with admin or content creation privileges.</li>

    <li>Select <strong>Modules</strong> in the Drupal administration menu.</li>

    <li>Ensure that the <strong>Rules UI</strong> module is enabled.</li>

    <li>Select <strong>Configuration &gt; Workflow &gt; Rules</strong> in the Drupal administration
    menu. This opens the Rules page.</li>

    <li>Select the <strong>Add a new rule</strong> button.</li>

    <li>On the new rules page, specify:

      <ul>
        <li>The rule <strong>name</strong>, for example "Send email rule".</li>

        <li>Optionally specify any <strong>tags</strong> used to categorize the rules for
        search.</li>

        <li>In the <strong>React on event</strong> dropdown, select Devconnect &gt; Upon creation
        of a developer app.</li>
      </ul>
    </li>

    <li>Save the rule.<br>
    Saving the rule opens the Rules edit form with three panes: <strong>Events</strong> (which you
    just created), <strong>Conditions</strong>, and <strong>Actions</strong>.</li>

    <li>Under <strong>Actions</strong>, select <strong>Add action</strong>.</li>

    <li>From the <strong>Select the Action to Add</strong> dropdown, select <strong>System &gt;
    send mail</strong>.<br>
    This selection opens a page that lets you format the email. Use this form to specify the "To",
    "Subject", "Message", and other fields of the email.<br>
    <br>
    Expand the <strong>Replacement</strong> patterns link under each field to see the list of
    patterns that you can use in the field. For example, if you expand Replacement patterns under
    the To field, you will see a list of patterns that includes <span style=
    "font-family:courier new,courier,monospace;">[app:developer]</span>. If you specify this
    pattern in the To field, the email is sent to the creator of the app.    </li>

    <li>Set the fields as shown below:<br>
    <img alt="" src="/api-platform/images/emailConfig_v24.png" width="503"></li>

    <li>Select <strong>Save</strong> to return to the rule editing page.</li>

    <li>Select <strong>Save</strong> <strong>changes</strong>.</li>
  </ol>

  <p>Test the rule by adding a new app on the portal. You should receive an email notification in
  response that appears as below:</p>
  <pre class="prettyprint">
Subject: App test email app created

App: test email app
API products: PremiumWeatherAPI, weatherapikey-Product
Created at: Mon, 01/27/2014 - 10:16
</pre>

  <aside class="note"><b>Note:</b> Modify this rule to send an email to an administrator when a
  developer creates an app. For example, if the app requires manual API key approval, the email can
  let the administrator know that an app is pending approval.</aside>

  {% endblock %}
