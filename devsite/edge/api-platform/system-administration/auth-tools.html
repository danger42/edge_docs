{% extends "_base.html" %}
{% block title %}About acurl and get_token{% endblock %}
{% block body %}

  <p>Apigee provides the following convenience utilities for generating and passing OAuth2 access
  and refresh tokens. You use these tokens to authenticate yourself in your management API
  calls (for the <a href="using-oauth2-security-apigee-edge-management-api">OAuth</a> or
  <a href="enabling-saml-authentication-edge">SAML</a> workflows):</p>
  <ul>
    <li><a href="using-acurl"><code>acurl</code></a>: Constructs HTTP requests to the management
      API; gets access and refresh tokens; passes the access token to the management
      API; and refreshes the access token automatically.</li>
    <li><a href="using-gettoken"><code>get_token</code></a>: Gets access and refresh tokens that
      you can use to call the management API.</li>
    <li><a href="management-api-tokens">Management API</a>: Gets access and refresh tokens that
      you can use to call the management API.</li>
  </ul>

  <p>Each of these utilities trades your Apigee account credentials (email address and password) for
  the OAuth2 tokens.</p>

  <p>The tokens created by the Apigee utilities conform to the
  <a href="https://tools.ietf.org/html/rfc6749" class="external">OAuth 2.0 Authorization Framework
  specification</a>.</p>

  <p>Using the Apigee utilities to get tokens or access the API is optional. You can implement your
  own schemes to generate OAuth2 access tokens and send them in your requests to the management
  API.</p>

<h2 id="install">Install acurl and get_token</h2>

<p>Apigee provides a ZIP file containing <code>acurl</code> and <code>get_token</code> and
an install script.</p>

<p><strong>To install <code>acurl</code> and <code>get_token</code>:</strong></p>

<ol>
  <li>Create an install directory on your machine and <code>cd</code> to the directory.</li>
  <li>Download the installation ZIP file from Apigee, as the following example shows:
    <pre class="devsite-terminal">curl https://login.apigee.com/resources/scripts/sso-cli/ssocli-bundle.zip -o "ssocli-bundle.zip"</pre>
  </li>
  <li>Unzip the downloaded file.</li>
  <li>Execute the install script, as the following example shows:
    <pre class="devsite-terminal">sudo ./install -b /usr/local/bin</pre>
    <p>The <code>-b</code> option specifies the location of the executable files. If you do not
    specify this option, the install script installs the utilities in the current directory.</p>
  </li>
  <li>Test the installations, as the following examples show:
    <pre><code class="devsite-terminal">acurl -h</code>
<code class="devsite-terminal">get_token -h</code></pre>
    <p>These commands return Help text for the utilities.</p>
  </li>
</ol>

<h2 id="expiration">Token expiration</h2>
  <p>The tokens generated by <code>acurl</code> and <code>get_token</code> have the following
  durations:</p>
  <ul>
    <li>Access tokens expire in 1,799 seconds (approximately 30 minutes)</li>
    <li>Refresh tokens expire in 84,600 seconds (approximately 24 hours)</li>
  </ul>

  <p>As a result, once you have successfully run either <code>acurl</code> or <code>get_token</code>,
  you can continue to use the tokens for about 24.5 hours. After that, you must re-enter your
  password and get new tokens.</p>

<h2 id="passcode">Use a one-time passcode</h2>

<p>When you call <code>acurl</code> or <code>get_token</code>, you must authenticate yourself to the
utility before they will return an access token. To do this, you typically pass your Apigee
account's email address and password. However, if you do not want to use your password (for example,
if it's a corporate password), you can get a one-time code passcode and use that instead.</p>

<p><strong>To get a one-time passcode:</strong></p>
<ol>
  <li>Enter the following URL in a browser: <code>https://login.apigee.com/passcode</code></li>
  <li>Log in to your Apigee account.</li>
  <li>Copy the 6-character passcode.</li>
  <li>Use <code>acurl</code> or <code>get_token</code> with the <code>-p</code> option and pass the
    passcode, as the following examples show:
    <pre class="devsite-terminal">acurl https://api.enterprise.apigee.com/v1/organization/ahamilton-test-eval \
  -u ahamilton@apigee.com:mypassw0rd <strong>-p 123456</strong>
<code class="devsite-terminal">get_token -u ahamilton@apigee.com:mypassw0rd <strong>-p 123456</strong></code></pre>
  </li>
</ol>

<h2>View your tokens</h2>

  <p>When you successfully execute <code>acurl</code> or <code>get_token</code>, the utilities
  create a data file in <code>~/.sso-cli</code> that contains the tokens and other metadata.</p>

  <p>To view the tokens, you can use a command like the following:</p>

  <pre class="devsite-terminal">cat ~/.sso-cli/access_token.dat | python -m json.tool</pre>

  <p>This command displays the data file, which looks like the following:</p>

  <pre class="prettyprint">{
    "access_token": "ey42Jh..............................................z742zHiw1t6A",
    "expires_in": 1799,
    "jti": "26368300-4242-4940-aabb-0eac692476b8",
    "refresh_token": "ey42Jh..............................................mS42YgDEh7g",
    "scope": "scim.me openid password.write approvals.me oauth.approvals",
    "token_type": "bearer"
}</pre>

<h2>Change the SSO endpoint</h2>
<p>By default, <code>acurl</code> and <code>get_token</code> generate tokens by calling the SSO
service at the following location:</p>

<pre class="prettyprint">https://login.apigee.com</pre>

<p>To use a different SSO endpoint, change the <code>SSO_LOGIN_URL</code> environment variable in
your terminal session.</p>

{% endblock %}
