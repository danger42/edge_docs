{% extends "_base.html" %}
{% block title %}Using access tokens to authenticate management API calls{% endblock %}
{% block body %}

<p>Apigee Edge allows you to make management API calls that are authenticated with either Basic
Authentication credentials or an access token. This topic explains how to generate and use
<strong>access tokens</strong> to call the management API. These tokens are generated for you by
Apigee and conform to the <a href="https://tools.ietf.org/html/rfc6749" class="external">OAuth 2.0
Authorization Framework specification</a>.</p>

<aside class="note"><strong>Note:</strong> In the future, Apigee will deprecate Basic
Authentication as a means of authenticating to the management server.</aside>

<p>This topic explains how to exchange your Edge credentials for an access token and a refresh
token that you can use to authenticate management API calls. Once you obtain an
<strong>access token</strong>, you do not need to exchange your credentials again until the token
expires. The <strong>refresh token</strong> allows you to keep your "session" with the
server alive for a longer period without providing your credentials again.</p>

<aside class="note"><strong>Note:</strong> For information on using SAML and OAuth2 tokens with Edge
for Private Cloud, see <a href="/private-cloud/latest/using-saml-edge-management-api">Using SAML
with the Edge management API</a>.</aside>

<aside class="note"><strong>Note:</strong> Apigee recommends that you enable 2-factor authentication
for your Apigee account. For details, see the article
<a href="https://community.apigee.com/articles/26487/two-factor-authentication-using-one-time-passwords.html" class="external">Two-Factor
Authentication Using One-Time Passwords</a> on the Apigee Community.</aside>

<h2 id="abouttheaccesstokenscripts">About the access token scripts</h2>

<p>Apigee provides two scripts that you can install and use to get access tokens and make
management API calls.</p>

<ul>
  <li><code>acurl</code>: Allows you to use your existing cURL-based scripts that make management
    API calls. This script retrieves an access token from Apigee and then makes a cURL call with the
    proper Authorization header that contains the access token. When the access token expires,
    <code>acurl</code> gets a new one using the refresh token. Note that both the access and refresh
    tokens are stored locally, and the <code>acurl</code> script accesses them to do its work.</li>
  <li><code>get_token</code>: Exchanges your Apigee credentials for an access and refresh token that
    can be used to authenticate Edge management APIs directly. If an access token can be refreshed,
    the script will refresh it and save the new token. If the refresh token expires, the script
    will prompt for your user credentials. Note that the script stores the tokens on disk, ready
    for use when required, and it also prints a valid access token to stdout. Once you obtain a
    valid token, you can use a REST client like Postman or embed the token in an environment
    variable for use in cURL.</li>
</ul>

<h2 id="installingtheacurlandget_tokenscripts">Installing the acurl and get_token scripts</h2>

<p>Apigee provides a ZIP file containing <code>acurl</code> and <code>get_token</code> and
an install script.</p>

<ol>
  <li>Create an install directory on your machine and <code>cd</code> to the directory.</li>
  <li>Download the installation ZIP file from Apigee as follows:
    <pre class="devsite-terminal">curl https://login.apigee.com/resources/scripts/sso-cli/ssocli-bundle.zip -o "ssocli-bundle.zip"</pre>
  </li>
  <li>Unzip the downloaded file.</li>
  <li>Run the install script. Optionally, use the <code>-b</code> option to specify the location of
    the executable files. Otherwise, they will be placed in the current directory.
    <pre class="devsite-terminal">sudo ./install -b /usr/local/bin</pre>
  </li>
  <li>Test the installations as follows. These commands print help information.
    <pre><code class="devsite-terminal">acurl -h</code>
<code class="devsite-terminal">get_token -h</code></pre>
  </li>
</ol>

<h2 id="usingacurl">Using acurl</h2>

<p><code>acurl</code> exchanges your Apigee user credentials for an access and refresh token.
The script automatically uses the refresh token to get a new access token when it expires. When
the refresh token expires, <code>acurl</code> will fail and prompt you for your Apigee credentials.
<code>acurl</code> wraps a standard cURL command that includes the access token in an Authorization
header automatically for you, like this:</p>

<pre class="devsite-terminal">curl -H "Authorization: Bearer <var>the_access_token</var>" ...</pre>

<aside class="note"><strong>Note:</strong> When you execute <code>acurl</code> the first time, an
access token is returned and stored locally in <code>~/.sso-cli</code>, and <code>acurl</code> uses
it for subsequent calls.</aside>

<h3 id="usingacurl-firstuseorafterrefreshtokenexpiration">First use or after refresh token expiration</h3>

<p>The first time you call <code>acurl</code>, you need to provide your Apigee credentials so that
<code>acurl</code> can exchange them for an access token and refresh token. You will not need to use
your Apigee credentials again, until the refresh token has expired.</p>

<ol>
  <li>Be sure you have successfully installed <code>acurl</code> as explained previously.</li>
  <li>Make Apigee Edge management API calls as follows, where <code>username</code> is the email
    address associated with your Apigee account:
    <pre class="devsite-terminal">acurl https://api.enterprise.apigee.com/v1/o/<var>orgname</var> -u <var>username</var>:<var>password</var> \
  -m <var>one_time_MFA_code</var></pre>
    <p>where:</p>
    <ul>
      <li><var>orgname</var>: The name of your Apigee organization.</li>
      <li><var>username</var>: The email address associated with your Apigee account.</li>
      <li><var>password</var>: Your Apigee password.
        <aside class="note"><strong>Note:</strong> <strong>If you omit the password</strong>, you will
        be prompted to enter it. If you do not want to use your password directly in the command, you
        can obtain a one-time code passcode to use instead of your password. See
        <a href="#Obtainingonetime">Obtaining and using a one-time passcode</a>.</aside>
      </li>
      <li><var>one_time_MFA_code</var>: The one-time code generated for you if you have multi-factor
        authentication (MFA) enabled. If you do not have MFA enabled, you can omit this parameter.</li>
    </ul>
  </li>
</ol>

<blockquote>
<p><strong>Example:</strong></p>
<pre class="devsite-terminal">acurl https://api.enterprise.apigee.com/v1/o/docs -u jdoe@apigee.com -m 567123
Enter the password for user &apos;jdoe@apigee.com
<code class="devsite-terminal"><var>password</var></code>
{
  &quot;createdAt&quot; : 1491854501264,
  &quot;createdBy&quot; : &quot;noreply_iops@apigee.com&quot;,
  &quot;displayName&quot; : &quot;jdoe&quot;,
  &quot;environments&quot; : [ &quot;prod&quot;, &quot;test&quot; ],
  &quot;lastModifiedAt&quot; : 1491854501264,
  &quot;lastModifiedBy&quot; : &quot;noreply_iops@apigee.com&quot;,
  &quot;name&quot; : &quot;jdoe&quot;,
  &quot;properties&quot; : {
    &quot;property&quot; : [ {
      &quot;name&quot; : &quot;features.isSmbOrganization&quot;,
      &quot;value&quot; : &quot;false&quot;
    }, {
      &quot;name&quot; : &quot;features.isCpsEnabled&quot;,
      &quot;value&quot; : &quot;true&quot;
    } ]
  },
  &quot;type&quot; : &quot;trial&quot;
}</pre></blockquote>

<aside class="note"><strong>Note:</strong> The <code>acurl</code> command stores an access and
refresh token in <code>~/.sso-cli</code>. On subsequent calls, acurl will use these tokens to make
authenticated requests to the management API -- you will not need to enter your credentials again
unless both the access and refresh tokens expire.</aside>

<aside class="note"><strong>Note:</strong> By default, <code>acurl</code> generates tokens by
calling the SSO service at this location: <code>https://login.apigee.com</code>. If you want to hit
a different SSO endpoint, set the <code>SSO_LOGIN_URL</code> environment variable on your
system.</aside>

<h2 id="usingget_token">Using get_token</h2>

<p>The <code>get_token</code> utility lets you exchange your Apigee credentials for an access
and refresh token that you can then use to access Apigee management APIs. Unlike with the
<code>acurl</code> command, <code>get_token</code> simply gets and stores tokens on your disk. It is
up to you to place a valid token in the Authorization header of your management API calls. Usage
examples are provided below.</p>

<ol>
  <li>Be sure you have successfully installed <code>get_token</code> as explained
    previously.</li>
  <li>If it does not exist already, create the directory <code>~/.sso-cli</code>. The
    <code>get_token</code> script stores newly minted tokens in this directory.</li>
  <li>The simplest way to use <code>get_token</code> from the command line is to call the script
    and let it prompt you for input, where <code>jdoe@apigee.com</code> is an Apigee account
    username (normally, this is your Apigee account email address):
    <pre class="devsite-terminal">get_token
Enter username: jdoe@abc123.com
Enter the password for user 'jdoe@apigee.com'
Enter the six-digit code if 'jdoe@apigee.com' is MFA enabled or press ENTER: <var>your_six_digit_code</var></pre>
  </li>
</ol>

<ul>
  <li>If you do not use multi-factor authentication (the six-digit code), just hit Enter when
    prompted.</li>
  <li>If you do not enter your username within 30 seconds, the script times out and exits with a
    non-zero error.</li>
  <li>A successful call prints a valid access token to <code>stdout</code> and stores the tokens in
    <code>~/.sso-cli</code>.</li>
</ul>

<h3 id="usingget_token-alternativeusage">Alternative usage</h3>

<p>You can also use <strong>get_token</strong> by providing the required parameters directly in the
command as follows:</p>

<pre class="devsite-terminal">get_token -u <var>your_Apigee_email_address</var>:<var>your_Apigee_password</var> \
  -m <var>your_six_digit_code</var></pre>

<aside class="note"><strong>Note:</strong> If you do not want to use a password directly it in the
command (for example, if your password is a corporate credential), you can obtain a one-time code
passcode to use instead of your password. See
<a href="#Obtainingonetime">Obtaining and using a one-time passcode</a>.</aside>

<h3 id="usingget_token-examples">Examples</h3>

<pre class="devsite-terminal">get_token -u jdoe@apigee.com:abc123 -m 567123 eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOiI4NjI5ZDVlZC1lMGY0LTQ3YWYtOTIwNS1kNWRiOWI2YTk3MDgiLCJzdWIiOiI3NWFlYjg0Ni1lYjMwLTQ3YTMtOTg0ZC1kZjNhZDg2NTg1MGQiLCJzY29wZSI6WyJzY2ltLm1lIiwib3BlbmlkIiwicGFzc3dvcmQud3JpdGUiLCJhcHByb3ZhbHMubWUiLCJvYXV0aC5RpbWUiOjE1MTQ4hcHByb3ZhbHMiXSwiY2xpZW50X2lkIjoiZWRnZWNsaSIsImNpZCI6ImVkZ2VjbGkiLCJhwiZ3JhbnRfdHlwZSI6InBhc3N3b3JkIiwidXNlcl9pZCI6Ijc1YWViODQ2LWViMzAtNDdhMy05ODRkLWRmM2FkODY1ODUwZCIsIm9yaWdpbiI6InVzZXJncmlkIiwidXNlcl9uYW1lIjoid2lsbHdpdG1hbkBnb29nbGUuY29tIiwiZW1haWwiOiJ3aWxsd2l0bWFuQGdvb2dsZS5jb20iLCJhdXRoX3NDk4NzEsImFsIjoyLCJyZXZfc2lnIjoiZmY1ODgwMGYiLCJpYXQiOjE1MTQ4NDk4NzEsImV4cCI6MTUxNDg1MTY3MSwiaXNzIjoiaHR0cHM6Ly9sb2dpbi5hcGlnZWUuY29tIiwiemlkIjoidWFhIiwiYXVkIjpbImVkZ2VjbGkiLCJzY2ltIiwib3BlbmlkIiwienAiOiJlZGdlY2xpIicGFzc3dvcmQiLCJhcHByb3ZhbHMiLCJvYXV0aCJdfQ.bWj31E3jwl6IwPW6sIFKeqH1_IVMVFpWLXBImNmps2iOeIWyktZO3u0mANvXpmr313mB6j6qAbiFgwCG2WfbXQkH_TbmBpVMgrYwHWqv90fOkNvbJFUnx--ChhypUusHFx3w6InjVwcG85juGq9REJgtSfaFRjb5l5TNtn6_p9wDyQyvM84uw2NmEcJA-FLi-L9EBKaseX6MZWj8gwpxEiXO3XE3N6veaOV344JjzPtKbUZ3mGtIEpkwkcFooqWOLiLs22IwFIdMc8aEcbe_R3AXe1ot-vJwVEspn3p0XqNlAA4_iQolZTrCLjoQADaE6IrR9Kt-kLehSk4GnNwR7g</pre>

<p>You can use the token by placing it directly in the Authorization header of a management API
call. For example:</p>

<pre class="devsite-terminal">curl -H "Authorization: Bearer <var>your_token</var>" \
  -v https://api.enterprise.apigee.com/v1/o/<var>your_organization</var></pre>

<p>After you have generated tokens successfully (that is, after you have run
<code>get_token</code> for the first time), you can embed <code>get_token</code> directly in a cURL
call as follows. With this technique, the <code>get_token</code> command will handle refreshing an
expired token automatically (until the refresh token expires).</p>

<pre class="devsite-terminal">header='get_token' &amp;&amp; curl -H "Authorization: Bearer $header" \
  -v https://api.enterprise.apigee.com/v1/o/<var>your_organization</var></pre>

<h2 id="obtainingandusingaonetimepasscode">Obtaining and using a one-time passcode</h2>

<p>If you do not want to use your password in the <code>acurl</code> command (for example, if it is
a corporate password), you can obtain <strong>a one-time code passcode</strong> to use instead of
your password.</p>

<ol>
<li>Enter this URL in a browser: <code>https://login.apigee.com/passcode</code></li>
<li>Log into your Apigee account.</li>
<li>Copy the 6-character passcode.</li>
<li>Call <code>acurl</code> as follows:
  <pre class="devsite-terminal">acurl https://api.enterprise.apigee.com/v1/o/<var>orgname</var> -u <var>username</var> \
  -m <var>one_time_MFA_code</var> -p <var>your_passcode</var></pre>
  <p>For example:</p>
  <pre class="devsite-terminal">acurl https://api.enterprise.apigee.com/v1/o/docs -u jdoe@apigee.com -m 567123 -p Tg8Xx0
{
  &quot;createdAt&quot; : 1491854501264,
  &quot;createdBy&quot; : &quot;noreply_iops@apigee.com&quot;,
  &quot;displayName&quot; : &quot;jdoe&quot;,
  &quot;environments&quot; : [ &quot;prod&quot;, &quot;test&quot; ],
  &quot;lastModifiedAt&quot; : 1491854501264,
  &quot;lastModifiedBy&quot; : &quot;noreply_iops@apigee.com&quot;,
  &quot;name&quot; : &quot;jdoe&quot;,
  &quot;properties&quot; : {
    &quot;property&quot; : [ {
      &quot;name&quot; : &quot;features.isSmbOrganization&quot;,
      &quot;value&quot; : &quot;false&quot;
    }, {
      &quot;name&quot; : &quot;features.isCpsEnabled&quot;,
      &quot;value&quot; : &quot;true&quot;
    } ]
  },
  &quot;type&quot; : &quot;trial&quot;
}</pre>
  </li>
</ol>

<h2 id="usingget_tokentoobtainaccesstokensfromsamlassertions">Using get_token to obtain access
tokens from SAML assertions</h2>

<p>Edge supports Security Assertion Markup Language (SAML) 2.0 as the authentication mechanism.
SAML provides support for a single sign-on (SSO) environment. By using SAML with Edge, you can
support SSO for the Edge UI and API in addition to any other of your services that support SAML.</p>

<p>After you enable SAML, Basic Auth is disabled for the Edge management API. You must update any
API calls and scripts that use Basic Auth to use OAuth2 bearer tokens instead. To do so, use
<code>get_token</code> to exchange your SAML assertion for an OAuth2 bearer token usable by the
Edge management API. You then pass that access token as the <code>Bearer</code> header to make
Edge management API calls. For example:</p>

<pre class="devsite-terminal">curl -H "Authorization: Bearer <var>access_token</var>" \
  https://api.enterprise.apigee.com/v1/organization/<var>orgName</var></pre>

<p>For more information on generating and using tokens for Edge SSO, including using tokens with the
Edge UI and API, see
<a href="/api-platform/system-administration/enabling-saml-authentication-edge">Enabling SAML Authentication for Edge</a>.</p>

<h2 id="usingtheapitogettokens">Using the API to get tokens</h2>

<p>You can get access and refresh tokens using the API, as explained in this section.</p>

<h3 id="usingtheapitogettokens-postgetanewaccesstoken">(POST) Get a new access token</h3>

<p>Use this API to get a new access token. In the output, you will receive both an access token and
a refresh token. If you save the refresh token, you can make subsequent API calls to obtain new
access tokens (see <a href="#usingtheapitogettokens-postrefreshanaccesstoken">Refresh an access
token</a>).</p>

<p><strong>Request URL</strong></p>

<pre class="prettyprint">https://login.apigee.com/oauth/token</pre>

<p><strong>Header parameters</strong></p>

<table>
  <tbody>
    <tr>
      <th>Parameter</th>
      <th>Value</th>
    </tr>
    <tr>
      <td><code>Content-Type</code></td>
      <td><code>application/x-www-form-urlencoded</code></td>
    </tr>
    <tr>
      <td><code>Accept</code></td>
      <td><code>application/json;charset=utf-8</code></td>
    </tr>
    <tr>
      <td><code>Authorization</code></td>
      <td><code>Basic ZWRnZWNsaTplZGdlY2xpc2VjcmV0</code>
        <aside class="note"><strong>Note:</strong> Use this value exactly as shown here. It is a
        hard-coded value that the API requires in the Authorization header.</aside>
      </td>
    </tr>
  </tbody>
</table>

<p><strong>Form parameters</strong> <strong>(x-www-form-urlencoded)</strong></p>

<table>
  <tbody>
    <tr>
      <th>Parameter</th>
      <th>Value</th>
    </tr>
    <tr>
      <td><code>username</code></td>
      <td><var>YOUR_APIGEE_ACCOUNT_EMAIL_ADDRESS</var></td>
    </tr>
    <tr>
      <td><code>password</code></td>
      <td><var>YOUR_APIGEE_ACCOUNT_PASSWORD</var></td>
    </tr>
    <tr>
      <td><code>grant_type</code></td>
      <td><code>password</code></td>
    </tr>
    <tr>
      <td><code>mfa_token</code></td>
      <td>A valid multi-factor auth token for your account. Required only if you have multi-factor
        auth (MFA) enabled on your Apigee account. See also
        <a href="/api-platform/system-administration/enable-two-factor-auth-your-apigee-account">Enable
        two-factor auth for your Apigee account</a>.</td>
    </tr>
  </tbody>
</table>

<p><strong>Example using MFA token</strong></p>

<aside class="note"><b>Note:</b> Use the exact <code>Authorization</code> header shown in the example. The
  value <code>ZWRnZWNsaTplZGdlY2xpc2VjcmV0</code> is a hard-coded value that the API requires. You
  may wish to export this value to an environment variable (preferably in your
  <code>.bash_profile</code> or <code>.bashrc</code> file) so you do not have to set it every time
  you make management API calls. For example:
  <pre class="devsite-terminal">export CLIENT_AUTH=ZWRnZWNsaTplZGdlY2xpc2VjcmV0</pre>
</aside>

<pre class="devsite-terminal">curl -H "Content-Type:application/x-www-form-urlencoded;charset=utf-8" \
  -H "Accept: application/json;charset=utf-8" \
  -H "Authorization: Basic ZWRnZWNsaTplZGdlY2xpc2VjcmV0" \
  -X POST https://login.apigee.com/oauth/token?mfa_token=<var>6_digit_token</var> \
  -d 'username=jdoe@example.com&amp;password=abc123&amp;grant_type=password'</pre>

<p><strong><strong>Output</strong></strong></p>

<p>On success, you will get back an access token, refresh token, and related information. For example:</p>

<pre class="prettyprint">{
  &quot;access_token&quot;: &quot;eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOimYyD8IP2IyYS1jNmNiLTQ4NTgtYjZkMS1mZjkyNGFkYTk1YWUiLCJzdWIiOiI0X0KLSNjZlNjM0ZC0zZjlhLTRiNYmFjNi1kYjE2M2M5OGEzOGYiLCJzY29wZSI6WyJzYbmlkIiwicGFzc3dvcmQud3JpdGUiLCJhcHByb3ZhbHMubWUiLCJvYXV0aC5hcHByb3ZhbHMiXSwiY2xpZW50X2lkIjoiZWRnZWNsaSIsImNpZCI6ImVkZ2VjbGkiLCJhenAiOiJlZGdlY2xpIiwiZ3JhbnRfdHlwZSI6InBhc3N3b3JkIiwidXNlcl9pZCI6IjQ2NmU2MzRkLTNmOWEtNGI0MS1iYWM2LWRiMTYzYzk4YTM4ZiIsIm9yaWdpbiI6InVzZXJncmlkIiwidXNlcl9uYW1lIjoid3dpdG1hbkBhcGlnZWUuY29tIiwiZW1haWwiOiJ3d2l0bWFuQGFwaWdlZS5jb20iLCJhdXRoX3RpbWUiOjE0NzMyNjU4NzcsImFsIjoyLCJyZXZfc2lnIjoiZTc0ZGY0M2QiLCJpYXQiOjE0NzMyNjU4NzcsImV4cCI6MTQ3MzI2NzY3NywiaXNzIjoiaHR0cHM6Ly9sb2dpbi5hcGlnZWUuY29tL29hdXRoL3Rva2VuIiwiemlkIjoidWFhIiwi2ltLm1lIiwib3BlYXVkIjpbImVkZ2VjbGkiLCJzY2ltIiwib3BlbmlkIiwicGFzc3dvcmQiLCJhcHByb3ZhbHMiLCJvYXV0aCJdfQ.AFuevkeGGUGSPED8leyEKaT-xg1xk_VEiKJLEpipVvQBXIqEc9wqcpm-ZuoatA9DhjASRuFSRaHH8Fasx_vBxEBsUNhRY-GTMw7_8fv4yRMOb2AO3WUl_NWwPkC8XRSI1zCMbAZicojsJ1n3OSP487Mu9dl9ByX5A_QfHV2_cj4l9-SD7u6vOdfdbBxbNMAQkfZLrVIEU8myF2dhKnNeMiuoHSHANsQFcx0_BFA1HnSUnVi4RYj1FlTs9SbcPnS1d7t7eVdxWz_q2OFVXNIBMELAvvM0WhXPYTW3Osve3UvvUs6ekGs-K-RCPSok-4-NJbdCDpZQQTgqHsrf77NTsw&quot;,
  &quot;token_type&quot;: &quot;bearer&quot;,
  &quot;refresh_token&quot;: &quot;eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOiJmZTIIMZWI0ZS00YzFmLTRjOTEtYmY5Mi1mMzZLEMzNjZhMDctciIsInN1YiI6IjQ2NmU2MzRkLTNmOWEtNGI0MS1iY17LLWRiMTYzYzk4YTM4ZiIsInNjb3BlIjpbInNjaW0ubWUiLCJvcGVuaWQiLCJwYXNzd29yZC53cml0ZSIsImFwcHJvdmFscy5tZSIsIm9hdXRoLmFwcHJvdmFscyJdLCJpYXQiOjE0NzMyNjU4NzcsImV4cCI6MTQ3NsaSIsImNsaWVudF9pZCI6ImVkZ2VjbGkiLCJpc3MiOiJodHRwczovL2xvZ2luLmFwaWdlZS5jb20vb2F1dGgvdG9rZW4iLCJ6aWQiOiJ1YWEiLCJncmFudF90eXBlIjoicGFzc3dvcmQiLCJ1c2VyX25hbWUiOiJ3d2l0bWFuQGFwaWdlZS5jbMzM1MDQ3NywiY2lkIjoiZWRnZW20iLCJvcmlnaW4iOiJ1c2VyZ3JpZCIsInVzZXJfaWQiOiI0NjZlNjM0ZC0zZjlhLTRiNDEtYmFjNi1kYjE2M2M5OGEzOGYiLCJhbCI6MiwicmV2X3NpZyI6ImU3NGRmNDNkIiwiYXVkIjpbImVkZ2VjbGkiLCJzY2ltIiwib3BlbmlkIiwicGFzc3dvcmQiLCJhcHByb3ZhbHMiLCJvYXV0aCJdfQ.kBP5AkbRS7Tnp-5VAfTLVfkUbUer4gFEU6A7g202KTKiXbqTwPSmOIGFTK12XevVPQYmAaSMFAnempWKfY7sjaY7HC7q3mGl53_A18cnkKhtNq15wCnyMom_bX_MYLW1RQPFytJ6akSJ-JkoPFU0x_FQg1JIvub1A8eqQxcR0KP-QRCxYAS4HTjH80vDIxHNt1tg7clmpa3RlHri0dlPVVsSpTXXhkpXRg5QbiWMrpkACSV22c0x0KiNu7vx5A520VOCO7hQ7IzmVIcSWcRqI97L7WdCjH_q4105bs2qmW73670MC0UGiJ9t5B1S1cxwqpUEd-NAuCsY8SVn6eWzbA&quot;,
  &quot;expires_in&quot;: 1799,
  &quot;scope&quot;: &quot;scim.me openid password.write approvals.me oauth.approvals&quot;,
  &quot;jti&quot;: &quot;9bf2cb2a-c6cb-4858-b6d1-ff924ada95ae&quot;
}
</pre>

<h3 id="usingtheapitogettokens-postrefreshanaccesstoken">(POST) Refresh an access token</h3>

<p>Use this API to get a access token with a refresh token. You'll get back a new access token and
refresh token. Save the refresh token to make subequent calls to get a new access token.</p>

<p><strong>Request URL</strong></p>

<pre class="prettyprint">https://login.apigee.com/oauth/token</pre>

<p><strong>Header parameters</strong></p>

<table>
  <tbody>
    <tr>
      <th>Parameter</th>
      <th>Value</th>
    </tr>
    <tr>
      <td><code>Content-Type</code></td>
      <td><code>application/x-www-form-urlencoded</code></td>
    </tr>
    <tr>
      <td><code>Accept</code></td>
      <td><code>application/json;charset=utf-8</code></td>
    </tr>
    <tr>
      <td><code>Authorization</code></td>
      <td><code>Basic ZWRnZWNsaTplZGdlY2xpc2VjcmV0</code>
        <aside class="note"><strong>Note:</strong> Use this value exactly as shown here. It is a
        hard-coded value that the API requires in the Authorization header.</aside>
      </td>
    </tr>
  </tbody>
</table>

<p><strong>Form parameters (x-www-form-urlencoded)</strong></p>

<table>
  <tbody>
    <tr>
      <th>Parameter</th>
      <th>Value</th>
    </tr>
    <tr>
      <td><code>refresh_token</code></td>
      <td><var>YOUR_REFRESH_TOKEN</var></td>
    </tr>
    <tr>
      <td><code>grant_type</code></td>
      <td><code>refresh_token</code></td>
    </tr>
  </tbody>
</table>

<p><strong><strong>Example</strong></strong></p>

<aside class="note"><strong>Note:</strong> Use the exact <code>Authorization</code> header shown in the
example.</aside>

<pre class="devsite-terminal">curl -H "Content-Type:application/x-www-form-urlencoded;charset=utf-8"
  -H "Accept: application/json;charset=utf-8" \
  -H "Authorization: Basic ZWRnZWNsaTplZGdlY2xpc2VjcmV0" \
  -X POST https://login.apigee.com/oauth/token \
  -d 'grant_type=refresh_token&amp;refresh_token=<var>YOUR_REFRESH_TOKEN</var>'</pre>

<p><strong><strong>Output</strong></strong></p>

<p>On success, you will get back a new access token, refresh token, and related information. For
example:</p>

<aside class="note"><strong>Note:</strong> Save the refresh token to make subsequent calls to get a
new access token.</aside>

<pre class="prettyprint">{
  &quot;access_token&quot;: &quot;eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOimYyD8IP2IyYS1jNmNiLTQ4NTgtYjZkMS1mZjkyNGFkYTk1YWUiLCJzdWIiOiI0X0KLSNjZlNjM0ZC0zZjlhLTRiNYmFjNi1kYjE2M2M5OGEzOGYiLCJzY29wZSI6WyJzY2ltLm1lIiwib3BlbmlkIiwicGFzc3dvcmQud3JpdGUiLCJhcHByb3ZhbHMubWUiLCJvYXV0aC5hcHByb3ZhbHMiXSwiY2xpZW50X2lkIjoiZWRnZWNUuY29tL29hdXRoL3Rva2VuIisaSIsImNpZCI6ImVkZ2VjbGkiLCJhenAiOiJlZGdlY2xpIiwiZ3JhbnRfdHlwZSI6InBhc3N3b3JkIiwidXNlcl9pZCI6IjQ2NmU2MzRkLTNmOWEtNGI0MS1iYWM2LWRiMTYzYzk4YTM4ZiIsIm9yaWdpbiI6InVzZXJncmlkIiwidXNlcl9uYW1lIjoid3dpdG1hbkBhcGlnZWUuY29tIiwiZW1haWwiOiJ3d2l0bWFuQGFwaWdlZS5jb20iLCJhdXRoX3RpbWUiOjE0NzMyNjU4NzcsImFsIjoyLCJyZXZfc2lnIjoiZTc0ZGY0M2QiLCJpYXQiOjE0NzMyNjU4NzcsImV4cCI6MTQ3MzI2NzY3NywiaXNzIjoiaHR0cHM6Ly9sb2dpbi5hcGlnZWwiemlkIjoidWFhIiwiYXVkIjpbImVkZ2VjbGkiLCJzY2ltIiwib3BlbmlkIiwicGFzc3dvcmQiLCJhcHByb3ZhbHMiLCJvYXV0aCJdfQ.AFuevkeGGUGSPED8leyEKaT-xg1xk_VEiKJLEpipVvQBXIqEc9wqcpm-ZuoatA9DhjASRuFSRaHH8Fasx_vBxEBsUNhRY-GTMw7_8fv4yRMOb2AO3WUl_NWwPkC8XRSI1zCMbAZicojsJ1n3OSP487Mu9dl9ByX5A_QfHV2_cj4l9-SD7u6vOdfdbBxbNMAQkfZLrVIEU8myF2dhKnNeMiuoHSHANsQFcx0_BFA1HnSUnVi4RYj1FlTs9SbcPnS1d7t7eVdxWz_q2OFVXNIBMELAvvM0WhXPYTW3Osve3UvvUs6ekGs-K-RCPSok-4-NJbdCDpZQQTgqHsrf77NTsw&quot;,
  &quot;token_type&quot;: &quot;bearer&quot;,
  &quot;refresh_token&quot;: &quot;eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOiJmZTIIMZWI0ZS00YzFmLTRjOTEtYmY5Mi1mMzZLEMzNjZhMDctciIsInN1YiI6IjQ2NmU2MzRkLTNmOWEtNGI0MS1iY17LLWRiMTYzYzk4YTM4ZiIsInNjb3BlIjpbInNjaW0ubWUiLCJvcGVuaWQiLCJwYXNzd29yZC53cml0ZSIsImFwcHJvdmFscy5tZSIsIm9hdXRoLmFwcHJvdmFscyJdLCJpYXQiOjE0NzMyNjU4NzcsImV4cCI6MTQ3MzM1MDQ3NywiY2lkIjoiZWRnZWNsaSIsImNsaWVudF9pZCI6ImVkZ2VjbGkiLCJpc3MiOiJodHRwczovL2xvZ2luLmFwaWdlZS5jb20vb2F1dGgvdG9rZW4iLCJ6aWQiOiJFudF90eLCJ1c2VyX25hbWUiOiJ3d2l0bWFuQGFwaWdlZS5jb20iLCJvcmlnaW4iOiJ1c2VyZ3JpZCIsInVzZXJfaWQiOiI0NjZlNjM0ZC0zZjlhLTRiNDEtYmFjNi1kYjE2M2M5OGEzOGYiLCJhbCI6MiwicmV2X3NpZyI6ImU3NGRmND1YWEiLCJncmNkIiwiYXVkIjpbImVkZ2VjbGkiLCJzY2ltIiwib3BlbmlkIiwicGFzc3dvcmQiLCJhcHByb3ZhbHMiLCJvYXV0aCJdfQ.kBP5AkbRS7Tnp-5VAfTLVfkUbUer4gFEUXBlIjoicGFzc3dvcmQi6A7g202KTKiXbqTwPSmOIGFTK12XevVPQYmAaSMFAnempWKfY7sjaY7HC7q3mGl53_A18cnkKhtNq15wCnyMom_bX_MYLW1RQPFytJ6akSJ-JkoPFU0x_FQg1JIvub1A8eqQxcR0KP-QRCxYAS4HTjH80vDIxHNt1tg7clmpa3RlHri0dlPVVsSpTXXhkpXRg5QbiWMrpkACW73670MCSV22c0x0KiNu7GiJ9t5B1S1cxwvx5A520VOCO7hQ7IzmVIcSWcRqI97L7WdCjH_q4105bs2qm0UqpUEd-NAuCsY8SVn6eWzbA&quot;,
  &quot;expires_in&quot;: 1799,
  &quot;scope&quot;: &quot;scim.me openid password.write approvals.me oauth.approvals&quot;,
  &quot;jti&quot;: &quot;9bf2cb2a-c6cb-4858-b6d1-ff924ada95ae&quot;
}</pre>

<h2 id="usagenotes">Usage notes</h2>

<ul>
  <li>Both <code>acurl</code> and <code>get_token</code> scripts hit the SSO endpoint specified in
    the <code>SSO_LOGIN_URL</code> environment variable. The default endpoint is
    <code>https://login.apigee.com.</code></li>
  <li>Access tokens expire in 1799 seconds (approximately 30 minutes).</li>
  <li>Refresh tokens expire in 84600 seconds (approximately 24 hours).</li>
</ul>

<h2 id="enabling2factorsecurity">Enabling 2-factor security</h2>

<p>You can optionally enable 2-factor security for your Apigee Edge account. When 2-factor security
is enabled, you provide a randomly generated number along with your user credentials when logging
into your Apigee account. See also
<a href="/api-platform/system-administration/enable-two-factor-auth-your-apigee-account">Enable
two-factor auth for your Apigee account</a>. At this time, you can use acurl to make calls whether
or not you have 2-factor security enabled.</p>

{% endblock %}
