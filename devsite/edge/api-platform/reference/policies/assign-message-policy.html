{% extends "_base.html" %}
{% block title %}AssignMessage policy{% endblock %}
{% block body %}


  <p><img src="/api-platform/images/icon_policy_assign-message.jpg"></p>

  <p>Changes or creates new request and response messages during the API proxy Flow. The Assign
  Message policy lets you perform the following actions on those messages:</p>
  <ul>
    <li><a href="#add">Add</a> new form parameters, headers, or query parameters to a message</li>
    <li><a href="#copy">Copy</a> existing properties from one message to another</li>
    <li><a href="#remove">Remove</a> headers, query parameteters, form parameters, and/or message
      payloads from a message</li>
    <li><a href="#set">Set</a> the value of existing properties in a message</li>
  </ul>

  <p>With Assign Message, you typically add, change, or remove properties of either the
  request or response. However, you can also use Assign Message to create a custom
  request or response message and pass it to an alternative target, as described in
  <a href="#customrequests">Create custom request messages</a>.</p>

  <section class="expandable">
    <h3 class="showalways">Use cases</h3>
    <p>There are many situations in which you might want to modify a request or a response message
    during processing by Apigee Edge. For example:
    <ul>
      <li>Define a default value for a query string parameter or other type of input.</li>
      <li>Strip HTTP headers from a request message before the message is forwarded to the backend
        service.</li>
      <li>Add HTTP headers before a response is sent to the consumer app.</li>
      <li>Insert JSON or XML message content before a response is sent.</li>
      <li>Generate complete request or response messages. For example,
        you might use a {{service_callout_policy}} to invoke a remote API from an API proxy. You can
        use the Assign Message policy to create a custom request message and assign it to a variable.
        Then, use Service Callout to send that message to the remote API.</li>
      <li>Add headers to requests and responses for debugging and troubleshooting.</li>
    </ul>
  </section>

  <p>The Assign Message policy can create or change flow variables with the following child
  elements:</p>
  <ul>
    <li>{{am_add_link}}</li>
    <li>{{am_assignto_link}}</li>
    <li>{{am_assignvariable_link}}</li>
    <li>{{am_copy_link}}</li>
    <li>{{am_set_link}}</li>
  </ul>

  <h2 id="assignmessage">{{assignmessage}} element</h2>

  <p>Defines an Assign Message policy.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Complex type{% endsetvar %}
  {% setvar dvt_parent %}{{am_link}}{% endsetvar %}
  {% setvar dvt_children %}{{am_add_formparams_link}}<br/>{{am_add_headers_link}}<br/>{{am_add_queryparams_link}}{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_add}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
  <section>
    <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="add" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example uses the {{am_add_formparams_link}} element to get the values of
      three query string parameters from the initial request and set them as form parameters on the
      target endpoint request:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/add-formparams-3.xml" %}</pre>
    </section>
    <section>
      <h3>Example 2</h3>
      <p>The following example uses the {{am_add_headers_link}} element to add the
      <code>User-Agent</code> header to the target endpoint request:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/add-headers-1.xml" %}</pre>
    </section>
    <section>
      <h3>Example 3</h3>
      <p>The following example uses the {{am_add_queryparams_link}} element to add a single query
      parameter with a static value to the request:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/add-queryparams-1.xml" %}</pre>
      <p>This example uses {{am_add}} in the request preflow. If you look at the results in a tool
      such as the {{trace}}, the request to "http://httpbin.org/get" becomes
      "http://httpbin.org/get?myParam=42".</p>
    </section>
  </div>

  <p>The child elements of {{am_add}} support dynamic string substitution, known as
  <a href="/api-platform/reference/message-template-intro.html">message templating</a>.</p>

<!--
  <p>In general, you should not use {{am_set}} and {{am_add}} in the same policy to modify the same
  properties. For example, if you add a new form parameter with {{am_add}}, and set the value of the
  new form parameter with {{am_set}}&mdash;in the same policy&mdash;unexpected results can occur.</p>
-->

  <!-- ##################################################################################### -->
  <h4 id="add-formparams">{{am_add_formparams}} (child of {{am_add_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Adds new form parameters to the request message. This element has no effect on a response
  message.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Array of {{am_headers_header}} elements{% endsetvar %}
  {% setvar dvt_parent %}{{am_add_link}}{% endsetvar %}
  {% setvar dvt_children %}{{am_headers_header}}{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_add_headers}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
  <section>
    <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="add_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="add_headers" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="add_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
  </section>
  <section>
    <h3>Example 1</h3>
    <p>The following example adds the <code>user-agent</code> header to the request message, and
    assigns the value of the <code>request.user.agent</code> flow variable to that header.</p>
    <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/add-headers-1.xml" %}</pre>
    </section>
  </div>

  <!-- ##################################################################################### -->
  <h4 id="add-queryparams">{{am_add_queryparams}} (child of {{am_add_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Adds new query parameters to the request. This element has no effect on a response.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}String{% endsetvar %}
  {% setvar dvt_parent %}{{am_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>If you do not specify {{am_assignto}}, the policy acts on the default request or response,
  which is based on where the policy executes. If the policy executes in the request flow, it
  affects the request message. If it executes in the response flow, the policy affects the response
  by default.</p>

  <p>The {{am_assignto}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="assignto" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example specifies that the target is the original request that will be sent to the
      target endpoint:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/assignto-1.xml" %}</pre>
      <p>By setting <code>createNew</code> to "false" (the default), this example does not create a
      new request. All operations in this policy affect the original request.</p>
    </section>
    <section>
      <h3>Example 2</h3>
      <p>The following example creates a new request object:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/assignto-2.xml" %}</pre>
      <p>When you create a new request or response object, the other elements of the Assign Message
      policy (such as {{am_add_link}}, {{am_set_link}}, and {{am_set_link}}) act on that new
      request object.</p>
      <p>You can access the new request object in other policies later in the flow, or send the new
      request object to an external service with a {{service_callout_policy}}.</p>
    </section>
    <section>
      <h3>Example 3</h3>
      <p>The following example creates a new request object named "MyRequestObject":</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/assignto-3.xml" %}</pre>
      <p>When you create a new request or response object, the other elements of the Assign Message
      policy (such as {{am_add_link}}, {{am_set_link}}, and {{am_set_link}}) act on that new
      request object.</p>
      <p>You can access the new request object in other policies later in the flow, or send the new
      request object to an external service with a {{service_callout_policy}}.</p>
    </section>
  </div>

  <p>The following table describes the attributes of {{am_assignto}}:</p>
  <a name="am_assignto_attributes"></a>
  <table>
    <tbody>
      <tr>
        <th>Attribute</th>
        <th>Description</th>
        <th>Required?</th>
        <th>Type</th>
      </tr>
      <tr>
        <td><code>createNew</code></td>
        <td>
          <p>Determines whether this policy creates a new message when assigning values.</p>
          <p>If "true", then the policy creates a new variable of the type
          specified by <code>type</code> (either "request" or "response"). If you
          do not specify the name of the new variable, then the policy creates a new request or
          response object, based on the value of <code>type</code>.</p>
          <aside class="caution">
            <h3 class="hide-from-toc">CAUTION</h3>
            <p>When creating a new request or response object, the existing request or
            response object is deleted and replaced by the new one, meaning all
            information in the object is lost.</p>
          </aside>
          <p>If "false", then the policy responds in one of two ways:</p>
          <ul>
            <li>If {{am_assignto}} can resolve the variable name to a request or response, then it
              continues processing. For example, if the policy is in a request flow, the variable is the
              request object. If the policy is in a response, the variable is the
              response object.</li>
            <li>If {{am_assignto}} cannot be resolved, or resolves to a non-message type, then the
              policy throws an error.</li>
          </ul>
          <p>If <code>createNew</code> is not specified, the policy responds in one of two ways:
          <ul>
            <li>If {{am_assignto}} resolves to a message, then processing advances to the next
              step.</li>
            <li>If {{am_assignto}} cannot be resolved, or resolves to a non-message type, a new
              variable of type specified in <code>type</code> is created.</li>
          </ul>
        </td>
        <td>Optional</td>
        <td>Boolean</td>
      </tr>
      <tr>
        <td><code>transport</code></td>
        <td>
          <p>Specifies the transport type for the request or response message type.</p>
          <p>The default value is "http" (the only supported value).</p>
        </td>
        <td>Optional</td>
        <td>String</td>
      </tr>
      <tr>
        <td><code>type</code></td>
        <td>Specifies the type of the new message, when <code>createNew</code> is "true". Valid
          values are "request" or "response".
          <p>The default value is "request". If you omit this attribute, then Edge creates either
          a request or a response, depending on where in the flow this policy executes.</p>
        </td>
        <td>Optional</td>
        <td>String</td>
      </tr>
    </tbody>
  </table>

  <!-- ##################################################################################### -->
  <!-- ##################################################################################### -->
  <h3 id="assignvariable">{{am_assignvariable}}</h3>
  <!-- ##################################################################################### -->
  <!-- ##################################################################################### -->

  <p>Assigns a value to a destination flow variable (e.g., a variable whose value is set by the
  Assign Message policy). If the flow variable does not exist, then {{am_assignvariable}} creates
  it.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Required{% endsetvar %}
  {% setvar dvt_type %}String{% endsetvar %}
  {% setvar dvt_parent %}{{am_assignvariable_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_assignvariable_name}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
  <section>
    <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="assignvariable_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="assignvariable_name" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="assignvariable_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example specifies the destination variable as <code>myvar</code>, and sets it
      to the literal value "42":</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/assignvariable-1.xml" adjust_indentation="auto" %}</pre>
      <p>If <code>myvar</code> does not exist, {{am_assignvariable}} creates it.</p>
    </section>
  </div>

  <aside class="note">
    <h3 class="hide-from-toc">NOTE</h3>The name "ratelimit" is reserved. For more information, see
    <a href="https://community.apigee.com/questions/8860/quota-policy-throws-nullpointerexception.html"
    class="external">Quota Policy Throws NullPointerException</a> in the Apigee Community.
  </aside>

  <!-- ##################################################################################### -->
  <h4 id="assignvariable-ref">{{am_assignvariable_ref}} (child of {{am_assignvariable_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Specifies the source of the assignment as a flow variable. The flow variable can be one of the
  pre-defined flow variables (as listed in the {{variables_reference}}), or a custom flow variable
  that you created.</p>

  <p>The value of {{am_assignvariable_ref}} is always interpreted as a flow variable; you cannot
  specify a literal string as the
  value. To assign a literal string value, use the {{am_assignvariable_value_link}} element
  instead.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}String{% endsetvar %}
  {% setvar dvt_parent %}{{am_assignvariable_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_assignvariable_template}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
  <section>
    <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="assignvariable_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="assignvariable_template" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="assignvariable_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example uses message templating syntax to concatenate two context variables
      with a literal string (a hyphen) between them:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/template-1.xml" adjust_indentation="auto" %}</pre>
    </section>
  </div>

  <!-- ##################################################################################### -->
  <h4 id="assignvariable-value">{{am_assignvariable_value}} (child of {{am_assignvariable_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Defines the value of the destination flow variable set with {{am_assignvariable_link}}. The
  value is always interpreted as a literal string; you cannot use a flow variable as the value, even
  if you wrap the value in brackets ("{}"). To use a flow variable, use {{am_assignvariable_ref_link}}
  instead.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Complex type{% endsetvar %}
  {% setvar dvt_parent %}{{am_link}}{% endsetvar %}
  {% setvar dvt_children %}{{am_copy_formparams_link}}<br/>{{am_copy_headers_link}}
 <br/>{{am_copy_payload_link}}<br/>{{am_copy_path_link}}<br/>
  {{am_copy_queryparams_link}}<br/>{{am_copy_reasonphrase_link}}<br/>
  {{am_copy_statuscode_link}}<br/>{{am_copy_verb_link}}<br/>
  {{am_copy_version_link}}<br/>{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_copy}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
  <strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy" html_escape="False" %}</strong>
  &lt;!-- Used as the destination for the {{am_copy}} values --&gt;
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="assignto" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
  </pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example copies a header, three form parameters, the path, and all query
      parameters <em>from</em> the request <em>to</em> a new, custom request:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/copy-1.xml"  highlight="2,19" adjust_indentation="auto" %}</pre>
    </section>
  </div>

  <p>The {{am_copy}} element has the following attributes:</p>

  <table>
    <tbody>
      <tr>
        <th>Attribute</th>
        <th>Description</th>
        <th>Required?</th>
        <th>Type</th>
      </tr>
      <tr>
        <td>source</td>
        <td>
          <p>Specifies the source object of the copy.</p>
          <ul>
            <li>If <code>source</code> is not specified, it is treated as a simple message. For
              example, if the policy is in the request flow, then the source defaults to the
              <code>request</code> object. If the policy is in the response flow, it defaults to the
              <code>response</code> object. If you omit <code>source</code>, you can use an absolute
              reference to a flow variable as the source of the copy. For example, specify the value
              as <code>{request.header.user-agent}</code>.</li>
            <li>If the source variable cannot be resolved, or resolves to a non-message type,
              {{am_copy}} fails to respond.</li>
          </ul>
        </td>
        <td>Optional</td>
        <td>String</td>
      </tr>
    </tbody>
  </table>

  <!-- ##################################################################################### -->
  <h4 id="copy-formparams">{{am_copy_formparams}} (child of {{am_copy_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Copies form parameters from the request specified by the
  {{am_copy_link}} element's <code>source</code> attribute <em>to</em> the request
  specified by the {{am_assignto_link}} element. This element has no effect on a
  response.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}An array of {{am_headers_header}} elements or an empty array{% endsetvar %}
  {% setvar dvt_parent %}{{am_copy_link}}{% endsetvar %}
  {% setvar dvt_children %}{{am_headers_header}}{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_copy_headers}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_headers" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example copies the <code>user-agent</code> header from the request to the
      new, custom request object:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/copy-headers-1.xml" adjust_indentation="auto" %}</pre>
    </section>
    <section>
      <h3>Example 2</h3>
      <p>To copy all headers, use an empty {{am_copy_headers}} element, as the following example
      shows:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/copy-headers-2.xml" adjust_indentation="auto" %}</pre>
    </section>
    <section>
      <h3>Example 3</h3>
      <p>If there are multiple headers with the same name, use the following syntax:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/copy-headers-3.xml" adjust_indentation="auto" %}</pre>
      <p>This example copies "h1", "h2", and the second value of "h3". If "h3" has only one
      value, then it is not copied.</p>
    </section>
  </div>

  <!-- ##################################################################################### -->
  <h4 id="copy-path">{{am_copy_path}} (child of {{am_copy_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Determines whether the path should be copied from the source request to the destination
  request. This element has no effect on a response.</p>

  <p>If "true", this policy copies the path <em>from</em> the request message specified by the
  {{am_copy_link}} element's <code>source</code> attribute <em>to</em> the request
  message specified by the {{am_assignto_link}} element.</p>

  {% setvar dvt_default_value %}false{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Boolean{% endsetvar %}
  {% setvar dvt_parent %}{{am_copy_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_copy_payload}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_payload" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets {{am_copy_payload}} to "true" so that the request payload is
      copied from the request to the response:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/copy-payload-1.xml" adjust_indentation="auto" %}</pre>
    </section>
  </div>

  <!-- ##################################################################################### -->
  <h4 id="copy-queryparams">{{am_copy_queryparams}} (child of {{am_copy_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Copies query string parameters <em>from</em> the request specified by the
  {{am_copy_link}} element's <code>source</code> attribute <em>to</em> the request specified
  by the {{am_assignto_link}} element. This element has no effect on a response.</p>

  {% setvar dvt_default_value %}false{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Boolean{% endsetvar %}
  {% setvar dvt_parent %}{{am_copy_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_copy_reasonphrase}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_reasonphrase" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets {{am_copy_reasonphrase}} to "true", which causes {{am_copy}}
      to copy the reason phrase from the default response to a custom response object:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/copy-reasonphrase-1.xml" adjust_indentation="auto" %}</pre>
    </section>
  </div>

  <p>You can use {{am_copy_reasonphrase}} only when the following criteria are met:</p>
  <ul>
    <li>Message type: Response</li>
  </ul>

  <!-- ##################################################################################### -->
  <h4 id="copy-statuscode">{{am_copy_statuscode}} (child of {{am_copy_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Determines whether the status code is copied from the source response to the destination
  response. This element has no effect on a request.</p>

  <p>If "true", this policy copies the status code <em>from</em> the response message specified by
  the {{am_copy_link}} element's <code>source</code> attribute <em>to</em> the response
  message specified by the {{am_assignto_link}} element.</p>

  {% setvar dvt_default_value %}false{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Boolean{% endsetvar %}
  {% setvar dvt_parent %}{{am_copy_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_copy_verb}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_verb" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="copy_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets {{am_copy_verb}} to "true", which copies the verb from the
      default request to a new, custom request:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/copy-verb-1.xml" adjust_indentation="auto" %}</pre>
    </section>
  </div>

  <p>You can use {{am_copy_verb}} only when the following criteria are met:</p>
  <ul>
    <li>Message type: Request</li>
  </ul>

  <!-- ##################################################################################### -->
  <h4 id="copy-version">{{am_copy_version}} (child of {{am_copy_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Determines whether the HTTP version is copied from the source request to the
  destination request. This element has no effect on a response.</p>

  <p>If "true", copies the HTTP version found in the {{am_copy}} element's <code>source</code> attribute
  to the object specified by the {{am_assignto_link}} element.</p>

  {% setvar dvt_default_value %}true{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Boolean{% endsetvar %}
  {% setvar dvt_parent %}{{am_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>Set to "true" to ignore unresolved variables and continue processing; otherwise "false". The
  default value is "true".</p>

  <p>Setting {{am_ignoreunresolvedvariables}} to "true" is different from setting the {{am_link}}'s
  <code>continueOnError</code> to "true" in that it is specific to setting and getting values of
  variables. If you set <code>continueOnError</code> to "true", then Edge ignores all errors, not
  just errors encountered when using variables.</p>

  <p>The {{am_ignoreunresolvedvariables}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="ignoreunresolvedvariables" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets {{am_ignoreunresolvedvariables}} to "true":</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/ignoreunresolvedvariables.xml" adjust_indentation="auto" %}</pre>
    </section>
  </div>

  <!-- ##################################################################################### -->
  <!-- ##################################################################################### -->
  <h3 id="remove">{{am_remove}}</h3>
  <!-- ##################################################################################### -->
  <!-- ##################################################################################### -->

  <p>Removes headers, query parameteters, form parameters, and/or the message payload from
  a message. The message can be a request or a response. You specify which message {{am_remove}}
  acts on by using the {{am_assignto_link}} element.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Array of {{am_formparams_formparam}} elements or an empty array{% endsetvar %}
  {% setvar dvt_parent %}{{am_remove_link}}{% endsetvar %}
  {% setvar dvt_children %}{{am_formparams_formparam}}{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_remove_formparams}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="remove_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="remove_formparams" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="remove_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example removes three form parameters from the request:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/remove-formparams-1.xml" adjust_indentation="auto"%}</pre>
    </section>
    <section>
      <h3>Example 2</h3>
      <p>The following example removes all form parameters from the request:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/remove-formparams-2.xml" adjust_indentation="auto"%}</pre>
    </section>
    <section>
      <h3>Example 3</h3>
      <p>If there are multiple form params with the same name, use the following syntax:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/remove-formparams-3.xml" adjust_indentation="auto" %}</pre>
      <p>This example removes "f1", "f2", and the second value of "f3". If "f3" has only one
      value, then it is not removed.</p>
    </section>
  </div>

  <p>You can use {{am_remove_formparams}} only when the following criteria are met:</p>
  <ul>
    <li>Message type: Request</li>
    <li><code>Content-Type</code>: "application/x-www-form-urlencoded"</li>
  </ul>

  <!-- ##################################################################################### -->
  <h4 id="remove-headers">{{am_remove_headers}} (child of {{am_remove_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Removes the specified HTTP headers from the request or response, which is specified by the
  {{am_assignto_link}} element.</p>

  {% setvar dvt_default_value %}false{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Boolean{% endsetvar %}
  {% setvar dvt_parent %}{{am_remove_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_remove_payload}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="remove_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="remove_payload" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="remove_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets {{am_remove_payload}} to "true" so that the request payload is
      cleared:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/remove-payload-1.xml" adjust_indentation="auto" %}</pre>
    </section>
  </div>

  <!-- ##################################################################################### -->
  <h4 id="remove-queryparams">{{am_remove_queryparams}} (child of {{am_remove_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Removes the specified query parameters from the request. This element has no effect on a
  response.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Complex type{% endsetvar %}
  {% setvar dvt_parent %}{{am_link}}{% endsetvar %}
  {% setvar dvt_children %}{{am_set_formparams_link}}<br/>{{am_set_headers_link}}<br/>{{am_set_payload_link}}<br/>
  {{am_set_path_link}}<br/>{{am_set_queryparams_link}}<br/>{{am_set_reasonphrase_link}}<br/>{{am_set_statuscode_link}}<br/>
  {{am_set_verb_link}}<br/>{{am_set_version_link}}<br/>{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <aside class="note">
    <h3 class="hide-from-toc">NOTE</h3>The sub-elements of <code>&lt;Set&gt;</code> support the
    dynamic string substitution feature called
    <a href="/api-platform/reference/message-template-intro">message templating</a>.
  </aside>

  <p>The {{am_set}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example shows the {{am_set}} element:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/set-1.xml" adjust_indentation="auto"%}</pre>
    </section>
  </div>

<!--
  <p>In general, you should not use {{am_set}} and {{am_add}} in the same policy to modify the same
  properties. For example, if you add a new form parameter with {{am_add}}, and set the value of the
  new form parameter with {{am_set}}&mdash;in the same policy&mdash;unexpected results can occur.</p>
-->

  <!-- ##################################################################################### -->
  <h4 id="set-formparams">{{am_set_formparams}} (child of {{am_set_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Overwrites existing form parameters on a request and replaces them with the new values that you
  specify with this element. This element has no effect on a response.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Array of {{am_headers_header}} elements{% endsetvar %}
  {% setvar dvt_parent %}{{am_set_link}}{% endsetvar %}
  {% setvar dvt_children %}{{am_headers_header}}{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_set_headers}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_headers" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets the <code>user-agent</code> header to the value of the
      <code>request.header.user-agent</code> variable:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/set-headers-1.xml" adjust_indentation="auto"%}</pre>
    </section>
  </div>

  <p>If you define empty headers in your policy
  (<code>&lt;Add&gt;&lt;Headers/&gt;&lt;/Add&gt;</code>), the policy does not add any headers. This
  is the same as omitting {{am_add_headers}}.</p>

  <!-- ##################################################################################### -->
  <h4 id="set-path">{{am_set_path}} (child of {{am_set_link}})</h4>
  <!-- ##################################################################################### -->

  <aside class="note">
    <h3 class="hide-from-toc">NOTE</h3>
    <p>This element isn't currently working as designed to override/rewrite a proxy's
    target URL. (It does work for setting the path in Service Callouts, as shown in the Learn by
    Doing example below.)</p>

    <p>Sometimes you may need to send a message to a URL other than the URL defined in an API
    proxy's TargetEndpoint. If you want to rewrite the target URL, override the
    <code>target.url</code> variable in the TargetEndpoint using the {{am_assignvariable}} element.
    (You can't override <code>target.url</code> in
    the ProxyEndpoint, because Edge sets the variable in the TargetEndpoint).</p>

    <p>The following example
    shows how an Assign Message policy would override <code>target.url</code>. Again, add the
    policy to the TargetEndpoint request. With this policy, the proxy would call the URL below
    instead of the URL defined on the TargetEndpoint.</p>
    <pre class="prettyprint">
&lt;AssignMessage name="Assign-Message-1"&gt;
...
  &lt;AssignVariable&gt;
    &lt;Name&gt;target.url&lt;/Name&gt;
    &lt;Value&gt;http://mocktarget.apigee.net/user?user=Dude&lt;/Value&gt;
  &lt;/AssignVariable&gt;
...
</pre>

    <p>You can also use a {{javascript_policy}} in the TargetEndpoint to
    override the <code>target.url</code>.</p>
  </aside>

  <!-- ##################################################################################### -->
  <h4 id="set-payload">{{am_set_payload}} (child of {{am_set_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Defines the message body for a request or response, which is specified by the
  {{am_assignto_link}} element. The payload can be any valid content type, such as plain
  text, JSON, or XML.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}Array of {{am_queryparams_queryparam}} elements{% endsetvar %}
  {% setvar dvt_parent %}{{am_set_link}}{% endsetvar %}
  {% setvar dvt_children %}{{am_queryparams_queryparam}}{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_set_queryparams}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_queryparams" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets the "address" query parameter to the value of the
      <code>request.header.address</code> variable:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/set-queryparams-1.xml" adjust_indentation="auto" %}</pre>
    </section>
  </div>

  <p>You can use {{am_set_queryparams}} only when the following criteria are met:</p>
  <ul>
    <li>HTTP verb: GET</li>
    <li>Message type: Request</li>
  </ul>

  <p>If you define empty query parameters in your policy
  (<code>&lt;Set&gt;&lt;QueryParams/&gt;&lt;/Set&gt;</code>), the policy does not set any query
  parameters. This is the same as omitting {{am_set_queryparams}}.</p>

  <!-- ##################################################################################### -->
  <h4 id="set-reasonphrase">{{am_set_reasonphrase}} (child of {{am_set_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Sets the reason phrase on the response. This is normally done for debugging in combination with
  {{am_set_statuscode}}. This element has no effect on a request.</p>

  {% setvar dvt_default_value %}200 (when {{am_assignto}}'s <code>createNew</code> attribute is set
  to "true"){% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}String or {variable}{% endsetvar %}
  {% setvar dvt_parent %}{{am_set_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_set_statuscode}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_statuscode" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets a simple status code:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/set-statuscode-1.xml" adjust_indentation="auto" %}</pre>
    </section>
    <section>
      <h3>Example 2</h3>
      <p>The content of {{am_set_statuscode}} is treated as a message template. This means a
      variable name wrapped in curly braces will be replaced at runtime with the value of the
      referenced variable, as the following example shows:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/set-statuscode-2.xml" %}</pre>
    </section>
  </div>

  <p>You can use {{am_set_statuscode}} only when the following criteria are met:</p>
  <ul>
    <li>Message type: Response</li>
  </ul>

  <!-- ##################################################################################### -->
  <h4 id="set-verb">{{am_set_verb}} (child of {{am_set_link}})</h4>
  <!-- ##################################################################################### -->

  <p>Sets the HTTP verb on the request. This element has no effect on a response.</p>

  {% setvar dvt_default_value %}n/a{% endsetvar %}
  {% setvar dvt_required %}Optional{% endsetvar %}
  {% setvar dvt_type %}String or {variable}{% endsetvar %}
  {% setvar dvt_parent %}{{am_set_link}}{% endsetvar %}
  {% setvar dvt_children %}None{% endsetvar %}
  {% include "includes/_default_value_table.html" %}

  <p>The {{am_set_version}} element uses the following syntax:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Syntax</h3>
      <pre class="prettyprint">
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_open" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_open" html_escape="False" %}
<strong>{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_version" html_escape="False" %}</strong>
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="set_close" html_escape="False" %}
{% includecode content_path="api-platform/reference/policies/examples/assign-message/assign-message-uber-syntax.xml" region_tag="am_close" html_escape="False" %}
</pre>
    </section>
    <section>
      <h3>Example 1</h3>
      <p>The following example sets the version number to "1.1":</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/set-version-1.xml" adjust_indentation="auto" %}</pre>
    </section>
    <section>
      <h3>Example 2</h3>
      <p>The following uses a variable in curly braces to set the version number:</p>
      <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/set-version-2.xml" adjust_indentation="auto" %}</pre>
      <p>The content of {{am_set_version}} is treated as a message template. This means a
      variable name wrapped in curly braces will be replaced at runtime with the value of the referenced
      variable.</p>
    </section>
  </div>

  <p>You can use {{am_set_version}} only when the following criteria are met:</p>
  <ul>
    <li>Message type: Request</li>
  </ul>

<!-- Temporarily commenting this out pending resolution of APIRT-1894
<p>Sets the HTTP path of the request only when <code>AssignTo</code> type is <code>request</code>. To set the path, the Assign Message policy has to be attached to a request flow of the TargetEndpoint, not to a flow in the ProxyEndpoint. &nbsp;In addition, you must use the <code>&lt;AssignVariable&gt;</code> tag of the Assign Message policy to set the&nbsp;<code>target.copy.pathsuffix</code> flow variable to <code>false</code>.&nbsp;</p>
<p>Specify the path relative to the domain, which is defined by the target endpoint. For example, to set the request path as <code>http://myCo.com/a/b/c</code>, where <code>http://myCo.com</code> is defined by the API proxy's target endpoint, specify the path as:</p>
<pre>
&lt;Set&gt;
    &lt;Path&gt;/a/b/c&lt;/Path&gt;
&lt;/Set&gt;
&lt;AssignVariable&gt;
    &lt;Name&gt;target.copy.pathsuffix&lt;/Name&gt;
    &lt;Value&gt;false&lt;/Value&gt;&nbsp;
&lt;/AssignVariable&gt;
</pre>
<p>Alternatively, you can use the <code>&lt;AssignVariable&gt;</code> element to set the path:</p>
<pre>
&lt;AssignVariable&gt;
    &lt;Name&gt;target.url&lt;/Name&gt;
    &lt;Value&gt;http://a/b/c&lt;/Value&gt;
&lt;/AssignVariable&gt;</pre>
<table border="0" style="margin: 20px;" width="500">
        <tbody>
                <tr>
                        <td style="width:90px">
                                <p><strong>Default:</strong></p>
                        </td>
                        <td width="217">&nbsp;</td>
                </tr>
                <tr>
                        <td>
                                <p><span style="font-weight: bold; text-align: center;">Presence:</span></p>
                        </td>
                        <td>Optional</td>
                </tr>
                <tr>
                        <td>
                                <p><strong>Type:</strong></p>
                        </td>
                        <td>String</td>
                </tr>
        </tbody>
</table>
-->

  <h2 id="customrequests">Create custom request messages</h2>

  <p>You can use Assign Message to create a custom request message. After you create a custom
  request, you can use it in the following ways:</p>

  <ul>
    <li>Access its variables in other policies</li>
    <li>Pass it to an external service</li>
  </ul>

  <aside class="note"><h3 class="hide-from-toc">NOTE</h3>
  You cannot pass a custom request message to the target endpoint in the flow. Edge only passes
  the <em>original request</em> (with any modifications you might have made) to the target
  endpoint.</aside>

  <p>To create a custom request message, use the {{am_assignto_link}} element in your Assign Message
  policy. Set <code>createNew</code> to "true" and specify the name of the new message in the body
  of the element, as the following example shows:</p>

  <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/assignto-2.xml" highlight="2" %}</pre>

  <p>By default, Edge does nothing with the custom request message. After creating it, Edge will
  continue through the flow with the original request. To use the custom request, add a policy such
  as the {{service_callout_policy}} to your proxy that can pass the custom request to an external
  service.</p>

  <p>The following examples create custom request messages:</p>

  <div class="ds-selector-tabs">
    <section>
      <h3>Example 1</h3>
      {% include "api-platform/reference/policies/examples/assign-message/ex1_customrequest1.html" %}
    </section>
    <section>
      <h3>Example 2</h3>
      {% include "api-platform/reference/policies/examples/assign-message/ex2_customrequest2.html" %}
    </section>
  </div>

  <p>You can access a custom request message in another Assign Message policy that occurs later in
  the flow. The following example gets the value of the custom request message's
  <code>user-agent</code> header:</p>

  <pre class="prettyprint">{% includecode content_path="api-platform/reference/policies/examples/assign-message/custom-request-1-access.xml" %}</pre>

  <h2 id="videos">Videos</h2>

  <p>Watch the following videos to learn more about the Assign Message policy.</p>

  <table>
    <thead>
      <tr>
        <th>Video</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><a href="https://www.youtube.com/watch?v=-goGhTJoeB8" target="_blank">Why Assign
        Message Policy?</a></td>
        <td>Learn about the benefits of using Assign Message policy to modify the API request or
        response without modifying the backend code.</td>
      </tr>
      <tr>
        <td><a href="https://www.youtube.com/watch?v=cgRPbgKNpQI" target="_blank">Copy API elements
        using Assign Message policy</a></td>
        <td>Copy elements from an API request or response and construct a new request or response
        object using the Assign Message policy.</td>
      </tr>
      <tr>
        <td><a href="https://www.youtube.com/watch?v=r9MJxUbwMko" target="_blank">Remove API
        elements using Assign Message policy</a></td>
        <td>Remove API elements and modify the API before it reaches the target backend using the
        Assign Message policy.</td>
      </tr>
      <tr>
        <td><a href="https://www.youtube.com/watch?v=kpXhNrZCwR4" target="_blank">Add and set API
        elements using Assign Message policy</a></td>
        <td>Change API request or response by adding query parameters, headers, form parameters, or
        payloads using the Assign Message policy.</td>
      </tr>
      <tr>
        <td><a href="https://www.youtube.com/watch?v=RyZI--auWfA" target="_blank">Create custom
        variables using Assign Message policy</a></td>
        <td>Set custom flow variables using Assign Message policy and leverage the variables in
        other policies in the API proxy.</td>
      </tr>
      <tr>
        <td><a href="https://www.youtube.com/watch?v=Fk5EDazB4-Y" target="_blank">Create new
        request or response objects using Assign Message policy</a></td>
        <td>Create new API request or response objects using the Assign Message policy at API
        runtime.</td>
      </tr>
      <tr>
        <td><a href="https://www.youtube.com/watch?v=grNhwkrFBxg" target="_blank">Create a mock API
        using Assign Message policy</a></td>
        <td>Create a simple mock REST API by adding the Assign Message policy in the response
        flow.</td>
      </tr>
      <tr>
        <td><a href="https://www.youtube.com/watch?v=PUDogzEAZ-Y" target="_blank">Set or modify the
        payload using Assign Message policy</a></td>
        <td>Convert REST request to SOAP request by setting SOAP Payload using the Assign Message
        policy at API runtime.</td>
      </tr>
    </tbody>
  </table>

  <h2 id="errorreference">Error codes</h2>

  <p>{% dynamic include /includes/___assign-message-policy-error-codes %}</p>

  <h2 id="schema">Schemas</h2>

  <p>Each policy type is defined by an XML schema (<code>.xsd</code>). For reference, <a href=
  "https://github.com/apigee/api-platform-samples/tree/master/schemas/policy" class="external">policy schemas</a>
  are available on GitHub.</p>

  <h2 id="relatedtopics">Related topics</h2>

  <p><a href=
  "https://github.com/apigee/api-platform-samples/tree/master/sample-proxies/pagination" class="external">Working
  samples of the AssignMessage</a> policy are available in the <a href=
  "https://github.com/apigee/api-platform-samples" class="external">API Platform samples</a>.</p>

  <p>For a more advanced example of how to override the <code>target.url</code> from the
  ProxyEndpoint, see <a href=
  "https://community.apigee.com/questions/4303/how-do-i-transform-the-path-between-the-proxy-and.html"
  class="external">this Apigee Community article</a>.</p>

  <p>To see a "set path" in action in a {{service_callout_policy}}, check out this <a href=
  "https://github.com/apigee/api-platform-samples/tree/master/learn-edge/service-callout-1"
  class="external">Learn by doing example</a> in the Apigee GitHub samples. Just clone the repository and
  follow the instructions in that topic. The example uses Assign Message to set a request path,
  then uses a Service Callout policy to make the request to an external service.</p>

{% endblock %}
