{% extends "_base.html" %}
{% block title %}Step 4: Deploy your proxy{% endblock %}
{% block body %}

{{ extensions_availability }}

  <p>In the <a href="/api-platform/tutorials/add-extension/extension-callout-policy">previous
  step</a>, you added an {{extension_callout_policy}} to your API proxy. Now, it's time to deploy
  the proxy so that you can try it out.</p>

  <p><strong>To deploy the proxy:</strong></p>

  <ol>
    <li>Click the <strong>Deployment</strong> dropdown to deploy your API proxy to the "test"
      environment.</li>
    <li>Click the <strong>Trace</strong> tab.</li>
    <li>On the <strong>Trace</strong> tab, click <strong>Start Trace Session</strong>.</li>
    <li>Next to the proxy URL, click <strong>Send</strong> to send a request to your API proxy.</li>
    <li>Ensure that your test succeeded and that a 200 was received from the proxy.</li>
    <li>In <strong>Trace</strong>, step through until you reach the ExtensionCallout policy execution step.</li>
    <li>Under <strong>Phase Details</strong>, locate the <code>ConnectorCallout.request</code>
      property and note that its value is the contents of your <code>&lt;Input&gt;</code>
      element.</p>
      <p><img src="/api-platform/images/extensions-trace.png" class="screenshot" width="75%"/></p>
    </li>
    <li>Open the {{gcp_console}} and navigate to your GCP project.</li>
    <li>From the main navigation menu, select <strong>Stackdriver &gt; Logging &gt; Logs</strong>.</li>
    <li>On the logs page, select the Resource dropdown on the left, then click <strong>Global</strong>.</li>
    <li>From the logs dropdown to the right, select "example-log".</li>
    <li>Your log entry should appear in the log list, as the following example shows:</p>
      <p><img src="/api-platform/images/extensions-stackdriver-log.png" class="screenshot" width="75%"/></p>
    </li>
  </ol>

  <aside class="success"><h3>Congratulations!</h3> You've deployed your API proxy with an
  extension. If you want extra credit, see how you can use the extension to log a message
  flow variable.</aside>

  <h3>Next step</h3>
  <p><a class="button button-disabled" href="/api-platform/tutorials/add-extension/add-new-extension">Step 1</a>
  <a class="button button-disabled" href="/api-platform/tutorials/add-extension/configure-for-testing">Step 2</a>
  <a class="button button-disabled" href="/api-platform/tutorials/add-extension/extension-callout-policy">Step 3</a>
  <a class="button button-disabled" href="/api-platform/tutorials/add-extension/proxy-deployment">Step 4</a>
  <a class="button button-primary" href="/api-platform/tutorials/add-extension/xtra-credit">Step 5: Log a message flow variable</a></p>

{% endblock %}
