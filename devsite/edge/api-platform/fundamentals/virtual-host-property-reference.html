  {% extends "_base.html" %} {% block title %}Virtual host property reference{% endblock %} {% block body %}

  <h2 id="virtualhostrepresentation">Virtual host representation</h2>

  <p>The XML object that you use to define a virtual host is based on your version of Edge: Cloud
  or Private Cloud.</p>

  <p>If you are a Private Cloud customer, then you must ensure that you use the correct XML for
  your version of Edge.</p>

  <h3 id="virtualhostrepresentation-cloudandprivatecloud41701andlater">Cloud and Private Cloud
  4.17.01 and later</h3>
  <pre class="prettyprint">
&lt;VirtualHost name="<var>vhostName</var>"&gt;
    &lt;Port&gt;<var>portNumber</var>&lt;/Port&gt;
    &lt;BaseUrl&gt;<var>http://myCo.com</var>&lt;/BaseUrl&gt;
    &lt;OCSPStapling&gt;<var>offOn</var>&lt;/OCSPStapling&gt;
    &lt;HostAliases&gt;
        &lt;HostAlias&gt;<var>hostAlias</var>&lt;/HostAlias&gt;
    &lt;/HostAliases&gt;
    &lt;Interfaces&gt;
        &lt;!-- Private Cloud only --&gt;
        &lt;Interface&gt;<var>interfaceName</var>&lt;/Interface&gt;
    &lt;/Interfaces&gt;
    &lt;RetryOptions&gt;
        &lt;RetryOption&gt;<var>option</var>&lt;/RetryOption&gt;
    &lt;/RetryOptions&gt;
    &lt;ListenOptions&gt;
        &lt;ListenOption&gt;<var>option</var>&lt;/ListenOption&gt;
    &lt;/ListenOptions&gt;
    &lt;SSLInfo&gt;
        &lt;Enabled&gt;<var>trueFalse</var>&lt;/Enabled&gt;
        &lt;ClientAuthEnabled&gt;<var>trueFalse</var>&lt;/ClientAuthEnabled&gt;
        &lt;KeyStore&gt;ref://<var>keystoreRef</var>&lt;/KeyStore&gt;
        &lt;KeyAlias&gt;<var>keyAlias</var>&lt;/KeyAlias&gt;
        &lt;TrustStore&gt;ref://<var>truststoreRef</var>&lt;/TrustStore&gt;
        &lt;IgnoreValidationErrors&gt;<var>trueFalse</var>&lt;/IgnoreValidationErrors&gt;
    &lt;/SSLInfo&gt;
    &lt;Properties&gt;
        &lt;Property name="proxy_read_timeout"&gt;<var>timeout</var>&lt;/Property&gt;
        &lt;Property name="keepalive_timeout"&gt;<var>timeout</var>&lt;/Property&gt;
        &lt;Property name="proxy_request_buffering"&gt;<var>onOff</var>&lt;/Property&gt;
        &lt;Property name="proxy_buffering"&gt;<var>onOff</var>&lt;/Property&gt;
        &lt;Property name="ssl_protocols"&gt;<var>protocolList</var>&lt;/Property&gt;
        &lt;Property name="ssl_ciphers"&gt;<var>cipherList</var>&lt;/Property&gt;
    &lt;/Properties&gt;
&lt;/VirtualHost&gt;
</pre>

  <h3 id="virtualhostrepresentation-privatecloud41601through41609">Private Cloud 4.16.01 through
  4.16.09</h3>
  <pre class="prettyprint">
&lt;VirtualHost name="<var>vhostName</var>"&gt;
    &lt;Port&gt;<var>portNumber</var>&lt;/Port&gt;
    &lt;HostAliases&gt;
        &lt;HostAlias&gt;<var>hostAlias</var>&lt;/HostAlias&gt;
    &lt;/HostAliases&gt;
    &lt;Interfaces&gt;
        &lt;Interface&gt;<var>interfaceName</var>&lt;/Interface&gt;
    &lt;/Interfaces&gt;
    &lt;SSLInfo&gt;
        &lt;Enabled&gt;<var>trueFalse</var>&lt;/Enabled&gt;
        &lt;ClientAuthEnabled&gt;<var>trueFalse</var>&lt;/ClientAuthEnabled&gt;
        &lt;KeyStore&gt;ref://<var>keystoreRef</var>&lt;/KeyStore&gt;
        &lt;KeyAlias&gt;<var>keyAlias</var>&lt;/KeyAlias&gt;
        &lt;TrustStore&gt;ref://<var>truststoreRef</var>&lt;/TrustStore&gt;
        &lt;IgnoreValidationErrors&gt;<var>trueFalse</var>&lt;/IgnoreValidationErrors&gt;
    &lt;/SSLInfo&gt;
&lt;/VirtualHost&gt;
</pre>

  <h3 id="virtualhostrepresentation-privatecloud41507andearlier">Private Cloud 4.15.07 and
  earlier</h3>
  <pre class="prettyprint">
&lt;VirtualHost name="<var>vhostName</var>"&gt;
    &lt;Port&gt;<var>portNumber</var>&lt;/Port&gt;
    &lt;HostAliases&gt;
        &lt;HostAlias&gt;<var>hostAlias</var>&lt;/HostAlias&gt;
    &lt;/HostAliases&gt;
    &lt;Interfaces&gt;
        &lt;Interface&gt;<var>interfaceName</var>&lt;/Interface&gt;
    &lt;/Interfaces&gt;
    &lt;SSLInfo&gt;
        &lt;Enabled&gt;<var>trueFalse</var>&lt;/Enabled&gt;
        &lt;ClientAuthEnabled&gt;<var>trueFalse</var>&lt;/ClientAuthEnabled&gt;
        &lt;KeyStore&gt;<var>keystore</var>&lt;/KeyStore&gt;
        &lt;KeyAlias&gt;<var>keyAlias</var>&lt;/KeyAlias&gt;
        &lt;TrustStore&gt;<var>truststore</var>&lt;/TrustStore&gt;
        &lt;IgnoreValidationErrors&gt;<var>trueFalse</var>&lt;/IgnoreValidationErrors&gt;
        &lt;Ciphers&gt;
             &lt;Cipher&gt;<var>cipher</var>&lt;/Cipher&gt;
             &lt;Cipher&gt;<var>cipher</var>&lt;/Cipher&gt;
         &lt;/Ciphers&gt;
         &lt;Protocols&gt;
             &lt;Protocol&gt;<var>protocol</var>&lt;/Protocol&gt;
             &lt;Protocol&gt;<var>protocol</var>&lt;/Protocol&gt;
         &lt;/Protocols&gt;
    &lt;/SSLInfo&gt;
&lt;/VirtualHost&gt;
</pre>

  <h2 id="virtualhostconfigurationproperties">Virtual host configuration properties</h2>

  <p>The following table lists the properties that you use to configure a virtual host:</p>

  <table>
    <tbody>
      <tr>
        <th>Properties</th>
        <th>Description</th>
        <th>Default</th>
        <th>Required</th>
      </tr>
      <tr>
        <td>VirtualHost</td>

        <td>
          <p>Specifies the name of the virtual host. You use that name to reference the virtual host
          when configuring an API proxy.</p>

          <p>The characters that you can use in the name attribute are restricted to: A-Z0-9._\-$
          %.</p>
        </td>

        <td>None</td>

        <td>Yes</td>
      </tr>

      <tr>
        <td>Port</td>

        <td>
          <p>Specifies the port number used by the virtual host. Ensure that the port is open on the
          Edge Router.</p>

          <p>If you specify a port in a <code>hostalias</code> element, then the port number
          specified by &lt;P<code>ort&gt; </code>must match it.</p>

          <p><strong>For Cloud</strong>: You must specify port 443 when creating a virtual host. If
          omitted, by default the port is set to 443. If you have an existing virtual host that uses
            a port other than 443, you cannot change the port.</p>

          <p><strong>For Private Cloud releases 4.16.01 through 4.17.05:</strong> When creating a
          virtual host, you specify the Router port used by the virtual host. For example, port
          9001. By default, the Router runs as the user "apigee" which does not have access to
          privileged ports, typically ports 1024 and below. If you want to create a virtual host
          that binds the Router to a protected port then you have to configure the Router to run as
          a user with access to those ports. See
            <a href="/private-cloud/latest/setting-virtual-host">Setting up a virtual host</a> for
          more.</p>

          <p><strong>For Private Cloud releases prior to 4.16.01:</strong> A Router can listen to
          only one HTTPS connection per virtual host, on a specific port, with the specified cert.
          Therefore, multiple virtual hosts cannot use the same port number if TLS termination
          occurs on the Router at the specified port.</p>
        </td>

        <td>None</td>

        <td>Yes</td>
      </tr>

      <tr>
        <td>BaseUrl</td>

        <td>Overrides the URL displayed by the Edge UI for an API proxy deployed to the virtual
        host. Useful when you have an external load balancer in front of the Edge Routers. See
        <a href="/api-platform/system-administration/creating-virtual-host.html">Configuring TLS
        access to an API for the Private Cloud</a> for more.</td>

        <td>None</td>

        <td>No</td>
      </tr>

      <tr>
        <td>OCSPStapling</td>

        <td>
          <p>When enabled, an OCSP (Online Certificate Status Protocol)  client sends a status
          request to an OCSP responder to determine if the certificate is valid. The response
          indicates if the certificate is valid and not revoked.  </p>

          <p>The default value is <code>off</code>. Set to <code>on</code> to enable OCSP. TLS must be
          enabled to enable OCSP. You can also use OCSP with two-way TLS.</p>
        </td>

        <td>off</td>

        <td>No</td>
      </tr>

      <tr>
        <td><strong>HostAliases</strong></td>

        <td colspan="3"> </td>
      </tr>

      <tr>
        <td>HostAlias</td>

        <td>
          <p>The publicly visible DNS name of the virtual host on the Router, optionally including the
          port number. The combination of host alias name and port number for the virtual host must
          be unique for all virtual hosts in the Edge installation. That means multiple virtual
          hosts can use the same port number if they have different host aliases.</p>

          <p>You must create a DNS entry and CNAME record that matches the host alias, and the host
          alias must match the string that the client passes in the <code>Host</code> header.</p>

          <p>The port number in <code>HostAlias</code> is optional. If you specify
          the port as part of the host alias, you must also specify the same port by using the
          <code>&lt;Port&gt;</code> element. Or, you can specify two <code>HostAlias</code> elements,
          one with the port number and one without.</p>

          <p>You can have multiple <code>HostAlias</code> definitions
          in the same virtual host definition, corresponding to multiple DNS entries for the
          virtual host, but not for multiple ports. If you want multiple ports, create multiple
          virtual host definitions with different ports.</p>

          <p><strong>For Cloud</strong>: If you have an existing virtual host that uses a port other
            than 443, you cannot add or remove a host alias.</p>

          <p><strong>For Private Cloud:</strong> If you are setting the host alias by using the IP
          addresses of your Routers, and not DNS entries, add a separate host alias for each
          Router, specifying the IP address of each Router and port of the virtual host.</p>
        </td>

        <td>None</td>

        <td>Yes</td>
      </tr>

      <tr>
        <td><strong>Interfaces</strong></td>

        <td colspan="3"><strong>Available for Edge for Private Cloud only.</strong></td>
      </tr>

      <tr>
        <td>Interface</td>

        <td>
          <p>Specifies the network interfaces that you want <code>port</code> to be bound to. If you
          omit this element, the port is bound on all interfaces.</p>

          <p>For example, to specify to bind the port only to en0:</p>

<pre class="prettyprint">&lt;Interfaces&gt;
  &lt;Interface&gt;en0&lt;/Interface&gt;
&lt;/Interfaces&gt;</pre>

          <p>Determine the interfaces available on your system by running the "ifconfig -a"
          command.</p>
        </td>

        <td>None</td>

        <td>All interfaces</td>
      </tr>

      <tr>
        <td><strong>RetryOptions</strong></td>

        <td colspan="3"><strong>Available for Edge Cloud and for Private Cloud 4.18.01 and
        later.</strong></td>
      </tr>

      <tr>
        <td>RetryOption</td>

        <td colspan="3">
          <p>Configure how the Router reacts for this virtual host when the Message Processor goes
          down.</p>

          <p>You can specify multiple values by using <code>&lt;RetryOption&gt;</code>. Valid values
          include:</p>

          <table>
            <tbody>
              <tr>
                <td><code>off</code></td>
                <td>Disables retry, and the virtual host returns a failure code upon a request.</td>
              </tr>
              <tr>
                <td><code>http_599</code></td>
                <td>(Default) If the Router receives an HTTP 599 response from the Message
                  Processor, the Router forwards the request to the next Message Processor.
                  <p><code>HTTP 599</code> is a special response code that is generated by a Message
                  Processor when it is being shut down. The Message Processor tries to complete all
                  existing requests, but for any new requests it responds with HTTP 599 to signal to
                  the Router to retry the request on the next Message Processor.</p>
                </td>
              </tr>
              <tr>
                <td><code>error</code></td>
                <td>If an error occurred while establishing a connection with the Message Processor,
                  passing a request to it, or reading the response header from it, the Router
                  forwards the request to the next Message Processor.</td>
              </tr>
              <tr>
                <td><code>timeout</code></td>
                <td>If a timeout occurs while establishing a connection with the Message Processor,
                  passing a request to it, or reading the response header from it, the Router
                  forwards the request to the next Message Processor.</td>
              </tr>
              <tr>
                <td><code>invalid_header</code></td>
                <td>If the Message Processor returned an empty or invalid response, the Router
                  forwards the request to the next Message Processor.</td>
              </tr>
              <tr>
                <td><code>http_<var>XXX</var></code></td>
                <td>If the Message Processor returned a response with HTTP
                  code <var>XXX</var>, the Router forwards the request to the next Message
                  Processor.</td>
              </tr>
            </tbody>
          </table>
          <p>If you specify multiple values, the Router uses a logical OR to combine them.</p>
          <p>For example:</p>
          <pre class="prettyprint">
&lt;RetryOptions&gt;
  &lt;RetryOption&gt;http_599&lt;/RetryOption&gt;
  &lt;RetryOption&gt;error&lt;/RetryOption&gt;
  &lt;RetryOption&gt;timeout&lt;/RetryOption&gt;
  &lt;RetryOption&gt;invalid_header&lt;/RetryOption&gt;
&lt;/RetryOptions&gt;
</pre>
        </td>
      </tr>

      <tr>
        <td><strong>ListenOptions</strong></td>

        <td colspan="3"><strong>Available for Private Cloud 4.18.01 and later and for Edge
        Cloud by making a request to {{support}}.</strong></td>
      </tr>

      <tr>
        <td>ListenOption</td>

        <td colspan="3">
          <p>If you use an ELB in TCP pass-thru mode to handle requests to the Edge Routers,
          the Router treats the IP address of the ELB as the client IP instead of
          the actual client IP. If the Router requires the true client IP,
          enable <code>proxy_protocol</code> on the
          ELB so that it passes the client IP in the TCP packet. On the Router, you must also set
          the <code>&lt;ListenOption&gt;</code>
          on the virtual host to <code>proxy_protocol</code>.
          Because the ELB is in TCP pass-thru mode, you typically terminate TLS on the Router.
          Therefore, you usually only configure the virtual host to use <code>proxy_protocol</code>
          when you also configure it to use TLS. </p>

          <p>The default value for <code>&lt;ListenOption&gt;</code> is an empty
          string.</p>

          <p>For example:</p>
          <pre class="prettyprint">
&lt;ListenOptions&gt;
  &lt;ListenOption&gt;proxy_protocol&lt;/ListenOption&gt;
&lt;/ListenOptions&gt;
</pre>

          <p>To later unset <code>&lt;ListenOption&gt;</code>, update the
          virtual host and omit the <code>&lt;ListenOptions&gt;</code> tag from the
          update.</p>
        </td>
      </tr>

      <tr>
        <td><strong>SSLInfo</strong></td>

        <td colspan="3"> </td>
      </tr>

      <tr>
        <td>Enabled</td>

        <td>
          <p>Enables one-way TLS/SSL. You must have defined a keystore containing the cert and
        private key.</p>

          <p><strong>For Cloud</strong>: If your existing virtual host is configured to use a port
            other than 443,
          you cannot change the TLS setting. That means you cannot change the TLS setting from
          enabled to disabled, or from disabled to enabled. </p>
        </td>

        <td>false</td>

        <td>No</td>
      </tr>

      <tr>
        <td>ClientAuthEnabled</td>

        <td>Enables two-way, or client, TLS between Edge (server) and the app (client) making the
        request. Enabling two-way TLS requires that you set up a truststore on Edge that contains
        the cert from the TLS client.</td>

        <td>false</td>

        <td>No</td>
      </tr>

      <tr>
        <td>KeyStore</td>

        <td>
          <p>The name of the keystore on Edge.</p>

          <p>Apigee recommends that you use a reference to specify the keystore name so that you
          can change the keystore without having to restart Routers. See <a href=
          "/api-platform/system-administration/options-configuring-tls.html">Options for
          configuring TLS</a> for more.</p>
        </td>

        <td>None</td>

        <td>Yes if Enabled is true</td>
      </tr>

      <tr>
        <td>KeyAlias</td>

        <td>The alias specified when you uploaded the cert and private key to the keystore. You
        must specify the alias name literally; you cannot use a reference. See <a href=
        "/api-platform/system-administration/options-configuring-tls.html">Options for configuring
        TLS</a> for more.</td>

        <td>None</td>

        <td>Yes if Enabled is true</td>
      </tr>

      <tr>
        <td>TrustStore</td>

        <td>
          <p>The name of the truststore on Edge that contains the certificate or certificate chain
          used for two-way TLS. Required if <code>&lt;ClientAuthEnabled&gt;</code> is true.</p>

          <p>Apigee recommends that you use a reference to specify the truststore name so that you
          can change the truststore without having to restart Routers. See <a href=
          "/api-platform/system-administration/options-configuring-tls.html">Options for
          configuring TLS</a> for more.</p>
        </td>

        <td>None</td>

        <td>No</td>
      </tr>

      <tr>
        <td>IgnoreValidationErrors</td>

        <td>
          <p>If true, specifies to ignore TLS certificate errors. This is similar to the "-k" option
          to cURL.</p>

          <p>This option is valid when configuring TLS for Target Servers and Target Endpoints, and
          when configuring virtual hosts that use 2-way TLS.</p>
        </td>

        <td>false</td>

        <td>No</td>
      </tr>

      <tr>
        <td>Ciphers</td>

        <td>
          <p><strong>For Edge for Private Cloud version 4.15.07 and earlier only.</strong></p>

          <p>Specifies the ciphers supported by the virtual host. If no ciphers are specified, then
          all ciphers available for the JVM will be permitted.</p>

          <p>To restrict ciphers, add the following elements:</p>

<pre  class="prettyprint">&lt;Ciphers&gt;
  &lt;Cipher&gt;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&lt;/Cipher&gt;
  &lt;Cipher&gt;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256&lt;/Cipher&gt;
&lt;/Ciphers&gt;</pre>
        </td>

        <td>All supported by the JVM</td>

        <td>No</td>
      </tr>

      <tr>
        <td>Protocols</td>

        <td>
          <p><strong>For Edge for Private Cloud version 4.15.07 and earlier only.</strong></p>

          <p>Specifies the protocols supported by the virtual host. If no protocols are specified,
          then all protocols available for the JVM will be permitted.</p>

          <p>To restrict protocols, add the following elements:</p>

<pre class="prettyprint">&lt;Protocols&gt;
  &lt;Protocol&gt;TLSv1&lt;/Protocol&gt;
  &lt;Protocol&gt;TLSv1.2&lt;/Protocol&gt;
  &lt;Protocol&gt;SSLv2Hello&lt;/Protocol&gt;
&lt;/Protocols&gt;</pre>
        </td>

        <td>All supported by the JVM</td>

        <td>No</td>
      </tr>

      <tr>
        <td><strong>Properties</strong></td>

        <td colspan="3"><strong>Available for Edge Cloud and for Private Cloud 4.17.01 and
        later.</strong></td>
      </tr>

      <tr>
        <td>proxy_read_timeout</td>

        <td>
          <p>Sets the timeout duration, in seconds, between Message Processors and the Router. The
          Router drops the connection and returns an HTTP 504 response if it does not get a
          response from the Message Processor before this duration expires.</p>

          <p>The value of proxy_read_timeout should be greater than the target timeout value used
          by the Message Processor. This ensures that the Router does not timeout before the
          Message Processor has had time to return a response. The default target timeout for the
          Message Processor is 55 seconds, 55000 milliseconds, as defined by the
          <code>conf_http_HTTPTransport.io.timeout.millis</code> token for the Message
          Processor.</p>
        </td>

        <td>57</td>

        <td>No</td>
      </tr>

      <tr>
        <td>keepalive_timeout</td>

        <td>
          <p>Sets the timeout duration, in seconds, between the client and the Router when the client
          makes a request that contains the Keep-Alive header. The Router keeps the connection open
          until the duration expires.</p>

          <p>The Router will not close the connection if it is currently waiting for a response
          from the Message Processor. The timeout begins only after the Router returns the response
          to the client.</p>
        </td>

        <td>65</td>

        <td>No</td>
      </tr>

      <tr>
        <td>ssl_ciphers</td>

        <td>
          <p>Sets the ciphers supported by the virtual host, overriding the defaults ciphers set on
          the Router.</p>


          <p>Specify a colon-delimited list of ciphers, in the form:</p>
<pre class="prettyprint">&lt;Property name="ssl_ciphers"&gt;HIGH:!aNULL:!MD5:!DH+3DES:!kEDH;&lt;/Property&gt;</pre>

            <p>For information on the syntax and values allowed by this token, see <a class="external" href=
  "https://www.openssl.org/docs/man1.0.2/apps/ciphers.html">https://www.openssl.org/docs/man1.0.2/apps/ciphers.html</a>.
  Note that this token uses the OpenSSL cipher names, such as AES128-SHA256, and not the
  Java/JSSE cipher names, such as TLS_RSA_WITH_AES_128_CBC_SHA256.</p>

        </td>

        <td>
          HIGH:!aNULL:

          <p>!MD5:</p>

          <p>!DH+3DES:</p>

          <p>!kEDH</p>
        </td>

        <td>No</td>
      </tr>

      <tr>
        <td>ssl_protocols</td>

        <td>
          <p><strong>Available for Edge for Private Cloud only.</strong></p>

          <aside class="note"><b>Note: </b>Edge in the Cloud supports TLS version 1.2 only.</aside>

          <p>Sets the TLS protocols supported by the virtual host, as a space delimited list,
          overriding the defaults protocols set on the Router.</p>

          <p><strong>Note</strong>: If two virtual hosts share the same port, they must set
            <code>ssl_protocols</code> to the same protocols. Meaning, virtual hosts sharing the same port must
          support the exact same protocols.</p>

          <p>Specify a space-delimited list of TLS protocols, in the form:</p>
<pre class="prettyprint">&lt;Property name="ssl_protocols"&gt;TLSv1 TLSv1.2&lt;/Property&gt;</pre>
        </td>

        <td>TLSv1 TLSv1.1 TLSv1.2</td>

        <td>No</td>
      </tr>

      <tr>
        <td>proxy_request_buffering</td>

        <td>
          <p>Enables (on) or disables (off) buffering of the request body. When buffering is on, the
          Router buffers the entire request body before sending it to the Message Processor. If
          there is an error, the Router can retry a different Message Processor.</p>

          <p>If off, buffering is disabled and the request body is sent to the Message Processor
          immediately as it is received. If there is an error, the Router does not retry the
          request to another Message Processor.</p>
        </td>

        <td>on</td>

        <td>No</td>
      </tr>

      <tr>
        <td>proxy_buffering</td>

        <td>Enables (on) or disables (off) buffering of the response. When buffering is on, the
        Router buffers the response. When buffering is off, the response is passed to the client
        synchronously, immediately as it is received by the Router.</td>

        <td>on</td>

        <td>No</td>
      </tr>

    </tbody>
  </table>

  {% endblock %}
